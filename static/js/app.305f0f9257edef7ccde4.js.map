{"version":3,"sources":["webpack:///static/js/app.305f0f9257edef7ccde4.js","webpack:///./src/lib/createInputsModel.js","webpack:///../query-state/lib/windowHistory.js","webpack:///./src/lib/programs/updatePositionProgram.js","webpack:///./src/lib/shaderGraph/BaseShaderNode.js","webpack:///../query-state/lib/inMemoryHistory.js","webpack:///./src/lib/programs/colorModes.js","webpack:///../query-state/index.js","webpack:///./src/lib/editor/getParsedVectorFieldFunction.js","webpack:///./src/lib/programs/audioProgram.js","webpack:///../query-state/lib/query.js","webpack:///./src/lib/utils/request.js","webpack:///./src/lib/gl-utils.js","webpack:///./src/lib/shaderGraph/UserDefinedVelocityFunction.js","webpack:///./src/lib/utils/floatPacking.js","webpack:///./src/lib/programs/inputs/imageInput.js","webpack:///./src/lib/scene.js","webpack:///./src/lib/shaderGraph/parts/simplex-noise.js","webpack:///./src/lib/appState.js","webpack:///./src/lib/shaderGraph/updatePositionGraph.js","webpack:///./src/lib/shaderGraph/renderNodes.js","webpack:///./src/lib/utils/makeStatCounter.js","webpack:///./src/lib/shaderGraph/parts/decodeFloatRGBA.js","webpack:///./src/lib/shaderGraph/TexturePositionNode.js","webpack:///./src/lib/nativeMain.js","webpack:///./src/lib/shaderGraph/parts/encodeFloatRGBA.js","webpack:///./src/lib/shaderGraph/DrawParticleGraph.js","webpack:///./src/lib/shaderGraph/customInput.js","webpack:///./src/lib/shaderGraph/shaderBasedColor.js","webpack:///./src/lib/editor/vectorFieldState.js","webpack:///./src/lib/wrapVectorField.js","webpack:///./src/lib/bus.js","webpack:///./src/lib/programs/inputs/loadTexture.js","webpack:///../query-state/~/ngraph.events/index.js","webpack:///./src/lib/programs/colorProgram.js","webpack:///./src/lib/programs/screenProgram.js","webpack:///./src/lib/shaderGraph/RungeKuttaIntegrator.js","webpack:///./src/lib/editor/fetchGLSL.js","webpack:///./src/lib/programs/inputs/inputCollection.js","webpack:///./src/lib/wglPanZoom.js","webpack:///./src/lib/utils/cursorUpdater.js","webpack:///./src/lib/programs/drawParticlesProgram.js","webpack:///./src/lib/utils/textureCollection.js","webpack:///./src/lib/config.js","webpack:///./src/lib/editor/pragmaParser.js","webpack:///./src/lib/shaderGraph/PanzoomTransform.js"],"names":["webpackJsonp","/eR5","module","__webpack_exports__","__webpack_require__","createInputsModel","ctx","getInputs","inputs","addInput","inputNumber","vm","createInputElementViewModel","push","i","__WEBPACK_IMPORTED_MODULE_0__programs_inputs_inputCollection__","i0","__WEBPACK_IMPORTED_MODULE_3__appState_js__","getQS","get","link","updateBinding","immediate","pendingUpdate","clearTimeout","setBinding","setTimeout","input","error","binding","__WEBPACK_IMPORTED_MODULE_2__programs_inputs_imageInput__","done","set","err","bindInput","name","2PgA","exports","windowHistory","defaults","options","rewriteHashToSearch","mergedState","Object","create","searchString","window","location","search","assign","query","parse","substr","hashString","hash","appState","hashPrefix","stringify","history","replaceState","undefined","replace","onChanged","changeCallback","Error","listeners","length","addEventListener","onHashChanged","dispose","removeEventListener","notifyListeners","getStateFromHash","listener","baseString","useSearchPart","queryString","inMemoryHistory","useSearch","stateFromHash","stateChanged","keys","forEach","key","3xg8","updatePositionProgram","updateCode","vectorField","particlePositionShaderCodeBuilder","setCustomVectorField","fragment","getFragmentShader","vertex","getVertexShader","newProgram","__WEBPACK_IMPORTED_MODULE_0__gl_utils__","createProgram","gl","updateProgram","unload","colorMode","__WEBPACK_IMPORTED_MODULE_2__colorModes__","VELOCITY","readVelocity","requestSpeedUpdate","updateParticlesCount","x","y","particleStateResolution","dimensions","particleState","readTextures","__WEBPACK_IMPORTED_MODULE_4__utils_textureCollection__","writeTextures","prepareToDraw","program","UNIFORM","uniform4f","u_particle_color","uniformParticleColor","r","g","b","a","setColorMinMax","bindTextures","updateParticlesPositions","useProgram","bindAttribute","quadBuffer","a_pos","updateBindings","audioTexture","bindTexture","uniform1i","uniform1f","u_rand_seed","frameSeed","u_h","integrationTimeStep","frame","cursor","clickX","clickY","hoverX","hoverY","bbox","uniform2f","u_min","minX","minY","u_max","maxX","maxY","u_drop_rate","dropProbability","writeInfo","u_out_coordinate","bindFramebuffer","framebuffer","texture","viewport","drawArrays","TRIANGLES","pendingVectorLines","processVectorLinesRequest","temp","putVectorLinesRequestIntoQueue","request","resolutionOfParticlesInRequest","resolution","numParticles","texturesForRead","texturesForWrite","velocity_x","Uint8Array","readPixels","RGBA","UNSIGNED_BYTE","velocity_y","xStats","__WEBPACK_IMPORTED_MODULE_5__utils_makeStatCounter__","yStats","decoded_velocity_x","Float32Array","decoded_velocity_y","idx","vx","readFloat","vy","add","vectorLineInfo","__WEBPACK_IMPORTED_MODULE_7__bus___default","fire","__WEBPACK_IMPORTED_MODULE_3__colorProgram__","on","buffer","offset","__WEBPACK_IMPORTED_MODULE_6__utils_floatPacking__","__WEBPACK_IMPORTED_MODULE_1__shaderGraph_updatePositionGraph__","__WEBPACK_IMPORTED_MODULE_7__bus__","n","4KA4","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck__","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck___default","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass__","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass___default","BaseShaderNode","this","value","5hi0","lastQueryObject","newQueryObject","triggerChange","6c6E","ANGLE","7UaU","queryState","onChange","callback","eventBus","offChange","off","getHistoryObject","getValue","keyName","setValue","keyNameType","api","updateQuery","newAppState","setIfEmpty","validateHistoryAPI","eventify","instance","singletonQS","85ps","getParsedVectorFieldFunction","vectorFieldCode","__WEBPACK_IMPORTED_MODULE_1__pragmaParser__","then","pragmaParseResult","getCode","parserResult","glslParser","check","globals","vectorFieldGlobals","code","log","errorCount","parserError","diag","diagnostics","firstError","range","lineColumn","source","_lineOffsets","line","contents","column","substring","start","end","prefix","diagText","text","whitespace","errorDetail","isFloatError","indexOf","Array","join","__WEBPACK_IMPORTED_MODULE_0__bus__","__WEBPACK_IMPORTED_MODULE_0__bus___default","e","bind","catch","oe","94y8","audioProgram","updateAudioBuffer","deleteTexture","updateTextures","audioDirty","TEXTURE_2D","texImage2D","audioBuffer","newBuffer","audioWidth","__WEBPACK_IMPORTED_MODULE_1__gl_utils__","createTexture","NEAREST","9XuS","object","toPairs","pair","encodePart","encodeValue","map","decodeRecord","queryRecord","split","decodeURIComponent","decodeValue","Date","toISOString","part","encodeURIComponent","saferEscape","character","isNaN","isBolean","isISODateString","parseFloat","strValue","str","match","C8nW","url","download","resolve","reject","updateProgress","lengthComputable","progress","loaded","total","percent","transferComplete","req","status","response","responseType","JSON","transferFailed","transferCanceled","XMLHttpRequest","open","send","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__","Ddjs","unit","activeTexture","TEXTURE0","createBuffer","data","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","filter","width","height","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","attribute","numComponents","enableVertexAttribArray","vertexAttribPointer","FLOAT","vertexSource","fragmentSource","deleteProgram","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","wrapper","numAttributes","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","numUniforms","ACTIVE_UNIFORMS","uniform","getActiveUniform","getUniformLocation","type","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","DuZ1","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of__","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default","__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass__","__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass___default","__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn__","__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default","__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits__","__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits___default","__WEBPACK_IMPORTED_MODULE_5__BaseShaderNode__","__WEBPACK_IMPORTED_MODULE_6__parts_simplex_noise__","__WEBPACK_IMPORTED_MODULE_7__customInput__","UserDefinedVelocityFunction","_BaseShaderNode","_this","__proto__","call","newUpdateCode","FaU1","encodeFloatRGBA","val","out","writeOffset","mag","Math","abs","exponent","floor","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_math_log2___default","exp2","mantissa","c","d","decodeFloatRGBA","A","B","C","D","exp","LN2","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_math_log2__","I6d+","createImageInputBinding","callbacks","handleError","setTexture","loadedTexture","__WEBPACK_IMPORTED_MODULE_3__bus___default","inputIndex","realIndex","FREE_TEXTURE_UNIT","__WEBPACK_IMPORTED_MODULE_0__loadTexture__","__WEBPACK_IMPORTED_MODULE_2__config__","__WEBPACK_IMPORTED_MODULE_3__bus__","JHsM","initScene","moveBoundingBox","changes","parsedBoundingBox","__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign___default","assignIfPossible","heightChange","cx","prevWidth","applyBoundingBox","change","newBoundingBox","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_number_parse_float___default","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite___default","startRecord","capturer","currentCapturer","stopRecord","setColorMode","mode","parseInt","__WEBPACK_IMPORTED_MODULE_6__appState__","getColorMode","drawProgram","updateColorMode","getIntegrationTimeStep","setIntegrationTimeStep","f","__WEBPACK_IMPORTED_MODULE_5__bus___default","setPaused","shouldPause","isPaused","nextFrame","setFadeOutSpeed","fadeOpacity","setFadeout","getFadeOutSpeed","getFadeout","getParticlesCount","getParticleCount","setParticlesCount","newParticleCount","particleCount","setParticleCount","setDropProbability","getDropProbability","onResize","setWidthHeight","innerWidth","innerHeight","screenProgram","updateScreenTextures","updateBoundingBox","currentPanZoomTransform","w","h","dx","max","dy","canvasRect","top","left","canvas","style","stop","panzoom","cursorUpdater","vectorFieldEditorState","lastAnimationFrame","requestAnimationFrame","draw","cancelAnimationFrame","drawScreen","capture","fadeOutLastFrame","drawParticles","renderCurrentScreen","ceil","sqrt","restoreBBox","savedBBox","getBBox","sX","PI","E","sY","tX","tY","w2","h2","showRectangle","right","bottom","transform","clientX","scale","clientY","boundingBoxUpdated","p","round","saveBBox","resetBoundingBox","boundingBox","moveBy","disable","DEPTH_TEST","STENCIL_TEST","createFramebuffer","__WEBPACK_IMPORTED_MODULE_3__gl_utils__","screenTextureUnit","inputsModel","__WEBPACK_IMPORTED_MODULE_12__createInputsModel__","__WEBPACK_IMPORTED_MODULE_8__programs_screenProgram__","__WEBPACK_IMPORTED_MODULE_9__programs_drawParticlesProgram__","__WEBPACK_IMPORTED_MODULE_10__utils_cursorUpdater__","__WEBPACK_IMPORTED_MODULE_11__editor_vectorFieldState__","getCanvasRect","getBoundingBox","__WEBPACK_IMPORTED_MODULE_4_panzoom___default","realPinch","zoomSpeed","controller","__WEBPACK_IMPORTED_MODULE_7__wglPanZoom__","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite__","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_number_parse_float__","__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign__","__WEBPACK_IMPORTED_MODULE_4_panzoom__","__WEBPACK_IMPORTED_MODULE_5__bus__","JjDM","NEgR","qs","defined","cm","currentState","fadeout","fo","pc","timeStep","dt","clamp","dp","cy","arguments","pendingSave","saveReally","vfCode","oldCode","__WEBPACK_IMPORTED_MODULE_4__wrapVectorField__","defaultVectorField","getDefaultCode","saveCode","vf","number","min","__WEBPACK_IMPORTED_MODULE_1_query_state__","__WEBPACK_IMPORTED_MODULE_1_query_state___default","__WEBPACK_IMPORTED_MODULE_2__bus__","__WEBPACK_IMPORTED_MODULE_2__bus___default","__WEBPACK_IMPORTED_MODULE_3__programs_colorModes__","wrapVectorField","settingsPanel","collapsed","scene","Qv35","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_possibleConstructorReturn__","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_possibleConstructorReturn___default","__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_inherits__","__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_inherits___default","__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck__","__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck___default","__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass__","__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass___default","__WEBPACK_IMPORTED_MODULE_6__TexturePositionNode__","__WEBPACK_IMPORTED_MODULE_7__renderNodes__","__WEBPACK_IMPORTED_MODULE_8__UserDefinedVelocityFunction__","__WEBPACK_IMPORTED_MODULE_9__PanzoomTransform__","__WEBPACK_IMPORTED_MODULE_10__RungeKuttaIntegrator__","UpdatePositionGraph","readStoredPosition","udfVelocity","integratePositions","dropParticles","RandomParticleDropper","writeComputedPosition","panZoomDecode","decode","panZoomEncode","velocityCode","setNewUpdateCode","nodes","getMainBody","apply","S+/9","renderNodes","addToCode","node","getDefines","getFunctions","V39N","makeStatCounter","reset","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","getMin","getMax","XFig","XMEc","__WEBPACK_IMPORTED_MODULE_6__parts_encodeFloatRGBA__","__WEBPACK_IMPORTED_MODULE_7__parts_decodeFloatRGBA__","TexturePosition","isDecode","YJWA","CCapture","ffmpegScriptLoaded","ffmpegServer","document","createElement","setAttribute","onload","head","appendChild","format","framerate","verbose","extension","codec","ffmpegArguments","isRecording","__WEBPACK_IMPORTED_MODULE_1__bus___default","FFMpegServer","save","defineProperty","__WEBPACK_IMPORTED_MODULE_0__scene__","__WEBPACK_IMPORTED_MODULE_1__bus__","getElementById","ctxOptions","antialiasing","getContext","webGLEnabled","a8s+","aZPT","addMethods","producer","array","getMethods","addMain","getMain","uniformColor","getVariables","textureBasedPosition","__WEBPACK_IMPORTED_MODULE_2__parts_decodeFloatRGBA__","__WEBPACK_IMPORTED_MODULE_3__shaderBasedColor__","__WEBPACK_IMPORTED_MODULE_4__programs_colorModes__","DrawParticleGraph","isUniformColor","variables","mainBody","decodePositions","colorParts","methods","main","bvb0","getInputUniforms","c5NW","shaderBasedColor","udf","integrate","__WEBPACK_IMPORTED_MODULE_2__programs_colorModes__","setParticleColor","__WEBPACK_IMPORTED_MODULE_0__UserDefinedVelocityFunction__","__WEBPACK_IMPORTED_MODULE_1__RungeKuttaIntegrator__","c5hq","createVectorFieldEditorState","parseCode","__WEBPACK_IMPORTED_MODULE_1__appState__","setCode","currentVectorFieldCode","trySetNewCode","result","cancelled","updateErrorInfo","customCode","__WEBPACK_IMPORTED_MODULE_2__getParsedVectorFieldFunction__","currentResult","currentVectorFieldVersion","capturedVersion","message","persistedCode","console","cj2E","field","eBcr","egvE","loadTexture","reportError","rejectTexture","internalFormat","srcFormat","srcType","image","isPowerOf2","generateMipmap","LINEAR","resolveTexture","Image","crossOrigin","onerror","src","fkI9","createEventsStorage","subject","registeredEvents","eventName","handlers","splice","fireArguments","prototype","callbackInfo","validateSubject","reservedWords","hasOwnProperty","eventsStorage","gIFv","colorProgram","disposeTextures","velocity_x_texture","velocity_y_texture","pendingSpeedUpdate","speedNeedsUpdate","u_velocity_range","velocityCounter","OUT_V_X","OUT_V_Y","updateMinMax","v","__WEBPACK_IMPORTED_MODULE_3__utils_makeStatCounter__","__WEBPACK_IMPORTED_MODULE_2__utils_floatPacking__","h62Y","makeScreenProgram","screenTexture","lastRenderedBoundingBox","boundBoxTextureTransform","drawTexture","backgroundTexture","NO_TRANSFORM","saveLastBbox","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","clearColor","backgroundColor","clear","COLOR_BUFFER_BIT","emptyPixels","opacity","textureTransform","u_screen","u_opacity_border","u_opacity","uniform3f","u_transform","i69e","RungeKuttaIntegrator","iw7m","fetchGLSL","trimmed","trim","cachedResponse","loadedLinks","__WEBPACK_IMPORTED_MODULE_2__utils_request__","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_map__","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_map___default","n67P","createInputCollection","inputBinding","prevBinding","boundInputs","currentProgram","updateInputBinding","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_map___default","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_map__","p0IO","wglPanZoom","updateBoundingBoxCallback","lastDx","lastDy","lastScale","applyTransform","newTransform","getOwner","p2DF","p9aJ","createCursorUpdater","onMouseMove","onMouseClick","onTouchStart","onTouchMove","firstTouch","touches","setClick","setHover","getSceneXFromClientX","getSceneYFromClientY","pKWO","drawParticlesProgram","initDrawProgram","drawGraph","__WEBPACK_IMPORTED_MODULE_1__shaderGraph_DrawParticleGraph__","currentVectorField","random","particleIndices","particleStateX","particleStateY","__WEBPACK_IMPORTED_MODULE_3__utils_floatPacking_js__","particleIndexBuffer","deleteBuffer","a_index","u_particles_res","POINTS","__WEBPACK_IMPORTED_MODULE_2__updatePositionProgram__","__WEBPACK_IMPORTED_MODULE_4__config__","isAudioEnabled","__WEBPACK_IMPORTED_MODULE_5__audioProgram__","pXNl","textureCollection","assignProgramUniforms","textures","tInfo","index","rvz5","__WEBPACK_IMPORTED_MODULE_0__appState__","defaultConfig","vectorLinesEnabled","showBindings","svlg","makePragmaParser","nullCode","parsedLines","processLineByLine","pending","all","outputLines","processPragma","pragmaInclude","include","insertIndex","currentIndex","__WEBPACK_IMPORTED_MODULE_1__fetchGLSL_js__","lines","vhRe","PanzoomTransform","config","srcPosName","posName"],"mappings":"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","file":"static/js/app.305f0f9257edef7ccde4.js","sourcesContent":["webpackJsonp([4],{\n\n/***/ \"/eR5\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = createInputsModel;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__programs_inputs_inputCollection__ = __webpack_require__(\"n67P\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__programs_inputs_videoInput__ = __webpack_require__(\"p2DF\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__programs_inputs_imageInput__ = __webpack_require__(\"I6d+\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__appState_js__ = __webpack_require__(\"NEgR\");\n\n\n\n\n\n// Allows to bind media elements to vector field\nfunction createInputsModel(ctx) {\n  ctx.inputs = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__programs_inputs_inputCollection__[\"a\" /* default */])();\n  var inputs = [];\n  readInputsFromAppState();\n\n  var api = {\n    getInputs: getInputs,\n    addInput: addInput\n  };\n\n  return api;\n\n  function getInputs() {\n    return inputs;\n  }\n\n  function addInput(inputNumber) {\n    var vm = createInputElementViewModel(ctx, inputNumber);\n    inputs.push(vm);\n    return vm;\n  }\n\n  function readInputsFromAppState() {\n    var i0 = __WEBPACK_IMPORTED_MODULE_3__appState_js__[\"a\" /* default */].getQS().get('i0');\n    if (i0) {\n      var vm = addInput(0);\n      vm.link = i0;\n      vm.updateBinding( /* immediate = */true);\n    }\n  }\n}\n\nfunction createInputElementViewModel(ctx, inputNumber) {\n  var pendingUpdate = null;\n\n  var input = {\n    link: '',\n    error: null,\n    name: 'input' + inputNumber,\n    updateBinding: updateBinding\n  };\n\n  return input;\n\n  function updateBinding(immediate) {\n    if (pendingUpdate) {\n      clearTimeout(pendingUpdate);\n      pendingUpdate = null;\n    }\n\n    if (immediate) {\n      setBinding();\n    } else {\n      pendingUpdate = setTimeout(setBinding, 300);\n    }\n  }\n\n  function setBinding() {\n    input.error = null;\n    pendingUpdate = null;\n    var binding = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__programs_inputs_imageInput__[\"a\" /* default */])(ctx, input.link, {\n      done: function done() {\n        // TODO: Preview\n        __WEBPACK_IMPORTED_MODULE_3__appState_js__[\"a\" /* default */].getQS().set('i' + inputNumber, input.link);\n      },\n      error: function error(err) {\n        // TODO: Better Error checking\n        input.error = err;\n      }\n    });\n    ctx.inputs.bindInput(0, binding);\n  }\n}\n\n/***/ }),\n\n/***/ \"2PgA\":\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * Uses `window` to monitor hash and update hash\n */\nmodule.exports = windowHistory;\n\nvar inMemoryHistory = __webpack_require__(\"5hi0\");\nvar query = __webpack_require__(\"9XuS\");\n\nfunction windowHistory(defaults, options) {\n  // If we don't support window, we are probably running in node. Just return\n  // in memory history\n  if (typeof window === 'undefined') return inMemoryHistory(defaults);\n\n  // Store all `onChanged()` listeners here, so that we can have just one\n  // `hashchange` listener, and notify one listeners within single event.\n  var listeners = [];\n\n  var useSearchPart = options && options.useSearch; // prefer query ? over hash #\n\n  // This prefix is used for all query strings. So our state is stored as\n  // my-app.com/#?key=value\n  var hashPrefix = useSearchPart ? '?' : '#?';\n\n  if (options.rewriteHashToSearch) {\n    rewriteHashToSearch();\n  }\n  init();\n\n  // This is our public API:\n  return {\n    /**\n     * Adds callback that is called when hash change happen. Callback receives\n     * current hash string with `#?` sign\n     * \n     * @param {Function} changeCallback - a function that is called when hash is\n     * changed. Callback gets one argument that represents the new state.\n     */\n    onChanged: onChanged,\n\n    /**\n     * Releases all resources\n     */\n    dispose: dispose,\n\n    /**\n     * Sets a new app state\n     *\n     * @param {object} appState - the new application state, that should be\n     * persisted in the hash string\n     */\n    set: set,\n\n    /**\n     * Gets current app state\n     */\n    get: getStateFromHash,\n\n    /**\n     * Allows to rewrite current hash url into search url\n     */\n    rewriteHashToSearch: rewriteHashToSearch\n  };\n\n  // Public API is over. You can ignore this part.\n\n  function init() {\n    var stateFromHash = getStateFromHash();\n    var stateChanged = false;\n\n    if (typeof defaults === 'object' && defaults) {\n      Object.keys(defaults).forEach(function(key) {\n        if (key in stateFromHash) return;\n\n        stateFromHash[key] = defaults[key]\n        stateChanged = true;\n      });\n    }\n\n    if (stateChanged) set(stateFromHash);\n  }\n\n  function rewriteHashToSearch() {\n    var mergedState = Object.create(null);\n\n    var searchString = window.location.search;\n    if (searchString) mergedState = Object.assign(mergedState, query.parse(searchString.substr(1)));\n\n    var hashString = window.location.hash;\n    if (hashString) mergedState = Object.assign(mergedState, query.parse(hashString.substr(2)));\n\n    set(mergedState);\n  }\n\n  function set(appState) {\n    var hash = hashPrefix + query.stringify(appState);\n\n    if (window.history) {\n      window.history.replaceState(undefined, undefined, hash);\n    } else {\n      window.location.replace(hash);\n    }\n  }\n\n  function onChanged(changeCallback) {\n    if (typeof changeCallback !== 'function') throw new Error('changeCallback needs to be a function');\n\n    // we start listen just once, only if we didn't listen before:\n    if (listeners.length === 0) {\n      window.addEventListener('hashchange', onHashChanged, false);\n    }\n\n    listeners.push(changeCallback);\n  }\n\n  function dispose() {\n    if (listeners.length === 0) return; // no need to do anything.\n\n    // Let garbage collector collect all listeners;\n    listeners = [];\n\n    // And release hash change event:\n    window.removeEventListener('hashchange', onHashChanged, false);\n  }\n\n  function onHashChanged() {\n    var appState = getStateFromHash();\n    notifyListeners(appState);\n  }\n\n  function notifyListeners(appState) {\n    for (var i = 0; i < listeners.length; ++i) {\n      var listener = listeners[i];\n      listener(appState);\n    }\n  }\n\n  function getStateFromHash() {\n    var baseString = useSearchPart ? window.location.search : window.location.hash;\n    // or symbol || is used to get empty string when no base string is present. \n    var queryString = (baseString || hashPrefix).substr(hashPrefix.length);\n    return query.parse(queryString);\n  }\n}\n\n\n/***/ }),\n\n/***/ \"3xg8\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = updatePositionProgram;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__gl_utils__ = __webpack_require__(\"Ddjs\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__shaderGraph_updatePositionGraph__ = __webpack_require__(\"Qv35\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__colorModes__ = __webpack_require__(\"6c6E\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__colorProgram__ = __webpack_require__(\"gIFv\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__utils_textureCollection__ = __webpack_require__(\"pXNl\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__utils_makeStatCounter__ = __webpack_require__(\"V39N\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__utils_floatPacking__ = __webpack_require__(\"FaU1\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__bus__ = __webpack_require__(\"eBcr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__bus___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_7__bus__);\n\n\n\n\n\n\n\n\n\nvar particlePositionShaderCodeBuilder = new __WEBPACK_IMPORTED_MODULE_1__shaderGraph_updatePositionGraph__[\"a\" /* default */]();\n\nfunction updatePositionProgram(ctx) {\n  var gl = ctx.gl;\n  var readTextures, writeTextures;\n  var particleStateResolution;\n  var updateProgram;\n  var uniformParticleColor = { r: 77 / 255, g: 188 / 255, b: 201 / 255, a: 1 };\n  var readVelocity = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__colorProgram__[\"a\" /* default */])(ctx);\n\n  // If someone needs to get vectors out from the GPU, they send a `vector-lines-request`\n  // over the bus. This request is delayed until next compute frame. Once it is handled,\n  // we send them back response with calculated vectors.\n  var pendingVectorLines;\n\n  // TODO: need to make sure we are not leaking.\n  __WEBPACK_IMPORTED_MODULE_7__bus___default.a.on('vector-lines-request', putVectorLinesRequestIntoQueue);\n\n  return {\n    updateCode: updateCode,\n    updateParticlesPositions: updateParticlesPositions,\n    updateParticlesCount: updateParticlesCount,\n    prepareToDraw: prepareToDraw\n  };\n\n  function updateCode(vectorField) {\n    particlePositionShaderCodeBuilder.setCustomVectorField(vectorField);\n    var fragment = particlePositionShaderCodeBuilder.getFragmentShader();\n    var vertex = particlePositionShaderCodeBuilder.getVertexShader();\n\n    var newProgram = __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].createProgram(gl, vertex, fragment);\n\n    if (updateProgram) updateProgram.unload();\n    updateProgram = newProgram;\n\n    if (ctx.colorMode === __WEBPACK_IMPORTED_MODULE_2__colorModes__[\"a\" /* default */].VELOCITY) readVelocity.requestSpeedUpdate();\n  }\n\n  function updateParticlesCount(x, y) {\n    particleStateResolution = ctx.particleStateResolution;\n\n    var dimensions = [{\n      name: 'x',\n      particleState: x\n    }, {\n      name: 'y',\n      particleState: y\n    }];\n\n    if (readTextures) readTextures.dispose();\n    readTextures = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__utils_textureCollection__[\"a\" /* default */])(gl, dimensions, particleStateResolution);\n\n    if (writeTextures) writeTextures.dispose();\n    writeTextures = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__utils_textureCollection__[\"a\" /* default */])(gl, dimensions, particleStateResolution);\n\n    readVelocity.updateParticlesCount();\n  }\n\n  function prepareToDraw(program) {\n    var colorMode = ctx.colorMode;\n    if (colorMode === __WEBPACK_IMPORTED_MODULE_2__colorModes__[\"a\" /* default */].UNIFORM) gl.uniform4f(program.u_particle_color, uniformParticleColor.r, uniformParticleColor.g, uniformParticleColor.b, uniformParticleColor.a);else if (colorMode === __WEBPACK_IMPORTED_MODULE_2__colorModes__[\"a\" /* default */].VELOCITY) readVelocity.setColorMinMax(program);\n\n    readTextures.bindTextures(gl, program);\n  }\n\n  function updateParticlesPositions() {\n    var program = updateProgram;\n    gl.useProgram(program.program);\n\n    __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].bindAttribute(gl, ctx.quadBuffer, program.a_pos, 2);\n\n    ctx.inputs.updateBindings(program);\n\n    // TODO: Remove this.\n    if (ctx.audioTexture) {\n      __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].bindTexture(gl, ctx.audioTexture, 5);\n      gl.uniform1i(program['u_audio'], 5);\n    }\n\n    readTextures.bindTextures(gl, program);\n\n    gl.uniform1f(program.u_rand_seed, ctx.frameSeed);\n    gl.uniform1f(program.u_h, ctx.integrationTimeStep);\n    gl.uniform1f(program.frame, ctx.frame);\n    var cursor = ctx.cursor;\n    gl.uniform4f(program.cursor, cursor.clickX, cursor.clickY, cursor.hoverX, cursor.hoverY);\n\n    var bbox = ctx.bbox;\n    gl.uniform2f(program.u_min, bbox.minX, bbox.minY);\n    gl.uniform2f(program.u_max, bbox.maxX, bbox.maxY);\n\n    gl.uniform1f(program.u_drop_rate, ctx.dropProbability);\n\n    // Draw each coordinate individually\n    for (var i = 0; i < writeTextures.length; ++i) {\n      var writeInfo = writeTextures.get(i);\n      gl.uniform1i(program.u_out_coordinate, i);\n      __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].bindFramebuffer(gl, ctx.framebuffer, writeInfo.texture);\n      gl.viewport(0, 0, particleStateResolution, particleStateResolution);\n      gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n\n    // TODO: I think I need to keep this time-bound, i.e. allocate X ms to\n    // process particle positions, and move on. So that the rendering thread is not paused for too long\n    if (ctx.colorMode === __WEBPACK_IMPORTED_MODULE_2__colorModes__[\"a\" /* default */].VELOCITY) {\n      readVelocity.updateParticlesPositions(program);\n    }\n\n    if (pendingVectorLines) {\n      processVectorLinesRequest(program);\n      pendingVectorLines = null;\n    }\n\n    // swap the particle state textures so the new one becomes the current one\n    var temp = readTextures;\n    readTextures = writeTextures;\n    writeTextures = temp;\n  }\n\n  function putVectorLinesRequestIntoQueue(request) {\n    pendingVectorLines = request;\n  }\n\n  function processVectorLinesRequest(program) {\n    // TODO: Move this out\n    var dimensions = [{\n      name: 'x',\n      particleState: pendingVectorLines.x\n    }, {\n      name: 'y',\n      particleState: pendingVectorLines.y\n    }];\n\n    // We create temporary textures and load requested positions in there\n    var resolutionOfParticlesInRequest = pendingVectorLines.resolution;\n    var numParticles = resolutionOfParticlesInRequest * resolutionOfParticlesInRequest;\n\n    var texturesForRead = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__utils_textureCollection__[\"a\" /* default */])(gl, dimensions, resolutionOfParticlesInRequest);\n    var texturesForWrite = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__utils_textureCollection__[\"a\" /* default */])(gl, dimensions, resolutionOfParticlesInRequest);\n\n    texturesForRead.bindTextures(gl, program);\n\n    // Then we request coordinates out from GPU for each dimension\n    var writeInfo = texturesForWrite.get(0);\n    gl.uniform1i(program.u_out_coordinate, 6); // v_x\n\n    __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].bindFramebuffer(gl, ctx.framebuffer, writeInfo.texture);\n    gl.viewport(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n    var velocity_x = new Uint8Array(numParticles * 4);\n    gl.readPixels(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest, gl.RGBA, gl.UNSIGNED_BYTE, velocity_x);\n\n    gl.uniform1i(program.u_out_coordinate, 7); // v_y\n    writeInfo = texturesForWrite.get(1);\n    __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].bindFramebuffer(gl, ctx.framebuffer, writeInfo.texture);\n    gl.viewport(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n    var velocity_y = new Uint8Array(numParticles * 4);\n    gl.readPixels(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest, gl.RGBA, gl.UNSIGNED_BYTE, velocity_y);\n\n    texturesForWrite.dispose();\n    texturesForRead.dispose();\n\n    var xStats = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5__utils_makeStatCounter__[\"a\" /* default */])();\n    var yStats = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5__utils_makeStatCounter__[\"a\" /* default */])();\n\n    var decoded_velocity_x = new Float32Array(numParticles);\n    var decoded_velocity_y = new Float32Array(numParticles);\n    for (var i = 0; i < velocity_y.length; i += 4) {\n      var idx = i / 4;\n      var vx = readFloat(velocity_x, i);\n      var vy = readFloat(velocity_y, i);\n      decoded_velocity_x[idx] = vx;\n      decoded_velocity_y[idx] = vy;\n      xStats.add(vx);\n      yStats.add(vy);\n    }\n\n    var vectorLineInfo = {\n      xStats: xStats,\n      yStats: yStats,\n      decoded_velocity_x: decoded_velocity_x,\n      decoded_velocity_y: decoded_velocity_y,\n      resolution: resolutionOfParticlesInRequest\n    };\n\n    __WEBPACK_IMPORTED_MODULE_7__bus___default.a.fire('vector-line-ready', vectorLineInfo);\n  }\n}\n\nfunction readFloat(buffer, offset) {\n  return __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_6__utils_floatPacking__[\"b\" /* decodeFloatRGBA */])(buffer[offset + 0], buffer[offset + 1], buffer[offset + 2], buffer[offset + 3]);\n}\n\n/***/ }),\n\n/***/ \"4KA4\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck__ = __webpack_require__(\"Zrlr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass__ = __webpack_require__(\"wxAW\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass__);\n\n\n\nvar BaseShaderNode = function () {\n  function BaseShaderNode() {\n    __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck___default()(this, BaseShaderNode);\n  }\n\n  __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass___default()(BaseShaderNode, [{\n    key: 'getDefines',\n    value: function getDefines() {\n      return '';\n    }\n  }, {\n    key: 'getFunctions',\n    value: function getFunctions() {\n      return '';\n    }\n  }, {\n    key: 'getMainBody',\n    value: function getMainBody() {\n      return '';\n    }\n  }]);\n\n  return BaseShaderNode;\n}();\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (BaseShaderNode);\n\n/***/ }),\n\n/***/ \"5hi0\":\n/***/ (function(module, exports) {\n\n/**\n * Provides a `null` object that matches history API\n */\nmodule.exports = inMemoryHistory;\n\nfunction inMemoryHistory(defaults) {\n  var listeners = [];\n  var lastQueryObject = defaults;\n\n  return {\n    dispose: dispose,\n    onChanged: onChanged,\n    set: set,\n    get: get\n  };\n\n  function get() {\n    return lastQueryObject;\n  }\n\n  function set(newQueryObject) {\n    lastQueryObject = newQueryObject;\n    setTimeout(function() {\n      triggerChange(newQueryObject);\n    }, 0);\n  }\n\n  function dispose() {\n    listeners = [];\n  }\n\n  function onChanged(changeCallback) {\n    if (typeof changeCallback !== 'function') {\n      throw new Error('changeCallback should be a function')\n    }\n\n    listeners.push(changeCallback);\n  }\n\n  function triggerChange(appState) {\n    listeners.forEach(function(listener) {\n      listener(appState);\n    });\n  }\n}\n\n\n/***/ }),\n\n/***/ \"6c6E\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/**\n * Various color modes.\n * \n * TODO: This could be generalized by allowing custom color shader\n */\n/* harmony default export */ __webpack_exports__[\"a\"] = ({\n  /**\n   * Each particle gets its own color\n   */\n  UNIFORM: 1,\n\n  /**\n   * Color of a particle depends on its velocity\n   */\n  VELOCITY: 2,\n\n  /**\n   * Color of a particle depends on its velocity vector angle.\n   */\n  ANGLE: 3\n});\n\n/***/ }),\n\n/***/ \"7UaU\":\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * Allows application to access and update current app state via query string\n */\nmodule.exports = queryState;\n\nvar eventify = __webpack_require__(\"fkI9\");\nvar windowHistory = __webpack_require__(\"2PgA\");\n\n/**\n * Just a convenience function that returns singleton instance of a query state\n */\nqueryState.instance = instance;\n\n// this variable holds singleton instance of the query state\nvar singletonQS;\n\n/**\n * Creates new instance of the query state.\n */\nfunction queryState(defaults, options) {\n  options = options || {};\n  var history = options.history || windowHistory(defaults, options);\n  validateHistoryAPI(history);\n\n  history.onChanged(updateQuery)\n\n  var query = history.get() || Object.create(null);\n\n  var api = {\n\n    /**\n     * Gets current state.\n     *\n     * @param {string?} keyName if present then value for this key is returned.\n     * Otherwise the entire app state is returned.\n     */\n    get: getValue,\n\n    /**\n     * Merges current app state with new key/value.\n     *\n     * @param {string} key name\n     * @param {string|number|date} value\n     */\n    set: setValue,\n\n    /**\n     * Similar to `set()`, but only sets value if it was not set before.\n     *\n     * @param {string} key name\n     * @param {string|number|date} value\n     */\n    setIfEmpty: setIfEmpty,\n\n    /**\n     * Releases all resources acquired by query state. After calling this method\n     * no hash monitoring will happen and no more events will be fired.\n     */\n    dispose: dispose,\n\n    onChange: onChange,\n    offChange: offChange,\n\n    getHistoryObject: getHistoryObject,\n  }\n\n  var eventBus = eventify({});\n\n  return api;\n\n  function onChange(callback, ctx) {\n    eventBus.on('change', callback, ctx);\n  }\n\n  function offChange(callback, ctx) {\n    eventBus.off('change', callback, ctx)\n  }\n\n  function getHistoryObject() {\n    return history;\n  }\n\n  function dispose() {\n    // dispose all history listeners\n    history.dispose();\n\n    // And remove our own listeners\n    eventBus.off();\n  }\n\n  function getValue(keyName) {\n    if (keyName === undefined) return query;\n\n    return query[keyName];\n  }\n\n  function setValue(keyName, value) {\n    var keyNameType = typeof keyName;\n\n    if (keyNameType === 'object') {\n      Object.keys(keyName).forEach(function(key) {\n        query[key] = keyName[key];\n      });\n    } else if (keyNameType === 'string') {\n      query[keyName] = value;\n    }\n\n    history.set(query);\n\n    return api;\n  }\n\n  function updateQuery(newAppState) {\n    query = newAppState;\n    eventBus.fire('change', query);\n  }\n\n  function setIfEmpty(keyName, value) {\n    if (typeof keyName === 'object') {\n      Object.keys(keyName).forEach(function(key) {\n        // TODO: Can I remove code duplication? The main reason why I don't\n        // want recursion here is to avoid spamming `history.set()`\n        if (key in query) return; // key name is not empty\n\n        query[key] = keyName[key];\n      });\n    }\n\n    if (keyName in query) return; // key name is not empty\n    query[keyName] = value;\n\n    history.set(query);\n\n    return api;\n  }\n}\n\n/**\n * Returns singleton instance of the query state.\n *\n * @param {Object} defaults - if present, then it is passed to the current instance\n * of the query state. Defaults are applied only if they were not present before.\n */\nfunction instance(defaults) {\n  if (!singletonQS) {\n    singletonQS = queryState(defaults);\n  } else if (defaults) {\n    singletonQS.setIfEmpty(defaults);\n  }\n\n  return singletonQS;\n}\n\nfunction validateHistoryAPI(history) {\n  if (!history) throw new Error('history is required');\n  if (typeof history.dispose !== 'function') throw new Error('dispose is required');\n  if (typeof history.onChanged !== 'function') throw new Error('onChanged is required');\n}\n\n\n/***/ }),\n\n/***/ \"85ps\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = getParsedVectorFieldFunction;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__bus__ = __webpack_require__(\"eBcr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__bus___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__bus__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__pragmaParser__ = __webpack_require__(\"svlg\");\n/**\n * This module parses user defined vector field code.\n */\n\n\n\n\n// This is naive parser that is being used until the real `glsl-parser`\n// is loaded asynchronously. This parser assumes there are no errors\n// TODO: maybe I should be more careful here?\nvar glslParser = {\n  check: function check(code) {\n    return {\n      code: code,\n      log: {\n        errorCount: 0\n      }\n    };\n  }\n};\n\n// glsl-parser is ~179KB uncompressed, we don't want to wait until it is downloaded.\n// So we load it asynchronously...\n__webpack_require__.e/* require.ensure */(2).then((function () {\n  // ... and replace the naive parser with the real one, when ready.\n  glslParser = __webpack_require__(\"TFw8\");\n\n  // notify interested parties, so that they can recheck code if they wish.\n  __WEBPACK_IMPORTED_MODULE_0__bus___default.a.fire('glsl-parser-ready');\n}).bind(null, __webpack_require__)).catch(__webpack_require__.oe);\n\nvar vectorFieldGlobals = '\\nimport {\\n  float PI;\\n  float snoise(vec2 v);\\n  float frame;\\n  vec4 cursor;\\n  vec2 rotate(vec2 p,float a);\\n  float audio(float index);\\n  sampler2D input0;\\n  sampler2D input1;\\n}';\n\n/**\n * Given a string, verifies that it is a valid glsl code for a vector field,\n * and then returns code + log.\n * \n * @param {String} vectorFieldCode \n */\nfunction getParsedVectorFieldFunction(vectorFieldCode) {\n  // TODO: what if we want to support 3d?\n  return __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__pragmaParser__[\"a\" /* default */])(vectorFieldCode).then(function (pragmaParseResult) {\n    if (pragmaParseResult.error) {\n      return pragmaParseResult;\n    }\n\n    vectorFieldCode = pragmaParseResult.getCode();\n\n    var parserResult = glslParser.check(vectorFieldCode, { globals: vectorFieldGlobals });\n    parserResult.code = vectorFieldCode;\n\n    if (parserResult.log.errorCount) parserResult.error = parserError(parserResult.log);\n\n    return parserResult;\n  });\n}\n\nfunction parserError(log) {\n  var diag = log.diagnostics[0];\n  // TODO probably need to check kind (errors are 0, warnings are 1)\n  var firstError = diag.range;\n  var lineColumn = firstError.lineColumn();\n  var source = firstError.source;\n  var offset = source._lineOffsets[lineColumn.line];\n  var line = source.contents.substr(offset, lineColumn.column);\n  line += source.contents.substring(firstError.start, firstError.end);\n  var prefix = 'Line ' + lineColumn.line + ': ';\n  var diagText = diag.text;\n  return {\n    error: prefix + line + '\\n' + whitespace(prefix.length) + whitespace(lineColumn.column) + '^',\n    errorDetail: diagText,\n    isFloatError: isFloatError(diagText)\n  };\n}\n\nfunction isFloatError(diagText) {\n  return diagText.indexOf('\"int\"') > -1 && diagText.indexOf('\"float\"') > -1;\n}\n\nfunction whitespace(length) {\n  return new Array(length + 1).join(' ');\n}\n\n/***/ }),\n\n/***/ \"94y8\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__bus__ = __webpack_require__(\"eBcr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__bus___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__bus__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__gl_utils__ = __webpack_require__(\"Ddjs\");\n\n\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (audioProgram);\n\nfunction audioProgram(ctx) {\n  var gl = ctx.gl;\n\n  var audioWidth = 8,\n      audioHeight = 8;\n  var audioBuffer = new Uint8Array(audioWidth * audioHeight * 4);\n  var audioTexture = __WEBPACK_IMPORTED_MODULE_1__gl_utils__[\"a\" /* default */].createTexture(gl, gl.NEAREST, audioBuffer, audioWidth, audioHeight);\n  var audioDirty = false;\n  ctx.audioTexture = audioTexture;\n\n  __WEBPACK_IMPORTED_MODULE_0__bus___default.a.on('audio', updateAudioBuffer);\n\n  return {\n    updateTextures: updateTextures,\n    dispose: dispose\n  };\n\n  function dispose() {\n    __WEBPACK_IMPORTED_MODULE_0__bus___default.a.off('audio', updateAudioBuffer);\n    gl.deleteTexture(audioTexture);\n  }\n\n  function updateTextures() {\n    if (!audioDirty) return;\n    audioDirty = false;\n\n    // TODO: This should come from fftSize?\n    var width = 5,\n        height = 5;\n    gl.bindTexture(gl.TEXTURE_2D, audioTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, audioBuffer);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n  }\n\n  function updateAudioBuffer(newBuffer) {\n    audioBuffer = newBuffer;\n    audioDirty = true;\n  }\n}\n\n/***/ }),\n\n/***/ \"9XuS\":\n/***/ (function(module, exports) {\n\n/**\n * This module is similar to JSON, but it encodes/decodes in query string\n * format `key1=value1...`\n */\nmodule.exports = {\n  parse: parse,\n  stringify: stringify\n};\n\nfunction stringify(object) {\n  if (!object) return '';\n\n  return Object.keys(object).map(toPairs).join('&');\n\n  function toPairs(key) {\n    var value = object[key];\n    var pair = encodePart(key);\n    if (value !== undefined) {\n      pair += '=' + encodeValue(value);\n    }\n\n    return pair;\n  }\n}\n\nfunction parse(queryString) {\n  var query = Object.create(null);\n\n  if (!queryString) return query;\n\n  queryString.split('&').forEach(decodeRecord);\n\n  return query;\n\n  function decodeRecord(queryRecord) {\n    if (!queryRecord) return;\n\n    var pair = queryRecord.split('=');\n    query[decodeURIComponent(pair[0])] = decodeValue(pair[1]);\n  }\n}\n\nfunction encodeValue(value) {\n  // TODO: Do I need this?\n  // if (typeof value === 'string') {\n  //   if (value.match(/^(true|false)$/)) {\n  //     // special handling of strings that look like booleans\n  //     value = JSON.stringify('' + value);\n  //   } else if (value.match(/^-?\\d+\\.?\\d*$/)) {\n  //     // special handling of strings that look like numbers\n  //     value = JSON.stringify('' + value);\n  //   }\n  // }\n  if (value instanceof Date) {\n    value = value.toISOString();\n  }\n  var uriValue = encodePart(value);\n  return uriValue;\n}\n\nfunction encodePart(part) {\n  // We want to make sure that we also encode symbols like ( and ) correctly\n  var encoded = encodeURIComponent(part);\n  return encoded.replace(/[()]/g, saferEscape);\n}\n\nfunction saferEscape(character) {\n  if (character === ')') return '%29';\n  if (character === '(') return '%28';\n  return character; // What?\n}\n\n/**\n * This method returns typed value from string\n */\nfunction decodeValue(value) {\n  value = decodeURIComponent(value);\n\n  if (value === \"\") return value;\n  if (!isNaN(value)) return parseFloat(value);\n  if (isBolean(value)) return value === 'true';\n  if (isISODateString(value)) return new Date(value);\n\n  return value;\n}\n\nfunction isBolean(strValue) {\n  return strValue === 'true' || strValue === 'false';\n}\n\nfunction isISODateString(str) {\n  return str && str.match(/(\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d\\.\\d+([+-][0-2]\\d:[0-5]\\d|Z))|(\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d([+-][0-2]\\d:[0-5]\\d|Z))|(\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d([+-][0-2]\\d:[0-5]\\d|Z))/)\n}\n\n\n/***/ }),\n\n/***/ \"C8nW\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = request;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__ = __webpack_require__(\"//Fk\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__);\n\n/**\n * XMLHttpRequest wrapped into a promise.\n * \n * @param {String} url \n */\nfunction request(url, options) {\n  if (!options) options = {};\n\n  return new __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default.a(download);\n\n  function download(resolve, reject) {\n    var req = new XMLHttpRequest();\n\n    if (typeof options.progress === 'function') {\n      req.addEventListener('progress', updateProgress, false);\n    }\n\n    req.addEventListener('load', transferComplete, false);\n    req.addEventListener('error', transferFailed, false);\n    req.addEventListener('abort', transferCanceled, false);\n\n    req.open('GET', url);\n    if (options.responseType) {\n      req.responseType = options.responseType;\n    }\n    req.send(null);\n\n    function updateProgress(e) {\n      if (e.lengthComputable) {\n        options.progress({\n          loaded: e.loaded,\n          total: e.total,\n          percent: e.loaded / e.total\n        });\n      }\n    }\n\n    function transferComplete() {\n      if (req.status !== 200) {\n        reject('Unexpected status code ' + req.status + ' when calling ' + url);\n        return;\n      }\n      var response = req.response;\n\n      if (options.responseType === 'json' && typeof response === 'string') {\n        // IE\n        response = JSON.parse(response);\n      }\n\n      resolve(response);\n    }\n\n    function transferFailed() {\n      reject('Failed to download ' + url);\n    }\n\n    function transferCanceled() {\n      reject('Cancelled download of ' + url);\n    }\n  }\n}\n\n/***/ }),\n\n/***/ \"Ddjs\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/**\n * This file is based on https://github.com/mapbox/webgl-wind\n * by Vladimir Agafonkin\n * \n * Released under ISC License, Copyright (c) 2016, Mapbox\n * https://github.com/mapbox/webgl-wind/blob/master/LICENSE\n * \n * Adapted to field maps by Andrei Kashcha\n * Copyright (C) 2017\n */\n/* harmony default export */ __webpack_exports__[\"a\"] = ({\n  createTexture: createTexture,\n  bindFramebuffer: bindFramebuffer,\n  createProgram: createProgram,\n  createBuffer: createBuffer,\n  bindAttribute: bindAttribute,\n  bindTexture: bindTexture\n});\n\nfunction bindTexture(gl, texture, unit) {\n  gl.activeTexture(gl.TEXTURE0 + unit);\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n}\n\nfunction createBuffer(gl, data) {\n  var buffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n  return buffer;\n}\n\nfunction createTexture(gl, filter, data, width, height) {\n  var texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n  if (data instanceof Uint8Array) {\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, data);\n  } else {\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, data);\n  }\n  gl.bindTexture(gl.TEXTURE_2D, null);\n  return texture;\n}\n\nfunction bindFramebuffer(gl, framebuffer, texture) {\n  gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n  if (texture) {\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n  }\n}\n\nfunction bindAttribute(gl, buffer, attribute, numComponents) {\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.enableVertexAttribArray(attribute);\n  gl.vertexAttribPointer(attribute, numComponents, gl.FLOAT, false, 0, 0);\n}\n\nfunction createProgram(gl, vertexSource, fragmentSource) {\n  var program = gl.createProgram();\n\n  var vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexSource);\n  var fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentSource);\n\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n\n  gl.linkProgram(program);\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    throw new Error(gl.getProgramInfoLog(program));\n  }\n\n  var wrapper = {\n    program: program,\n    unload: unload\n  };\n\n  var numAttributes = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n  var i;\n  for (i = 0; i < numAttributes; i++) {\n    var attribute = gl.getActiveAttrib(program, i);\n    wrapper[attribute.name] = gl.getAttribLocation(program, attribute.name);\n  }\n  var numUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n  for (i = 0; i < numUniforms; i++) {\n    var uniform = gl.getActiveUniform(program, i);\n    wrapper[uniform.name] = gl.getUniformLocation(program, uniform.name);\n  }\n\n  return wrapper;\n\n  function unload() {\n    gl.deleteProgram(program);\n  }\n}\n\nfunction createShader(gl, type, source) {\n  var shader = gl.createShader(type);\n  gl.shaderSource(shader, source);\n\n  gl.compileShader(shader);\n  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n    throw new Error(gl.getShaderInfoLog(shader));\n  }\n\n  return shader;\n}\n\n/***/ }),\n\n/***/ \"DuZ1\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of__ = __webpack_require__(\"Zx67\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__ = __webpack_require__(\"Zrlr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass__ = __webpack_require__(\"wxAW\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn__ = __webpack_require__(\"zwoO\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits__ = __webpack_require__(\"Pf15\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__BaseShaderNode__ = __webpack_require__(\"4KA4\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__parts_simplex_noise__ = __webpack_require__(\"JjDM\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__customInput__ = __webpack_require__(\"bvb0\");\n\n\n\n\n\n\n\n\n\nvar UserDefinedVelocityFunction = function (_BaseShaderNode) {\n  __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits___default()(UserDefinedVelocityFunction, _BaseShaderNode);\n\n  function UserDefinedVelocityFunction(updateCode) {\n    __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default()(this, UserDefinedVelocityFunction);\n\n    var _this = __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default()(this, (UserDefinedVelocityFunction.__proto__ || __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default()(UserDefinedVelocityFunction)).call(this));\n\n    _this.updateCode = updateCode || '';\n    return _this;\n  }\n\n  __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass___default()(UserDefinedVelocityFunction, [{\n    key: 'setNewUpdateCode',\n    value: function setNewUpdateCode(newUpdateCode) {\n      this.updateCode = newUpdateCode;\n    }\n  }, {\n    key: 'getDefines',\n    value: function getDefines() {\n      return '\\nuniform float frame;\\nuniform vec4 cursor;\\n// TODO: use inputN instead.\\nuniform sampler2D u_audio;\\n\\n#define PI 3.1415926535897932384626433832795\\n\\n' + __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_7__customInput__[\"a\" /* getInputUniforms */])() + '\\n';\n    }\n  }, {\n    key: 'getFunctions',\n    value: function getFunctions() {\n      // TODO: Do I need to worry about \"glsl injection\" (i.e. is there potential for security attack?)\n      // TODO: Do I need to inject snoise only when it's used?\n      return '\\n' + __WEBPACK_IMPORTED_MODULE_6__parts_simplex_noise__[\"a\" /* default */] + '\\n\\nvec2 rotate(vec2 p,float a) {\\n\\treturn cos(a)*p+sin(a)*vec2(p.y,-p.x);\\n}\\n\\n// TODO: This will change. Don\\'t use it.\\nfloat audio(float index) {\\n  float rgbI = floor(index/4.);\\n  vec2 txPos = vec2(fract(rgbI / 5.), floor(rgbI / 5.) / 5.);\\n  vec4 rgba = texture2D(u_audio, txPos);\\n  \\n  float offset = mod(index, 4.);\\n  if (offset == 0.) return rgba[0];\\n  if (offset == 1.) return rgba[1];\\n  if (offset == 2.) return rgba[2];\\n  return rgba[3];\\n}\\n\\n' + (this.updateCode ? this.updateCode : 'vec2 get_velocity(vec2 p) { return vec2(0.); }') + '\\n  ';\n    }\n  }]);\n\n  return UserDefinedVelocityFunction;\n}(__WEBPACK_IMPORTED_MODULE_5__BaseShaderNode__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (UserDefinedVelocityFunction);\n\n/***/ }),\n\n/***/ \"FaU1\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = encodeFloatRGBA;\n/* harmony export (immutable) */ __webpack_exports__[\"b\"] = decodeFloatRGBA;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_math_log2__ = __webpack_require__(\"yI0F\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_math_log2___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_math_log2__);\n\n/**\n * This file encodes/decodes float values into 32bit rgba array\n * \n * It is based on https://computergraphics.stackexchange.com/questions/4151/webgl-packing-unpacking-functions-that-can-roundtrip-all-typical-32-bit-floats\n * and it is not perfect. If you know how to improve it - please let me know.\n */\n\n/**\n * Encodes float value into output array\n * @param {float} val - value to be encode\n * @param {Uint8Array} out  - array where encoded value needs to be written.\n * @param {Number} writeOffset - offset in the original array where values should be written.\n */\nfunction encodeFloatRGBA(val, out, writeOffset) {\n  if (val == 0.0) {\n    out[writeOffset + 0] = 0;out[writeOffset + 1] = 0;out[writeOffset + 2] = 0;out[writeOffset + 3] = 0;\n    return;\n  }\n\n  var mag = Math.abs(val);\n  var exponent = Math.floor(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_math_log2___default()(mag));\n  // Correct log2 approximation errors.\n  exponent += exp2(exponent) <= mag / 2.0 ? 1 : 0;\n  exponent -= exp2(exponent) > mag ? 1 : 0;\n\n  var mantissa;\n  if (exponent > 100.0) {\n    mantissa = mag / 1024.0 / exp2(exponent - 10.0) - 1.0;\n  } else {\n    mantissa = mag / exp2(exponent) - 1.0;\n  }\n\n  var a = exponent + 127.0;\n  mantissa *= 256.0;\n  var b = Math.floor(mantissa);\n  mantissa -= b;\n  mantissa *= 256.0;\n  var c = Math.floor(mantissa);\n  mantissa -= c;\n  mantissa *= 128.0;\n  var d = Math.floor(mantissa) * 2.0 + (val < 0.0 ? 1 : 0);\n\n  out[writeOffset + 0] = a;out[writeOffset + 1] = b;out[writeOffset + 2] = c;out[writeOffset + 3] = d;\n}\n\n/**\n * Given byte values in range [0..255] returns decoded float value.\n * \n * @param {Byte} r \n * @param {Byte} g \n * @param {Byte} b \n * @param {Byte} a \n */\nfunction decodeFloatRGBA(r, g, b, a) {\n  var A = Math.floor(r + 0.5);\n  var B = Math.floor(g + 0.5);\n  var C = Math.floor(b + 0.5);\n  var D = Math.floor(a + 0.5);\n\n  var exponent = A - 127.0;\n  var sign = 1.0 - D % 2.0 * 2.0;\n  var mantissa = (A > 0.0 ? 1 : 0) + B / 256.0 + C / 65536.0 + Math.floor(D / 2.0) / 8388608.0;\n  return sign * mantissa * exp2(exponent);\n}\n\nfunction exp2(exponent) {\n  return Math.exp(exponent * Math.LN2);\n}\n\n/***/ }),\n\n/***/ \"I6d+\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = createImageInputBinding;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__loadTexture__ = __webpack_require__(\"egvE\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__gl_utils__ = __webpack_require__(\"Ddjs\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__config__ = __webpack_require__(\"rvz5\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__bus__ = __webpack_require__(\"eBcr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__bus___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3__bus__);\n/**\n * Creates a single image binding element in the input collection.\n */\n\n\n\n\n\nvar FREE_TEXTURE_UNIT = __WEBPACK_IMPORTED_MODULE_2__config__[\"a\" /* default */].FREE_TEXTURE_UNIT;\n\nfunction createImageInputBinding(ctx, url, callbacks) {\n  var texture = null;\n  __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__loadTexture__[\"a\" /* default */])(ctx.gl, url).then(setTexture).catch(handleError);\n\n  return {\n    updateBinding: updateBinding,\n    dispose: function dispose() {\n      // TODO: Potential race condition, as loadTexture is async.\n      ctx.gl.deleteTexture(texture);\n    }\n  };\n\n  function handleError(err) {\n    if (callbacks && callbacks.error) {\n      callbacks.error(err);\n    }\n  }\n\n  function setTexture(loadedTexture) {\n    texture = loadedTexture;\n    __WEBPACK_IMPORTED_MODULE_3__bus___default.a.fire('refresh-speed');\n    if (callbacks && callbacks.done) {\n      callbacks.done(url);\n    }\n  }\n\n  function updateBinding(program, inputIndex) {\n    if (!texture) return;\n\n    var realIndex = inputIndex + FREE_TEXTURE_UNIT;\n    __WEBPACK_IMPORTED_MODULE_1__gl_utils__[\"a\" /* default */].bindTexture(ctx.gl, texture, realIndex);\n    ctx.gl.uniform1i(program['input' + inputIndex], realIndex);\n  }\n}\n\n/***/ }),\n\n/***/ \"JHsM\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = initScene;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite__ = __webpack_require__(\"AMV0\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_number_parse_float__ = __webpack_require__(\"5dBV\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_number_parse_float___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_number_parse_float__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign__ = __webpack_require__(\"woOf\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__gl_utils__ = __webpack_require__(\"Ddjs\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_panzoom__ = __webpack_require__(\"yBIK\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_panzoom___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_panzoom__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__bus__ = __webpack_require__(\"eBcr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__bus___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5__bus__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__appState__ = __webpack_require__(\"NEgR\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__wglPanZoom__ = __webpack_require__(\"p0IO\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__programs_screenProgram__ = __webpack_require__(\"h62Y\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__programs_drawParticlesProgram__ = __webpack_require__(\"pKWO\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10__utils_cursorUpdater__ = __webpack_require__(\"p9aJ\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11__editor_vectorFieldState__ = __webpack_require__(\"c5hq\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_12__createInputsModel__ = __webpack_require__(\"/eR5\");\n\n\n\n/**\n * This file is based on https://github.com/mapbox/webgl-wind\n * by Vladimir Agafonkin\n *\n * Released under ISC License, Copyright (c) 2016, Mapbox\n * https://github.com/mapbox/webgl-wind/blob/master/LICENSE\n *\n * Adapted to field maps by Andrei Kashcha\n * Copyright (C) 2017\n */\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Kicks offs the app rendering. Initialized before even vue is loaded.\n *\n * @param {WebGLRenderingContext} gl\n */\nfunction initScene(gl) {\n  // Canvas size management\n  var canvasRect = { width: 0, height: 0, top: 0, left: 0 };\n  setWidthHeight(gl.canvas.width, gl.canvas.height);\n  window.addEventListener('resize', onResize, true);\n\n  // Video capturing is available in super advanced mode. You'll need to install\n  // and start https://github.com/greggman/ffmpegserver.js\n  // Then type in the console: window.startRecord();\n  // This will trigger frame-by-frame recording (it is slow). To stop it, call window.stopRecord();\n  __WEBPACK_IMPORTED_MODULE_5__bus___default.a.on('start-record', startRecord);\n  __WEBPACK_IMPORTED_MODULE_5__bus___default.a.on('stop-record', stopRecord);\n  var currentCapturer = null;\n\n  // TODO: It feels like bounding box management needs to be moved out from here.\n  // TODO: bbox needs to be a class with width/height properties.\n  var bbox = __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].getBBox() || {};\n  var currentPanZoomTransform = {\n    scale: 1,\n    x: 0,\n    y: 0\n  };\n\n  // How many particles do we want?\n  var particleCount = __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].getParticleCount();\n\n  gl.disable(gl.DEPTH_TEST);\n  gl.disable(gl.STENCIL_TEST);\n\n  // Context variable is a way to share rendering state between multiple programs. It has a lot of stuff on it.\n  // I found that it's the easiest way to work in state-full world of WebGL.\n  // Until I discover a better way to write WebGL code.\n  var ctx = {\n    gl: gl,\n    bbox: bbox,\n    canvasRect: canvasRect,\n\n    inputs: null,\n\n    framebuffer: gl.createFramebuffer(),\n\n    // This is used only to render full-screen rectangle. Main magic happens inside textures.\n    quadBuffer: __WEBPACK_IMPORTED_MODULE_3__gl_utils__[\"a\" /* default */].createBuffer(gl, new Float32Array([0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1])),\n\n    colorMode: __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].getColorMode(),\n\n    // This defines texture unit for screen rendering. First few indices are taken by textures\n    // that compute particles position/color\n    // TODO: I need to find a better way to manage this.\n    screenTextureUnit: 3,\n\n    integrationTimeStep: __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].getIntegrationTimeStep(),\n\n    // On each frame the likelihood for a particle to reset its position is this:\n    dropProbability: __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].getDropProbability(),\n\n    // current frame number. Reset every time when new shader is compiled\n    frame: 0,\n\n    // Information about mouse cursor. Could be useful to simplify\n    // exploration\n    cursor: {\n      // Where mouse was last time clicked (or tapped)\n      clickX: 0, clickY: 0,\n      // where mouse was last time moved. If this is a touch device\n      // this is the same as clickX, clickY\n      hoverX: 0, hoverY: 0\n    },\n\n    // Texture size to store particles' positions\n    particleStateResolution: 0,\n\n    // How quickly we should fade previous frame (from 0..1)\n    fadeOpacity: __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].getFadeout(),\n\n    // Ignore this one for a moment. Yes, the app support web audio API,\n    // but it's rudimentary, so... shhh! it's a secret.\n    // Don't shhh on me!\n    audioTexture: null\n  };\n\n  // Frame management\n  var lastAnimationFrame;\n  var isPaused = false;\n\n  var inputsModel = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_12__createInputsModel__[\"a\" /* default */])(ctx);\n\n  // screen rendering;\n  var screenProgram = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_8__programs_screenProgram__[\"a\" /* default */])(ctx);\n  var drawProgram = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_9__programs_drawParticlesProgram__[\"a\" /* default */])(ctx);\n  var cursorUpdater = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_10__utils_cursorUpdater__[\"a\" /* default */])(ctx);\n  var vectorFieldEditorState = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_11__editor_vectorFieldState__[\"a\" /* default */])(drawProgram);\n\n  // particles\n  updateParticlesCount(particleCount);\n\n  var api = {\n    start: nextFrame,\n    stop: stop,\n    dispose: dispose,\n\n    resetBoundingBox: resetBoundingBox,\n    moveBoundingBox: moveBoundingBox,\n\n    setPaused: setPaused,\n\n    getParticlesCount: getParticlesCount,\n    setParticlesCount: setParticlesCount,\n\n    setFadeOutSpeed: setFadeOutSpeed,\n    getFadeOutSpeed: getFadeOutSpeed,\n\n    setDropProbability: setDropProbability,\n    getDropProbability: getDropProbability,\n\n    getIntegrationTimeStep: getIntegrationTimeStep,\n    setIntegrationTimeStep: setIntegrationTimeStep,\n\n    setColorMode: setColorMode,\n    getColorMode: getColorMode,\n\n    vectorFieldEditorState: vectorFieldEditorState,\n\n    inputsModel: inputsModel,\n\n    getCanvasRect: function getCanvasRect() {\n      // We trust they don't do anything bad with this ...\n      return canvasRect;\n    },\n    getBoundingBox: function getBoundingBox() {\n      // again, we trust. Maybe to much?\n      return ctx.bbox;\n    }\n  };\n\n  var panzoom = initPanzoom();\n  restoreBBox();\n\n  setTimeout(function () {\n    __WEBPACK_IMPORTED_MODULE_5__bus___default.a.fire('scene-ready', api);\n  });\n\n  return api;\n\n  function moveBoundingBox(changes) {\n    if (!changes) return;\n    var parsedBoundingBox = __WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_assign___default()({}, ctx.bbox);\n\n    assignIfPossible(changes, 'minX', parsedBoundingBox);\n    assignIfPossible(changes, 'minY', parsedBoundingBox);\n    assignIfPossible(changes, 'maxX', parsedBoundingBox);\n    assignIfPossible(changes, 'maxY', parsedBoundingBox);\n\n    // for Y axis changes we need to preserve aspect ration, which means\n    // we also need to change X...\n    if (changes.minY !== undefined || changes.maxY !== undefined) {\n      // adjust values for X\n      var heightChange = Math.abs(parsedBoundingBox.minY - parsedBoundingBox.maxY) / Math.abs(ctx.bbox.minY - ctx.bbox.maxY);\n      var cx = (ctx.bbox.maxX + ctx.bbox.minX) / 2;\n      var prevWidth = (ctx.bbox.maxX - ctx.bbox.minX) / 2;\n      parsedBoundingBox.minX = cx - prevWidth * heightChange;\n      parsedBoundingBox.maxX = cx + prevWidth * heightChange;\n    }\n\n    applyBoundingBox(parsedBoundingBox);\n  }\n\n  function assignIfPossible(change, key, newBoundingBox) {\n    var value = __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_number_parse_float___default()(change[key]);\n    if (__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite___default()(value)) {\n      newBoundingBox[key] = value;\n    }\n  }\n\n  function startRecord(capturer) {\n    currentCapturer = capturer;\n  }\n\n  function stopRecord() {\n    currentCapturer = null;\n  }\n\n  function setColorMode(x) {\n    var mode = parseInt(x, 10);\n    __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].setColorMode(mode);\n    ctx.colorMode = __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].getColorMode();\n    drawProgram.updateColorMode(mode);\n  }\n\n  function getColorMode() {\n    return __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].getColorMode();\n  }\n\n  function getIntegrationTimeStep() {\n    return __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].getIntegrationTimeStep();\n  }\n\n  function setIntegrationTimeStep(x) {\n    var f = parseFloat(x);\n    if (__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite___default()(f)) {\n      ctx.integrationTimeStep = f;\n      __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].setIntegrationTimeStep(f);\n      __WEBPACK_IMPORTED_MODULE_5__bus___default.a.fire('integration-timestep-changed', f);\n    }\n  }\n\n  function setPaused(shouldPause) {\n    isPaused = shouldPause;\n    nextFrame();\n  }\n\n  // Main screen fade out configuration\n  function setFadeOutSpeed(x) {\n    var f = parseFloat(x);\n    if (__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite___default()(f)) {\n      ctx.fadeOpacity = f;\n      __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].setFadeout(f);\n    }\n  }\n\n  function getFadeOutSpeed() {\n    return __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].getFadeout();\n  }\n\n  // Number of particles configuration\n  function getParticlesCount() {\n    return __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].getParticleCount();\n  }\n\n  function setParticlesCount(newParticleCount) {\n    if (!__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite___default()(newParticleCount)) return;\n    if (newParticleCount === particleCount) return;\n    if (newParticleCount < 1) return;\n\n    updateParticlesCount(newParticleCount);\n\n    particleCount = newParticleCount;\n    __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].setParticleCount(newParticleCount);\n  }\n\n  // drop probability\n  function setDropProbability(x) {\n    var f = parseFloat(x);\n    if (__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite___default()(f)) {\n      // TODO: Do I need to worry about duplication/clamping?\n      __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].setDropProbability(f);\n      ctx.dropProbability = f;\n    }\n  }\n\n  function getDropProbability() {\n    return __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].getDropProbability();\n  }\n\n  function onResize() {\n    setWidthHeight(window.innerWidth, window.innerHeight);\n\n    screenProgram.updateScreenTextures();\n\n    updateBoundingBox(currentPanZoomTransform);\n  }\n\n  function setWidthHeight(w, h) {\n    var dx = Math.max(w * 0.02, 30);\n    var dy = Math.max(h * 0.02, 30);\n    canvasRect.width = w + 2 * dx;\n    canvasRect.height = h + 2 * dy;\n    canvasRect.top = -dy;\n    canvasRect.left = -dx;\n\n    var canvas = gl.canvas;\n    canvas.width = canvasRect.width;\n    canvas.height = canvasRect.height;\n    canvas.style.left = -dx + 'px';\n    canvas.style.top = -dy + 'px';\n  }\n\n  function dispose() {\n    stop();\n    panzoom.dispose();\n    window.removeEventListener('resize', onResize, true);\n    cursorUpdater.dispose();\n    vectorFieldEditorState.dispose();\n  }\n\n  function nextFrame() {\n    if (lastAnimationFrame) return;\n\n    if (isPaused) return;\n\n    lastAnimationFrame = requestAnimationFrame(draw);\n  }\n\n  function stop() {\n    cancelAnimationFrame(lastAnimationFrame);\n    lastAnimationFrame = 0;\n  }\n\n  function draw() {\n    lastAnimationFrame = 0;\n\n    drawScreen();\n\n    if (currentCapturer) currentCapturer.capture(gl.canvas);\n\n    nextFrame();\n  }\n\n  function drawScreen() {\n    screenProgram.fadeOutLastFrame();\n    drawProgram.drawParticles();\n    screenProgram.renderCurrentScreen();\n    drawProgram.updateParticlesPositions();\n  }\n\n  function updateParticlesCount(numParticles) {\n    // we create a square texture where each pixel will hold a particle position encoded as RGBA\n    ctx.particleStateResolution = Math.ceil(Math.sqrt(numParticles));\n    drawProgram.updateParticlesCount();\n  }\n\n  function initPanzoom() {\n    var initializedPanzoom = __WEBPACK_IMPORTED_MODULE_4_panzoom___default()(gl.canvas, {\n      realPinch: true,\n      zoomSpeed: 0.025,\n      controller: __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_7__wglPanZoom__[\"a\" /* default */])(gl.canvas, updateBoundingBox)\n    });\n\n    return initializedPanzoom;\n  }\n\n  function restoreBBox() {\n    var savedBBox = __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].getBBox();\n    var width = canvasRect.width,\n        height = canvasRect.height;\n\n\n    var sX = Math.PI * Math.E;\n    var sY = Math.PI * Math.E;\n    var tX = 0;\n    var tY = 0;\n    if (savedBBox) {\n      sX = savedBBox.maxX - savedBBox.minX;\n      sY = savedBBox.maxY - savedBBox.minY;\n      // TODO: Not sure if this is really the best way to do it.\n      // var ar = width/height;\n      tX = width * (savedBBox.minX + savedBBox.maxX) / 2;\n      tY = width * (savedBBox.minY + savedBBox.maxY) / 2;\n    }\n\n    var w2 = sX * width / 2;\n    var h2 = sY * height / 2;\n    panzoom.showRectangle({\n      left: -w2 + tX,\n      top: -h2 - tY,\n      right: w2 + tX,\n      bottom: h2 - tY\n    });\n  }\n\n  function updateBoundingBox(transform) {\n    screenProgram.boundingBoxUpdated = true;\n\n    currentPanZoomTransform.x = transform.x;\n    currentPanZoomTransform.y = transform.y;\n    currentPanZoomTransform.scale = transform.scale;\n\n    var width = canvasRect.width,\n        height = canvasRect.height;\n\n\n    var minX = clientX(0);\n    var minY = clientY(0);\n    var maxX = clientX(width);\n    var maxY = clientY(height);\n\n    // we divide by width to keep aspect ratio\n    // var ar = width/height;\n    var p = 10000;\n    bbox.minX = Math.round(p * minX / width) / p;\n    bbox.minY = Math.round(p * -minY / width) / p;\n    bbox.maxX = Math.round(p * maxX / width) / p;\n    bbox.maxY = Math.round(p * -maxY / width) / p;\n\n    __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].saveBBox(bbox);\n\n    __WEBPACK_IMPORTED_MODULE_5__bus___default.a.fire('bbox-change', bbox);\n\n    function clientX(x) {\n      return (x - transform.x) / transform.scale;\n    }\n\n    function clientY(y) {\n      return (y - transform.y) / transform.scale;\n    }\n  }\n\n  function resetBoundingBox() {\n    var w = Math.PI * Math.E * 0.5;\n    var h = Math.PI * Math.E * 0.5;\n\n    applyBoundingBox({\n      minX: -w,\n      minY: -h,\n      maxX: w,\n      maxY: h\n    });\n  }\n\n  function applyBoundingBox(boundingBox) {\n    __WEBPACK_IMPORTED_MODULE_6__appState__[\"a\" /* default */].saveBBox(boundingBox, /* immediate = */true);\n    restoreBBox();\n    // a hack to trigger panzoom event\n    panzoom.moveBy(0, 0, false);\n  }\n}\n\n/***/ }),\n\n/***/ \"JjDM\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\nvar code = \"\\nvec3 mod289(vec3 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec2 mod289(vec2 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec3 permute(vec3 x) {\\n  return mod289(((x*34.0)+1.0)*x);\\n}\\n\\nfloat snoise(vec2 v)\\n  {\\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\\n                      0.024390243902439); // 1.0 / 41.0\\n// First corner\\n  vec2 i  = floor(v + dot(v, C.yy) );\\n  vec2 x0 = v -   i + dot(i, C.xx);\\n\\n// Other corners\\n  vec2 i1;\\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\\n  //i1.y = 1.0 - i1.x;\\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\\n  // x1 = x0 - i1 + 1.0 * C.xx ;\\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\\n  vec4 x12 = x0.xyxy + C.xxzz;\\n  x12.xy -= i1;\\n\\n// Permutations\\n  i = mod289(i); // Avoid truncation effects in permutation\\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\\n\\t\\t+ i.x + vec3(0.0, i1.x, 1.0 ));\\n\\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\\n  m = m*m ;\\n  m = m*m ;\\n\\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\\n\\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\\n  vec3 h = abs(x) - 0.5;\\n  vec3 ox = floor(x + 0.5);\\n  vec3 a0 = x - ox;\\n\\n// Normalise gradients implicitly by scaling m\\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\\n\\n// Compute final noise value at P\\n  vec3 g;\\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\\n  return 130.0 * dot(m, g);\\n}\\n\";\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (code);\n\n/***/ }),\n\n/***/ \"NEgR\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite__ = __webpack_require__(\"AMV0\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_query_state__ = __webpack_require__(\"7UaU\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_query_state___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_query_state__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__bus__ = __webpack_require__(\"eBcr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__bus___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2__bus__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__programs_colorModes__ = __webpack_require__(\"6c6E\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__wrapVectorField__ = __webpack_require__(\"cj2E\");\n\n\n\n\n\n\n/**\n * The state of the fieldplay is stored in the query string. This is the\n * only place where query string can be manipulated or fetched.\n */\n\nvar qs = __WEBPACK_IMPORTED_MODULE_1_query_state___default()({}, {\n  useSearch: true,\n  // Older version of the app used hash to store application arguments.\n  // Turns out hash is not good for websites like reddit. They can block\n  // url, saying \"url was already submitted\" if the only part that is different\n  // is hash. So, we switch to search string, and maintain backward compatibility\n  // for fields created before.\n  rewriteHashToSearch: true\n});\n\nvar currentState = qs.get();\n\nvar defaultVectorField = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__wrapVectorField__[\"a\" /* default */])('v.x = 0.1 * p.y;\\n  v.y = -0.2 * p.y;');\n\nvar pendingSave;\nvar defaults = {\n  timeStep: 0.01,\n  dropProbability: 0.009,\n  particleCount: 10000,\n  fadeout: .998,\n  colorMode: __WEBPACK_IMPORTED_MODULE_3__programs_colorModes__[\"a\" /* default */].UNIFORM\n};\n\nvar settingsPanel = {\n  collapsed: window.innerWidth < 600 ? true : false\n};\n\n/* harmony default export */ __webpack_exports__[\"a\"] = ({\n  settingsPanel: settingsPanel,\n  saveBBox: saveBBox,\n  getBBox: getBBox,\n  getQS: function getQS() {\n    return qs;\n  },\n\n  saveCode: saveCode,\n  getCode: getCode,\n  getDefaultCode: getDefaultCode,\n\n  getDropProbability: getDropProbability,\n  setDropProbability: setDropProbability,\n\n  getIntegrationTimeStep: getIntegrationTimeStep,\n  setIntegrationTimeStep: setIntegrationTimeStep,\n\n  getParticleCount: getParticleCount,\n  setParticleCount: setParticleCount,\n\n  getFadeout: getFadeout,\n  setFadeout: setFadeout,\n\n  getColorMode: getColorMode,\n  setColorMode: setColorMode\n});\n\nqs.onChange(function () {\n  __WEBPACK_IMPORTED_MODULE_2__bus___default.a.fire('scene-ready', window.scene);\n});\n\nfunction getColorMode() {\n  var colorMode = qs.get('cm');\n  return defined(colorMode) ? colorMode : defaults.colorMode;\n}\n\nfunction setColorMode(colorMode) {\n  if (!defined(colorMode)) return;\n  qs.set({ cm: colorMode });\n  currentState.cm = colorMode;\n}\n\nfunction getFadeout() {\n  var fadeout = qs.get('fo');\n  return defined(fadeout) ? fadeout : defaults.fadeout;\n}\n\nfunction setFadeout(fadeout) {\n  if (!defined(fadeout)) return;\n  qs.set({ fo: fadeout });\n  currentState.fo = fadeout;\n}\n\nfunction getParticleCount() {\n  var particleCount = qs.get('pc');\n  return defined(particleCount) ? particleCount : defaults.particleCount;\n}\n\nfunction setParticleCount(particleCount) {\n  if (!defined(particleCount)) return;\n  qs.set({ pc: particleCount });\n  currentState.pc = particleCount;\n}\n\nfunction getIntegrationTimeStep() {\n  var timeStep = qs.get('dt');\n  return defined(timeStep) ? timeStep : defaults.timeStep;\n}\n\nfunction setIntegrationTimeStep(dt) {\n  if (!defined(dt)) return;\n  qs.set({ dt: dt });\n  currentState.dt = dt;\n}\n\nfunction getDropProbability() {\n  var dropProbability = qs.get('dp');\n  return defined(dropProbability) ? dropProbability : defaults.dropProbability;\n}\n\nfunction setDropProbability(dropProbability) {\n  if (!defined(dropProbability)) return;\n  clamp(dropProbability, 0, 1);\n  qs.set({ dp: dropProbability });\n}\n\nfunction getBBox() {\n  var cx = qs.get('cx');\n  var cy = qs.get('cy');\n  var w = qs.get('w');\n  var h = qs.get('h');\n\n  var bboxDefined = defined(cx) && defined(cy) && defined(w) && defined(h);\n  if (!bboxDefined) return;\n\n  var w2 = w / 2;\n  var h2 = h / 2;\n  var p = 10000;\n  return {\n    minX: Math.round(p * (cx - w2)) / p,\n    maxX: Math.round(p * (cx + w2)) / p,\n    minY: Math.round(p * (cy - h2)) / p,\n    maxY: Math.round(p * (cy + h2)) / p\n  };\n}\n\nfunction saveBBox(bbox) {\n  var immediate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  if (pendingSave) {\n    clearTimeout(pendingSave);\n    pendingSave = 0;\n  }\n\n  if (immediate) saveReally(bbox);else {\n    pendingSave = setTimeout(function () {\n      return saveReally(bbox);\n    }, 300);\n  }\n}\n\nfunction saveReally(bbox) {\n  pendingSave = 0;\n  var bbox = {\n    cx: (bbox.minX + bbox.maxX) * 0.5,\n    cy: (bbox.minY + bbox.maxY) * 0.5,\n    w: bbox.maxX - bbox.minX,\n    h: bbox.maxX - bbox.minX\n  };\n\n  if (bbox.w <= 0 || bbox.h <= 0) return;\n\n  qs.set(bbox);\n\n  currentState.cx = bbox.cx;\n  currentState.cy = bbox.cy;\n  currentState.w = bbox.w;\n  currentState.h = bbox.h;\n}\n\nfunction getCode() {\n  var vfCode = qs.get('vf');\n  if (vfCode) return vfCode;\n\n  // If we didn't get code yet, let's try read to read it from previous version\n  // of the API.\n  // TODO: Need to figure out how to develop this in backward/future compatible way.\n  var oldCode = qs.get('code');\n  if (oldCode) {\n    vfCode = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__wrapVectorField__[\"a\" /* default */])(oldCode);\n    // side effect - let's clean the old URL\n    delete currentState.code;\n    qs.set('vf', vfCode);\n    return vfCode;\n  }\n\n  return defaultVectorField;\n}\n\nfunction getDefaultCode() {\n  return defaultVectorField;\n}\n\nfunction saveCode(code) {\n  qs.set({\n    vf: code\n  });\n  currentState.code = code;\n}\n\nfunction defined(number) {\n  return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_number_is_finite___default()(number);\n}\n\nfunction clamp(x, min, max) {\n  return x < min ? min : x > max ? max : x;\n}\n\n/***/ }),\n\n/***/ \"Qv35\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of__ = __webpack_require__(\"Zx67\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_possibleConstructorReturn__ = __webpack_require__(\"zwoO\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_possibleConstructorReturn___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_possibleConstructorReturn__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_inherits__ = __webpack_require__(\"Pf15\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_inherits___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_inherits__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck__ = __webpack_require__(\"Zrlr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass__ = __webpack_require__(\"wxAW\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__BaseShaderNode__ = __webpack_require__(\"4KA4\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__TexturePositionNode__ = __webpack_require__(\"XMEc\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__renderNodes__ = __webpack_require__(\"S+/9\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__UserDefinedVelocityFunction__ = __webpack_require__(\"DuZ1\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__PanzoomTransform__ = __webpack_require__(\"vhRe\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10__RungeKuttaIntegrator__ = __webpack_require__(\"i69e\");\n\n\n\n\n\n\n\n\n\n\n\n\nvar UpdatePositionGraph = function () {\n  function UpdatePositionGraph(options) {\n    __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck___default()(this, UpdatePositionGraph);\n\n    this.readStoredPosition = new __WEBPACK_IMPORTED_MODULE_6__TexturePositionNode__[\"a\" /* default */]( /* isDecode = */true);\n    this.udfVelocity = new __WEBPACK_IMPORTED_MODULE_8__UserDefinedVelocityFunction__[\"a\" /* default */]();\n    this.integratePositions = new __WEBPACK_IMPORTED_MODULE_10__RungeKuttaIntegrator__[\"a\" /* default */]();\n    this.dropParticles = new RandomParticleDropper();\n    this.writeComputedPosition = new __WEBPACK_IMPORTED_MODULE_6__TexturePositionNode__[\"a\" /* default */]( /* isDecode = */false);\n    this.panZoomDecode = new __WEBPACK_IMPORTED_MODULE_9__PanzoomTransform__[\"a\" /* default */]({ decode: true });\n    this.panZoomEncode = new __WEBPACK_IMPORTED_MODULE_9__PanzoomTransform__[\"a\" /* default */]({ decode: false });\n\n    this.colorMode = options && options.colorMode;\n  }\n\n  __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass___default()(UpdatePositionGraph, [{\n    key: 'setCustomVectorField',\n    value: function setCustomVectorField(velocityCode) {\n      this.udfVelocity.setNewUpdateCode(velocityCode);\n    }\n  }, {\n    key: 'getVertexShader',\n    value: function getVertexShader() {\n      return 'precision highp float;\\n\\nattribute vec2 a_pos;\\nvarying vec2 v_tex_pos;\\nuniform vec2 u_min;\\nuniform vec2 u_max;\\n\\nvoid main() {\\n    v_tex_pos = a_pos;\\n    gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\\n}';\n    }\n  }, {\n    key: 'getFragmentShader',\n    value: function getFragmentShader() {\n      var nodes = [this.readStoredPosition, this.dropParticles, this.udfVelocity, this.integratePositions, {\n        getMainBody: function getMainBody() {\n          return '\\n  vec2 newPos = pos + velocity;\\n  ';\n        }\n      }, this.writeComputedPosition];\n      return __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_7__renderNodes__[\"a\" /* default */])(nodes);\n    }\n  }]);\n\n  return UpdatePositionGraph;\n}();\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (UpdatePositionGraph);\n\nvar RandomParticleDropper = function (_BaseShaderNode) {\n  __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_inherits___default()(RandomParticleDropper, _BaseShaderNode);\n\n  function RandomParticleDropper() {\n    __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck___default()(this, RandomParticleDropper);\n\n    return __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_possibleConstructorReturn___default()(this, (RandomParticleDropper.__proto__ || __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default()(RandomParticleDropper)).apply(this, arguments));\n  }\n\n  __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass___default()(RandomParticleDropper, [{\n    key: 'getDefines',\n    value: function getDefines() {\n      return '\\nuniform float u_drop_rate;\\nuniform float u_rand_seed;\\nuniform vec2 u_min;\\nuniform vec2 u_max;\\n';\n    }\n  }, {\n    key: 'getFunctions',\n    value: function getFunctions() {\n      // TODO: Ideally this node should probably depend on\n      // random number generator node, so that we don't duplicate code\n      return '\\n// pseudo-random generator\\nconst vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\\nfloat rand(const vec2 co) {\\n    float t = dot(rand_constants.xy, co);\\n    return fract(sin(t) * (rand_constants.z + t));\\n}\\n';\n    }\n  }, {\n    key: 'getMainBody',\n    value: function getMainBody() {\n      return '\\n  // a random seed to use for the particle drop\\n  vec2 seed = (pos + v_tex_pos) * u_rand_seed;\\n  // drop rate is a chance a particle will restart at random position, to avoid degeneration\\n  float drop = step(1.0 - u_drop_rate, rand(seed));\\n\\n  // TODO: This can be customized to produce various emitters\\n  // random_pos is in range from 0..1, we move it to the bounding box:\\n  vec2 random_pos = vec2(rand(seed + 1.9), rand(seed + 8.4)) * (u_max - u_min) + u_min;\\n  pos = mix(pos, random_pos, drop);\\n';\n    }\n  }]);\n\n  return RandomParticleDropper;\n}(__WEBPACK_IMPORTED_MODULE_5__BaseShaderNode__[\"a\" /* default */]);\n\n/***/ }),\n\n/***/ \"S+/9\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = renderNodes;\n\nfunction renderNodes(nodes) {\n  var code = [];\n\n  nodes.forEach(function (node) {\n    if (node.getDefines) addToCode(node.getDefines());\n  });\n  nodes.forEach(function (node) {\n    if (node.getFunctions) addToCode(node.getFunctions());\n  });\n\n  addToCode('void main() {');\n  nodes.forEach(function (node) {\n    if (node.getMainBody) addToCode(node.getMainBody());\n  });\n  addToCode('}');\n  return code.join('\\n');\n\n  function addToCode(line) {\n    if (line) code.push(line);\n  }\n}\n\n/***/ }),\n\n/***/ \"V39N\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = makeStatCounter;\n/**\n * A simple interface to compute eventual min/max \n */\nfunction makeStatCounter() {\n  var min, max;\n\n  var api = {\n    getMin: function getMin() {\n      return min;\n    },\n    getMax: function getMax() {\n      return max;\n    },\n    add: function add(x) {\n      if (x < min) min = x;\n      if (x > max) max = x;\n    },\n\n    reset: reset\n  };\n\n  return api;\n\n  function reset() {\n    min = Number.POSITIVE_INFINITY;\n    max = Number.NEGATIVE_INFINITY;\n  }\n}\n\n/***/ }),\n\n/***/ \"XFig\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/**\n * A shader function to decode rgba encoded color into float position.\n */\nvar code = \"\\nhighp float decodeFloatRGBA( vec4 v ) {\\n  float a = floor(v.r * 255.0 + 0.5);\\n  float b = floor(v.g * 255.0 + 0.5);\\n  float c = floor(v.b * 255.0 + 0.5);\\n  float d = floor(v.a * 255.0 + 0.5);\\n\\n  float exponent = a - 127.0;\\n  float sign = 1.0 - mod(d, 2.0)*2.0;\\n  float mantissa = float(a > 0.0)\\n                  + b / 256.0\\n                  + c / 65536.0\\n                  + floor(d / 2.0) / 8388608.0;\\n  return sign * mantissa * exp2(exponent);\\n}\\n\";\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (code);\n\n/***/ }),\n\n/***/ \"XMEc\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of__ = __webpack_require__(\"Zx67\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__ = __webpack_require__(\"Zrlr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass__ = __webpack_require__(\"wxAW\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn__ = __webpack_require__(\"zwoO\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits__ = __webpack_require__(\"Pf15\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__BaseShaderNode__ = __webpack_require__(\"4KA4\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__parts_encodeFloatRGBA__ = __webpack_require__(\"a8s+\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__parts_decodeFloatRGBA__ = __webpack_require__(\"XFig\");\n\n\n\n\n\n\n\n\n\n/**\n * Reads/writes particle coordinates from/to a texture;\n */\n\nvar TexturePosition = function (_BaseShaderNode) {\n  __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits___default()(TexturePosition, _BaseShaderNode);\n\n  function TexturePosition(isDecode) {\n    __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default()(this, TexturePosition);\n\n    // When it's decoding, it must read from the texture.\n    // Otherwise it must write to the texture;\n    var _this = __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default()(this, (TexturePosition.__proto__ || __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default()(TexturePosition)).call(this));\n\n    _this.isDecode = isDecode;\n    return _this;\n  }\n\n  __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass___default()(TexturePosition, [{\n    key: 'getFunctions',\n    value: function getFunctions() {\n      if (this.isDecode) {\n        return '\\n    ' + __WEBPACK_IMPORTED_MODULE_6__parts_encodeFloatRGBA__[\"a\" /* default */] + '\\n    ' + __WEBPACK_IMPORTED_MODULE_7__parts_decodeFloatRGBA__[\"a\" /* default */] + '\\n';\n      }\n    }\n  }, {\n    key: 'getDefines',\n    value: function getDefines() {\n      if (this.isDecode) {\n        // TODO: How to avoid duplication and silly checks?\n        return '\\nprecision highp float;\\n\\nuniform sampler2D u_particles_x;\\nuniform sampler2D u_particles_y;\\n\\n// Which coordinate needs to be printed onto the texture\\nuniform int u_out_coordinate;\\n\\nvarying vec2 v_tex_pos;\\n';\n      }\n    }\n  }, {\n    key: 'getMainBody',\n    value: function getMainBody() {\n      if (this.isDecode) {\n        return '\\n   vec2 pos = vec2(\\n     decodeFloatRGBA(texture2D(u_particles_x, v_tex_pos)),\\n     decodeFloatRGBA(texture2D(u_particles_y, v_tex_pos))\\n   );\\n';\n      }\n      return '\\n    if (u_out_coordinate == 0) gl_FragColor = encodeFloatRGBA(newPos.x);\\n    else if (u_out_coordinate == 1) gl_FragColor = encodeFloatRGBA(newPos.y);\\n    else if (u_out_coordinate == 6) gl_FragColor = encodeFloatRGBA(get_velocity(pos).x);\\n    else if (u_out_coordinate == 7) gl_FragColor = encodeFloatRGBA(get_velocity(pos).y);\\n';\n    }\n  }]);\n\n  return TexturePosition;\n}(__WEBPACK_IMPORTED_MODULE_5__BaseShaderNode__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (TexturePosition);\n\n/***/ }),\n\n/***/ \"YJWA\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__scene__ = __webpack_require__(\"JHsM\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__bus__ = __webpack_require__(\"eBcr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__bus___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1__bus__);\n/**\n * The main entry point to the application.\n * \n * It is initialized immediately with webgl, and puts\n * vue.js app loading into the future.\n */\n\n\n\nvar canvas = document.getElementById('scene');\n// Canvas may not be available in test run\nif (canvas) initVectorFieldApp(canvas);\n\n// Tell webpack to split bundle, and download settings UI later.\n__webpack_require__.e/* require.ensure */(0).then((function () {\n  // Settings UI is ready, initialize vue.js application\n  __webpack_require__(\"WOBu\");\n}).bind(null, __webpack_require__)).catch(__webpack_require__.oe);\n\nfunction initVectorFieldApp(canvas) {\n  canvas.width = window.innerWidth;\n  canvas.height = window.innerHeight;\n  var ctxOptions = { antialiasing: false };\n\n  var gl = canvas.getContext('webgl', ctxOptions) || canvas.getContext('experimental-webgl', ctxOptions);\n\n  if (gl) {\n    window.webGLEnabled = true;\n    var scene = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__scene__[\"a\" /* default */])(gl);\n    scene.start();\n    window.scene = scene;\n  } else {\n    window.webGLEnabled = false;\n  }\n}\n\nvar CCapture;\nvar currentCapturer;\n\nwindow.startRecord = startRecord;\nwindow.isRecording = false;\n\nfunction startRecord(url) {\n  if (!CCapture) {\n    __webpack_require__.e/* require.ensure */(1).then((function () {\n      CCapture = __webpack_require__(\"nI+d\");\n      window.stopRecord = stopRecord;\n      startRecord(url);\n    }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);\n\n    return;\n  }\n\n  if (currentCapturer) {\n    currentCapturer.stop();\n  }\n\n  if (!ffmpegScriptLoaded()) {\n    var ffmpegServer = document.createElement('script');\n    ffmpegServer.setAttribute('src', url || 'http://localhost:8080/ffmpegserver/ffmpegserver.js');\n    ffmpegServer.onload = function () {\n      return startRecord(url);\n    };\n    document.head.appendChild(ffmpegServer);\n    return;\n  }\n\n  currentCapturer = new CCapture({\n    format: 'ffmpegserver',\n    framerate: 60,\n    verbose: true,\n    name: \"fieldplay\",\n    extension: \".mp4\",\n    codec: \"mpeg4\",\n    ffmpegArguments: [\"-b:v\", \"12M\"]\n  });\n\n  window.isRecording = true;\n  currentCapturer.start();\n  __WEBPACK_IMPORTED_MODULE_1__bus___default.a.fire('start-record', currentCapturer);\n}\n\nfunction ffmpegScriptLoaded() {\n  return typeof FFMpegServer !== 'undefined';\n}\n\nfunction stopRecord() {\n  window.isRecording = false;\n  __WEBPACK_IMPORTED_MODULE_1__bus___default.a.fire('stop-record', currentCapturer);\n  currentCapturer.stop();\n  currentCapturer.save();\n}\n\n/***/ }),\n\n/***/ \"a8s+\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nvar code = \"\\nvec4 encodeFloatRGBA(highp float val) {\\n    if (val == 0.0) {\\n        return vec4(0.0, 0.0, 0.0, 0.0);\\n    }\\n\\n    float mag = abs(val);\\n    float exponent = floor(log2(mag));\\n    // Correct log2 approximation errors.\\n    exponent += float(exp2(exponent) <= mag / 2.0);\\n    exponent -= float(exp2(exponent) > mag);\\n\\n    float mantissa;\\n    if (exponent > 100.0) {\\n        // Not sure why this needs to be done in two steps for the largest float to work.\\n        // Best guess is the optimizer rewriting '/ exp2(e)' into '* exp2(-e)',\\n        // but exp2(-128.0) is too small to represent.\\n        mantissa = mag / 1024.0 / exp2(exponent - 10.0) - 1.0;\\n    } else {\\n        mantissa = mag / float(exp2(exponent)) - 1.0;\\n    }\\n\\n    float a = exponent + 127.0;\\n    mantissa *= 256.0;\\n    float b = floor(mantissa);\\n    mantissa -= b;\\n    mantissa *= 256.0;\\n    float c = floor(mantissa);\\n    mantissa -= c;\\n    mantissa *= 128.0;\\n    float d = floor(mantissa) * 2.0 + float(val < 0.0);\\n    return vec4(a, b, c, d) / 255.0;\\n}\\n\";\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (code);\n\n/***/ }),\n\n/***/ \"aZPT\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck__ = __webpack_require__(\"Zrlr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass__ = __webpack_require__(\"wxAW\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__parts_decodeFloatRGBA__ = __webpack_require__(\"XFig\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__shaderBasedColor__ = __webpack_require__(\"c5NW\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__programs_colorModes__ = __webpack_require__(\"6c6E\");\n\n\n\n\n\n\n// TODO: this duplicates code from texture position.\n\nvar DrawParticleGraph = function () {\n  function DrawParticleGraph(colorMode) {\n    __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_classCallCheck___default()(this, DrawParticleGraph);\n\n    this.colorMode = colorMode;\n    this.isUniformColor = colorMode === __WEBPACK_IMPORTED_MODULE_4__programs_colorModes__[\"a\" /* default */].UNIFORM;\n  }\n\n  __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_createClass___default()(DrawParticleGraph, [{\n    key: 'getFragmentShader',\n    value: function getFragmentShader() {\n      var variables = [];\n      var mainBody = [];\n\n      if (this.isUniformColor) {\n        // uniform color comes via uniform setting\n        variables.push('uniform vec4 u_particle_color;');\n        mainBody.push('gl_FragColor = u_particle_color;');\n      } else {\n        // Otherwise it comes from a vertex shader\n        variables.push('varying vec4 v_particle_color;');\n        mainBody.push('gl_FragColor = v_particle_color;');\n      }\n      return 'precision highp float;\\n' + variables.join('\\n') + '\\n\\nvoid main() {\\n' + mainBody.join('\\n') + '\\n}';\n    }\n  }, {\n    key: 'getVertexShader',\n    value: function getVertexShader(vfCode) {\n      var decodePositions = textureBasedPosition();\n      var colorParts = this.isUniformColor ? uniformColor() : __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__shaderBasedColor__[\"a\" /* default */])(this.colorMode, vfCode);\n      var methods = [];\n      addMethods(decodePositions, methods);\n      addMethods(colorParts, methods);\n      var main = [];\n      addMain(decodePositions, main);\n      addMain(colorParts, main);\n\n      return 'precision highp float;\\nattribute float a_index;\\nuniform float u_particles_res;\\nuniform vec2 u_min;\\nuniform vec2 u_max;\\n\\n' + (decodePositions.getVariables() || '') + '\\n' + (colorParts.getVariables() || '') + '\\n\\n' + __WEBPACK_IMPORTED_MODULE_2__parts_decodeFloatRGBA__[\"a\" /* default */] + '\\n\\n' + methods.join('\\n') + '\\n\\nvoid main() {\\n  vec2 txPos = vec2(\\n        fract(a_index / u_particles_res),\\n        floor(a_index / u_particles_res) / u_particles_res);\\n  gl_PointSize = 1.0;\\n\\n' + main.join('\\n') + '\\n\\n  vec2 du = (u_max - u_min);\\n  v_particle_pos = (v_particle_pos - u_min)/du;\\n  gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, (1. - 2. * (v_particle_pos.y)),  0., 1.);\\n}';\n    }\n  }]);\n\n  return DrawParticleGraph;\n}();\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (DrawParticleGraph);\n\n\nfunction addMethods(producer, array) {\n  if (producer.getMethods) {\n    array.push(producer.getMethods());\n  }\n}\nfunction addMain(producer, array) {\n  if (producer.getMain) {\n    array.push(producer.getMain());\n  }\n}\n\nfunction uniformColor() {\n  return {\n    getVariables: function getVariables() {},\n    getMain: function getMain() {}\n  };\n}\n\nfunction textureBasedPosition() {\n  return {\n    getVariables: getVariables,\n    getMain: getMain\n  };\n\n  function getVariables() {\n    return '\\nuniform sampler2D u_particles_x;\\nuniform sampler2D u_particles_y;\\n    ';\n  }\n\n  function getMain() {\n    return '\\n  vec2 v_particle_pos = vec2(\\n    decodeFloatRGBA(texture2D(u_particles_x, txPos)),\\n    decodeFloatRGBA(texture2D(u_particles_y, txPos))\\n  );\\n';\n  }\n}\n\n/***/ }),\n\n/***/ \"bvb0\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = getInputUniforms;\nfunction getInputUniforms() {\n  return \"uniform sampler2D input0;\\nuniform sampler2D input1;\";\n}\n\n/***/ }),\n\n/***/ \"c5NW\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = shaderBasedColor;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__UserDefinedVelocityFunction__ = __webpack_require__(\"DuZ1\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__RungeKuttaIntegrator__ = __webpack_require__(\"i69e\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__programs_colorModes__ = __webpack_require__(\"6c6E\");\n\n\n\n\nfunction shaderBasedColor(colorMode, vfCode) {\n  var udf = new __WEBPACK_IMPORTED_MODULE_0__UserDefinedVelocityFunction__[\"a\" /* default */](vfCode);\n  var integrate = new __WEBPACK_IMPORTED_MODULE_1__RungeKuttaIntegrator__[\"a\" /* default */]();\n\n  return {\n    getVariables: getVariables,\n    getMain: getMain,\n    getMethods: getMethods\n  };\n\n  function getVariables() {\n    return '\\nuniform vec2 u_velocity_range;\\nvarying vec4 v_particle_color;\\n' + udf.getDefines() + '\\n' + integrate.getDefines() + '\\n';\n  }\n\n  function getMethods() {\n    return '\\n// https://github.com/hughsk/glsl-hsv2rgb\\nvec3 hsv2rgb(vec3 c) {\\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\\n}\\n\\n' + udf.getFunctions() + '\\n' + integrate.getFunctions() + '\\n';\n  }\n\n  function getMain() {\n    // TODO: This needs to be refactored. I don't like code duplication.\n    var setParticleColor = void 0;\n    if (colorMode === __WEBPACK_IMPORTED_MODULE_2__programs_colorModes__[\"a\" /* default */].VELOCITY) {\n      setParticleColor = '\\n  float speed = (length(velocity) - u_velocity_range[0])/(u_velocity_range[1] - u_velocity_range[0]);\\n  v_particle_color = vec4(hsv2rgb(vec3(0.05 + (1. - speed) * 0.5, 0.9, 1.)), 1.0);\\n';\n    } else {\n      setParticleColor = '\\n  float speed = (atan(velocity.y, velocity.x) + PI)/(2.0 * PI);\\n  v_particle_color = vec4(hsv2rgb(vec3(speed, 0.9, 1.)), 1.0);\\n';\n    }\n\n    return '\\nvec2 velocity = get_velocity(v_particle_pos);\\n' + setParticleColor + '\\n';\n  }\n}\n\n/***/ }),\n\n/***/ \"c5hq\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = createVectorFieldEditorState;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__bus__ = __webpack_require__(\"eBcr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__bus___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__bus__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__appState__ = __webpack_require__(\"NEgR\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__getParsedVectorFieldFunction__ = __webpack_require__(\"85ps\");\n\n\n\n\n/**\n * A text editor state for the vector field equation. Manages vector field\n * program compilation and error reporting state.\n *\n * @param {Object} drawProgram \n */\nfunction createVectorFieldEditorState(drawProgram) {\n  __WEBPACK_IMPORTED_MODULE_0__bus___default.a.on('glsl-parser-ready', parseCode);\n  var currentVectorFieldVersion = 0;\n\n  // What is the current code?\n  var currentVectorFieldCode = __WEBPACK_IMPORTED_MODULE_1__appState__[\"a\" /* default */].getCode();\n\n  // For delayed parsing result verification (e.g. when vue is loaded it\n  // can request us to see if there were any errors)\n  var parserResult;\n\n  loadCodeFromAppState();\n\n  var api = {\n    getCode: getCode,\n    setCode: setCode,\n    dispose: dispose,\n\n    // These properties are for UI only\n    code: currentVectorFieldCode,\n    error: '',\n    errorDetail: '',\n    isFloatError: false\n  };\n\n  return api;\n\n  function dispose() {\n    __WEBPACK_IMPORTED_MODULE_0__bus___default.a.off('glsl-parser-ready', parseCode);\n  }\n\n  function getCode() {\n    return __WEBPACK_IMPORTED_MODULE_1__appState__[\"a\" /* default */].getCode();\n  }\n\n  function setCode(vectorFieldCode) {\n    if (vectorFieldCode === currentVectorFieldCode) {\n      // If field hasn't changed, let's make sure that there was no previous\n      // error\n      if (parserResult && parserResult.error) {\n        // And if there was error, let's revalidate code:\n        parseCode();\n      }\n      return;\n    }\n\n    trySetNewCode(vectorFieldCode).then(function (result) {\n      if (result.cancelled) return;\n\n      if (result && result.error) {\n        updateErrorInfo(result.error);\n        return result;\n      }\n\n      currentVectorFieldCode = vectorFieldCode;\n      api.code = vectorFieldCode;\n      __WEBPACK_IMPORTED_MODULE_1__appState__[\"a\" /* default */].saveCode(vectorFieldCode);\n    });\n  }\n\n  function updateErrorInfo(parserResult) {\n    if (parserResult && parserResult.error) {\n      api.error = parserResult.error;\n      api.errorDetail = parserResult.errorDetail;\n      api.isFloatError = parserResult.isFloatError;\n    } else {\n      api.error = '';\n      api.errorDetail = '';\n      api.isFloatError = false;\n    }\n  }\n\n  function loadCodeFromAppState() {\n    var persistedCode = __WEBPACK_IMPORTED_MODULE_1__appState__[\"a\" /* default */].getCode();\n    if (persistedCode) {\n      trySetNewCode(persistedCode).then(function (result) {\n        if (!result.error) return; // This means we set correctly;\n        // If we get here - something went wrong. see the console\n        console.error('Failed to restore previous vector field: ', result.error);\n        // Let's use default vector field\n        trySetNewCode(__WEBPACK_IMPORTED_MODULE_1__appState__[\"a\" /* default */].getDefaultCode());\n      });\n    } else {\n      // we want a default vector field\n      trySetNewCode(__WEBPACK_IMPORTED_MODULE_1__appState__[\"a\" /* default */].getDefaultCode());\n    }\n  }\n\n  function parseCode(customCode) {\n    return __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__getParsedVectorFieldFunction__[\"a\" /* default */])(customCode || currentVectorFieldCode).then(function (currentResult) {\n      parserResult = currentResult;\n      updateErrorInfo(parserResult.error);\n      return parserResult;\n    });\n  }\n\n  function trySetNewCode(vectorFieldCode) {\n    currentVectorFieldVersion += 1;\n    var capturedVersion = currentVectorFieldVersion;\n    // step 1 - run through parser\n    return parseCode(vectorFieldCode).then(function (parserResult) {\n      if (capturedVersion !== currentVectorFieldVersion) {\n        parserResult.cancelled = true;\n        // a newer request was issued. Ignore these results.\n        return parserResult;\n      }\n\n      if (parserResult.error) {\n        return parserResult;\n      }\n      // step 2 - run through real webgl\n      try {\n        drawProgram.updateCode(parserResult.code);\n        return parserResult;\n      } catch (e) {\n        return {\n          error: {\n            error: e.message\n          }\n        };\n      }\n    });\n  }\n}\n\n/***/ }),\n\n/***/ \"cj2E\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = wrapVectorField;\n/**\n * Wraps a simple vector field string into our default shader code.\n * @param {String} field \n */\nfunction wrapVectorField(field) {\n  return \"// p.x and p.y are current coordinates\\n// v.x and v.y is a velocity at point p\\nvec2 get_velocity(vec2 p) {\\n  vec2 v = vec2(0., 0.);\\n\\n  // change this to get a new vector field\\n  \" + field + \"\\n\\n  return v;\\n}\";\n}\n\n/***/ }),\n\n/***/ \"eBcr\":\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * A simple message bus. Facilitates uncoupled communication between\n * components of fieldplay.\n */\nvar eventify = __webpack_require__(\"puH/\");\n\nmodule.exports = eventify({});\n\n/***/ }),\n\n/***/ \"egvE\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = loadTexture;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__ = __webpack_require__(\"//Fk\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__);\n\n// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Tutorial/Using_textures_in_WebGL\nfunction loadTexture(gl, url) {\n  var resolveTexture, rejectTexture;\n\n  var image = new Image();\n  image.crossOrigin = '';\n\n  image.onload = bindTexture;\n  image.onerror = reportError;\n  image.src = url;\n\n  return new __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default.a(function (resolve, reject) {\n    resolveTexture = resolve;\n    rejectTexture = reject;\n  });\n\n  function reportError(err) {\n    rejectTexture(err);\n  }\n\n  function bindTexture() {\n    var texture = gl.createTexture();\n    var level = 0;\n    var internalFormat = gl.RGBA;\n    var srcFormat = gl.RGBA;\n    var srcType = gl.UNSIGNED_BYTE;\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, srcFormat, srcType, image);\n\n    if (isPowerOf2(image.width) && isPowerOf2(image.height)) {\n      gl.generateMipmap(gl.TEXTURE_2D);\n    } else {\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    }\n\n    resolveTexture(texture);\n  }\n}\n\nfunction isPowerOf2(value) {\n  return (value & value - 1) == 0;\n}\n\n/***/ }),\n\n/***/ \"fkI9\":\n/***/ (function(module, exports) {\n\nmodule.exports = function(subject) {\n  validateSubject(subject);\n\n  var eventsStorage = createEventsStorage(subject);\n  subject.on = eventsStorage.on;\n  subject.off = eventsStorage.off;\n  subject.fire = eventsStorage.fire;\n  return subject;\n};\n\nfunction createEventsStorage(subject) {\n  // Store all event listeners to this hash. Key is event name, value is array\n  // of callback records.\n  //\n  // A callback record consists of callback function and its optional context:\n  // { 'eventName' => [{callback: function, ctx: object}] }\n  var registeredEvents = Object.create(null);\n\n  return {\n    on: function (eventName, callback, ctx) {\n      if (typeof callback !== 'function') {\n        throw new Error('callback is expected to be a function');\n      }\n      var handlers = registeredEvents[eventName];\n      if (!handlers) {\n        handlers = registeredEvents[eventName] = [];\n      }\n      handlers.push({callback: callback, ctx: ctx});\n\n      return subject;\n    },\n\n    off: function (eventName, callback) {\n      var wantToRemoveAll = (typeof eventName === 'undefined');\n      if (wantToRemoveAll) {\n        // Killing old events storage should be enough in this case:\n        registeredEvents = Object.create(null);\n        return subject;\n      }\n\n      if (registeredEvents[eventName]) {\n        var deleteAllCallbacksForEvent = (typeof callback !== 'function');\n        if (deleteAllCallbacksForEvent) {\n          delete registeredEvents[eventName];\n        } else {\n          var callbacks = registeredEvents[eventName];\n          for (var i = 0; i < callbacks.length; ++i) {\n            if (callbacks[i].callback === callback) {\n              callbacks.splice(i, 1);\n            }\n          }\n        }\n      }\n\n      return subject;\n    },\n\n    fire: function (eventName) {\n      var callbacks = registeredEvents[eventName];\n      if (!callbacks) {\n        return subject;\n      }\n\n      var fireArguments;\n      if (arguments.length > 1) {\n        fireArguments = Array.prototype.splice.call(arguments, 1);\n      }\n      for(var i = 0; i < callbacks.length; ++i) {\n        var callbackInfo = callbacks[i];\n        callbackInfo.callback.apply(callbackInfo.ctx, fireArguments);\n      }\n\n      return subject;\n    }\n  };\n}\n\nfunction validateSubject(subject) {\n  if (!subject) {\n    throw new Error('Eventify cannot use falsy object as events subject');\n  }\n  var reservedWords = ['on', 'fire', 'off'];\n  for (var i = 0; i < reservedWords.length; ++i) {\n    if (subject.hasOwnProperty(reservedWords[i])) {\n      throw new Error(\"Subject cannot be eventified, since it already has property '\" + reservedWords[i] + \"'\");\n    }\n  }\n}\n\n\n/***/ }),\n\n/***/ \"gIFv\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = colorProgram;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__gl_utils__ = __webpack_require__(\"Ddjs\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__bus__ = __webpack_require__(\"eBcr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__bus___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1__bus__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__utils_floatPacking__ = __webpack_require__(\"FaU1\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__utils_makeStatCounter__ = __webpack_require__(\"V39N\");\n\n\n\n\n\nvar OUT_V_X = 6;\nvar OUT_V_Y = 7;\n/**\n * This program allows to change color of each particle. It works by\n * reading current velocities into a texture from the framebuffer. Once\n * velocities are read, it checks velocity scale and passes it to a draw program.\n */\nfunction colorProgram(ctx) {\n  var speedNeedsUpdate = true;\n  var gl = ctx.gl;\n\n  var velocity_y_texture, velocity_x_texture;\n  var particleStateResolution;\n  var pendingSpeedUpdate;\n  var numParticles;\n  var velocityCounter = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__utils_makeStatCounter__[\"a\" /* default */])();\n  var velocity_x;\n  var velocity_y;\n\n  listenToEvents();\n\n  return {\n    updateCode: updateCode,\n    updateParticlesPositions: updateParticlesPositions,\n    updateParticlesCount: updateParticlesCount,\n    setColorMinMax: setColorMinMax,\n    requestSpeedUpdate: requestSpeedUpdate,\n    dispose: dispose\n  };\n\n  function listenToEvents() {\n    __WEBPACK_IMPORTED_MODULE_1__bus___default.a.on('integration-timestep-changed', requestSpeedUpdate);\n    __WEBPACK_IMPORTED_MODULE_1__bus___default.a.on('bbox-change', requestSpeedUpdate);\n    __WEBPACK_IMPORTED_MODULE_1__bus___default.a.on('refresh-speed', requestSpeedUpdate);\n  }\n\n  function dispose() {\n    __WEBPACK_IMPORTED_MODULE_1__bus___default.a.off('integration-timestep-changed', requestSpeedUpdate);\n    __WEBPACK_IMPORTED_MODULE_1__bus___default.a.off('bbox-change', requestSpeedUpdate);\n    __WEBPACK_IMPORTED_MODULE_1__bus___default.a.off('refresh-speed', requestSpeedUpdate);\n    disposeTextures();\n  }\n\n  function disposeTextures() {\n    if (velocity_x_texture) gl.deleteTexture(velocity_x_texture);\n    if (velocity_y_texture) gl.deleteTexture(velocity_y_texture);\n  }\n\n  function requestSpeedUpdate() {\n    if (pendingSpeedUpdate) clearTimeout(pendingSpeedUpdate);\n    pendingSpeedUpdate = setTimeout(function () {\n      speedNeedsUpdate = true;\n      pendingSpeedUpdate = 0;\n    }, 50);\n  }\n\n  function setColorMinMax(program) {\n    gl.uniform2f(program.u_velocity_range, velocityCounter.getMin(), velocityCounter.getMax());\n  }\n\n  function updateParticlesCount() {\n    disposeTextures();\n\n    particleStateResolution = ctx.particleStateResolution;\n    numParticles = particleStateResolution * particleStateResolution;\n\n    velocity_x = new Uint8Array(numParticles * 4);\n    velocity_y = new Uint8Array(numParticles * 4);\n    velocity_x_texture = __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].createTexture(gl, gl.NEAREST, velocity_x, particleStateResolution, particleStateResolution);\n    velocity_y_texture = __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].createTexture(gl, gl.NEAREST, velocity_y, particleStateResolution, particleStateResolution);\n\n    requestSpeedUpdate();\n  }\n\n  function updateCode() {\n    requestSpeedUpdate();\n  }\n\n  function updateParticlesPositions(program) {\n    if (!speedNeedsUpdate || !velocity_x || !velocity_y) return;\n    speedNeedsUpdate = false;\n\n    // We assume this is called from update position program\n    __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].bindFramebuffer(gl, ctx.framebuffer, velocity_x_texture);\n    gl.uniform1i(program.u_out_coordinate, OUT_V_X);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    gl.readPixels(0, 0, particleStateResolution, particleStateResolution, gl.RGBA, gl.UNSIGNED_BYTE, velocity_x);\n\n    __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].bindFramebuffer(gl, ctx.framebuffer, velocity_y_texture);\n    gl.uniform1i(program.u_out_coordinate, OUT_V_Y);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    gl.readPixels(0, 0, particleStateResolution, particleStateResolution, gl.RGBA, gl.UNSIGNED_BYTE, velocity_y);\n\n    updateMinMax();\n  }\n\n  function updateMinMax() {\n    velocityCounter.reset();\n    // TODO: Do I want this to be async?\n    for (var i = 0; i < velocity_y.length; i += 4) {\n      var vx = readFloat(velocity_x, i);\n      var vy = readFloat(velocity_y, i);\n      var v = Math.sqrt(vx * vx + vy * vy);\n      velocityCounter.add(v);\n    }\n  }\n}\n\nfunction readFloat(buffer, offset) {\n  return __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__utils_floatPacking__[\"b\" /* decodeFloatRGBA */])(buffer[offset + 0], buffer[offset + 1], buffer[offset + 2], buffer[offset + 3]);\n}\n\n/***/ }),\n\n/***/ \"h62Y\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = makeScreenProgram;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__gl_utils__ = __webpack_require__(\"Ddjs\");\n/**\n * Renders computed state onto the screen.\n */\n\n\nvar NO_TRANSFORM = { dx: 0, dy: 0, scale: 1 };\n\nfunction makeScreenProgram(ctx) {\n  var gl = ctx.gl,\n      canvasRect = ctx.canvasRect;\n\n\n  var screenTexture, backgroundTexture;\n  var boundBoxTextureTransform = { dx: 0, dy: 0, scale: 1 };\n  var lastRenderedBoundingBox = null;\n\n  // TODO: Allow customization? Last time I tried, I didn't like it too much.\n  // It was very easy to screw up the design, and the tool looked ugly :-/\n  var backgroundColor = { r: 19 / 255, g: 41 / 255, b: 79 / 255, a: 1 };\n\n  updateScreenTextures();\n  var screenProgram = __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].createProgram(gl, getScreenVertexShader(), getScreenFragmentShader());\n\n  var api = {\n    fadeOutLastFrame: fadeOutLastFrame,\n    renderCurrentScreen: renderCurrentScreen,\n    updateScreenTextures: updateScreenTextures,\n\n    boundingBoxUpdated: false\n  };\n\n  return api;\n\n  function fadeOutLastFrame() {\n    // render to the frame buffer\n    __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].bindFramebuffer(gl, ctx.framebuffer, screenTexture);\n    gl.viewport(0, 0, canvasRect.width, canvasRect.height);\n\n    if (api.boundingBoxUpdated && lastRenderedBoundingBox) {\n      // We move the back texture, relative to the bounding box change. This eliminates\n      // particle train artifacts, though, not all of them: https://computergraphics.stackexchange.com/questions/5754/fading-particles-and-transition\n      // If you know how to improve this - please let me know.\n      boundBoxTextureTransform.dx = -(ctx.bbox.minX - lastRenderedBoundingBox.minX) / (ctx.bbox.maxX - ctx.bbox.minX);\n      boundBoxTextureTransform.dy = -(ctx.bbox.minY - lastRenderedBoundingBox.minY) / (ctx.bbox.maxY - ctx.bbox.minY);\n      boundBoxTextureTransform.scale = (ctx.bbox.maxX - ctx.bbox.minX) / (lastRenderedBoundingBox.maxX - lastRenderedBoundingBox.minX);\n      drawTexture(backgroundTexture, ctx.fadeOpacity, boundBoxTextureTransform);\n    } else {\n      drawTexture(backgroundTexture, ctx.fadeOpacity, NO_TRANSFORM);\n    }\n  }\n\n  function renderCurrentScreen() {\n    __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].bindFramebuffer(gl, null);\n\n    saveLastBbox();\n\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    gl.clearColor(backgroundColor.r, backgroundColor.g, backgroundColor.b, backgroundColor.a);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    drawTexture(screenTexture, 1.0, NO_TRANSFORM);\n    gl.disable(gl.BLEND);\n\n    var temp = backgroundTexture;\n    backgroundTexture = screenTexture;\n    screenTexture = temp;\n\n    api.boundingBoxUpdated = false;\n    if (window.audioTexture) {\n      drawTexture(window.audioTexture, 1.0, NO_TRANSFORM);\n    }\n  }\n\n  function updateScreenTextures() {\n    var width = canvasRect.width,\n        height = canvasRect.height;\n\n    var emptyPixels = new Uint8Array(width * height * 4);\n    if (screenTexture) {\n      gl.deleteTexture(screenTexture);\n    }\n    if (backgroundTexture) {\n      gl.deleteTexture(backgroundTexture);\n    }\n\n    screenTexture = __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].createTexture(gl, gl.NEAREST, emptyPixels, width, height);\n    backgroundTexture = __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].createTexture(gl, gl.NEAREST, emptyPixels, width, height);\n  }\n\n  function saveLastBbox() {\n    if (!lastRenderedBoundingBox) {\n      lastRenderedBoundingBox = {\n        minX: ctx.bbox.minX,\n        minY: ctx.bbox.minY,\n        maxX: ctx.bbox.maxX,\n        maxY: ctx.bbox.maxY\n      };\n\n      return;\n    }\n\n    lastRenderedBoundingBox.minX = ctx.bbox.minX;\n    lastRenderedBoundingBox.minY = ctx.bbox.minY;\n    lastRenderedBoundingBox.maxX = ctx.bbox.maxX;\n    lastRenderedBoundingBox.maxY = ctx.bbox.maxY;\n  }\n\n  function drawTexture(texture, opacity, textureTransform) {\n    var program = screenProgram;\n    gl.useProgram(program.program);\n    __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].bindAttribute(gl, ctx.quadBuffer, program.a_pos, 2);\n\n    // TODO: This index is very fragile. I need to find a way\n    __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].bindTexture(gl, texture, ctx.screenTextureUnit);\n    gl.uniform1i(program.u_screen, ctx.screenTextureUnit);\n\n    gl.uniform1f(program.u_opacity_border, 0.02);\n    gl.uniform1f(program.u_opacity, opacity);\n    gl.uniform3f(program.u_transform, textureTransform.dx, textureTransform.dy, textureTransform.scale);\n\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n}\n\nfunction getScreenVertexShader() {\n  return '// screen program\\nprecision highp float;\\n\\nattribute vec2 a_pos;\\nvarying vec2 v_tex_pos;\\nuniform vec3 u_transform;\\n\\nvoid main() {\\n    v_tex_pos = a_pos;\\n    vec2 pos = a_pos;\\n\\n    // This transformation tries to move texture (raster) to the approximate position\\n    // of particles on the current frame. This is needed to avoid rendering artifacts\\n    // during pan/zoom: https://computergraphics.stackexchange.com/questions/5754/fading-particles-and-transition\\n\\n    // PS: I must admit, I wrote this formula through sweat and tears, and\\n    // I still have no idea why I don\\'t need to apply (pos.y - 0.5) to Y coordinate.\\n    // Is it because I use aspect ratio for bounding box?\\n    pos.x = (pos.x - 0.5) / u_transform.z - u_transform.x + 0.5 * u_transform.z;\\n    pos.y = pos.y / u_transform.z + u_transform.y;\\n\\n    pos = 1.0 - 2.0 * pos;\\n    gl_Position = vec4(pos, 0, 1);\\n}';\n}\n\nfunction getScreenFragmentShader() {\n  return 'precision highp float;\\nuniform sampler2D u_screen;\\nuniform float u_opacity;\\nuniform float u_opacity_border;\\n\\nvarying vec2 v_tex_pos;\\n\\nvoid main() {\\n  vec2 p = 1.0 - v_tex_pos;\\n  vec4 color = texture2D(u_screen, p);\\n\\n  // For some reason particles near border leave trace when we translate the texture\\n  // This is my dirty hack to fix it: https://computergraphics.stackexchange.com/questions/5754/fading-particles-and-transition\\n  if (p.x < u_opacity_border || p.x > 1. - u_opacity_border || p.y < u_opacity_border || p.y > 1. - u_opacity_border) {\\n    gl_FragColor = vec4(0.);\\n  } else {\\n    // opacity fade out even with a value close to 0.0\\n    gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\\n  }\\n}';\n}\n\n/***/ }),\n\n/***/ \"i69e\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of__ = __webpack_require__(\"Zx67\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__ = __webpack_require__(\"Zrlr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass__ = __webpack_require__(\"wxAW\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn__ = __webpack_require__(\"zwoO\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits__ = __webpack_require__(\"Pf15\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__BaseShaderNode__ = __webpack_require__(\"4KA4\");\n\n\n\n\n\n\n\nvar RungeKuttaIntegrator = function (_BaseShaderNode) {\n  __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits___default()(RungeKuttaIntegrator, _BaseShaderNode);\n\n  function RungeKuttaIntegrator() {\n    __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default()(this, RungeKuttaIntegrator);\n\n    return __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default()(this, (RungeKuttaIntegrator.__proto__ || __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default()(RungeKuttaIntegrator)).call(this));\n  }\n\n  __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass___default()(RungeKuttaIntegrator, [{\n    key: 'getDefines',\n    value: function getDefines() {\n      return '\\nuniform float u_h;\\n';\n    }\n  }, {\n    key: 'getFunctions',\n    value: function getFunctions() {\n      return '\\nvec2 rk4(const vec2 point) {\\n  vec2 k1 = get_velocity( point );\\n  vec2 k2 = get_velocity( point + k1 * u_h * 0.5);\\n  vec2 k3 = get_velocity( point + k2 * u_h * 0.5);\\n  vec2 k4 = get_velocity( point + k3 * u_h);\\n\\n  return k1 * u_h / 6. + k2 * u_h/3. + k3 * u_h/3. + k4 * u_h/6.;\\n}';\n    }\n  }, {\n    key: 'getMainBody',\n    value: function getMainBody() {\n      return '\\n  vec2 velocity = rk4(pos);\\n';\n    }\n  }]);\n\n  return RungeKuttaIntegrator;\n}(__WEBPACK_IMPORTED_MODULE_5__BaseShaderNode__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (RungeKuttaIntegrator);\n\n/***/ }),\n\n/***/ \"iw7m\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = fetchGLSL;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__ = __webpack_require__(\"//Fk\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_map__ = __webpack_require__(\"ifoU\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_map___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_map__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__utils_request__ = __webpack_require__(\"C8nW\");\n\n\nvar loadedLinks = new __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_map___default.a(); // from link to response\n\n\nfunction fetchGLSL(link) {\n  if (!link) return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default.a.reject('Missing link');\n  var trimmed = link.trim();\n  if (!trimmed) return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default.a.reject('Missing link');\n\n  var cachedResponse = loadedLinks.get(trimmed);\n  if (cachedResponse) return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default.a.resolve(cachedResponse);\n\n  return __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__utils_request__[\"a\" /* default */])(link).then(function (code) {\n    loadedLinks.set(link, code);\n    return code;\n  });\n}\n\n/***/ }),\n\n/***/ \"n67P\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = createInputCollection;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_map__ = __webpack_require__(\"ifoU\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_map___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_map__);\n\n/**\n * Collection of input bindings. Individual program works with this collection\n * to command it update texture bindings.\n */\nfunction createInputCollection() {\n  var boundInputs = new __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_map___default.a();\n  var currentProgram;\n  return {\n    updateBindings: updateBindings,\n    bindInput: bindInput\n  };\n\n  function bindInput(inputIndex, inputBinding) {\n    var prevBinding = boundInputs.get(inputIndex);\n    if (prevBinding) {\n      prevBinding.dispose();\n    }\n    boundInputs.set(inputIndex, inputBinding);\n  }\n\n  function updateBindings(program) {\n    currentProgram = program;\n    boundInputs.forEach(updateInputBinding);\n  }\n\n  function updateInputBinding(input, inputIndex) {\n    input.updateBinding(currentProgram, inputIndex);\n  }\n}\n\n/***/ }),\n\n/***/ \"p0IO\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = wglPanZoom;\n/**\n * Enables panning and zooming of canvas with vector field\n * \n * @param {HTMLCanvasElement} canvas that needs to be panned and zoomed\n * @param {*} updateBoundingBoxCallback callback that is called when vector field bounding box\n * needs to be updated\n */\nfunction wglPanZoom(canvas, updateBoundingBoxCallback) {\n  var lastDx = 0;\n  var lastDy = 0;\n  var lastScale = 1;\n\n  // We need to be moved at least this many pixels in order to let\n  // transform update bounding box.\n  var transformThreshold = 2.1;\n\n  return {\n    applyTransform: function applyTransform(newTransform) {\n      var dx = newTransform.x;\n      var dy = newTransform.y;\n\n      var dScale = lastScale - newTransform.scale;\n      if (dScale === 0 && Math.abs(dx - lastDx) < transformThreshold && Math.abs(dy - lastDy) < transformThreshold) {\n        // Wait for larger transform\n        return;\n      }\n\n      lastDx = dx;\n      lastDy = dy;\n      lastScale = newTransform.scale;\n\n      updateBoundingBoxCallback(newTransform);\n    },\n    getOwner: function getOwner() {\n      return canvas;\n    }\n  };\n}\n\n/***/ }),\n\n/***/ \"p2DF\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* unused harmony export default */\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__config__ = __webpack_require__(\"rvz5\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__gl_utils__ = __webpack_require__(\"Ddjs\");\n\n\n\nfunction createVideoInput(ctx, url) {\n  var playing = false;\n  var timeupdate = false;\n  var copyVideo = false;\n\n  var video = setupVideo();\n  var currentFrame = createTexture();\n\n  return {\n    updateBinding: updateBinding,\n    dispose: dispose\n  };\n\n  function updateBinding(program, inputIndex) {\n    var realIndex = inputIndex + __WEBPACK_IMPORTED_MODULE_0__config__[\"a\" /* default */].FREE_TEXTURE_UNIT;\n    __WEBPACK_IMPORTED_MODULE_1__gl_utils__[\"a\" /* default */].bindTexture(ctx.gl, currentFrame, realIndex);\n    if (copyVideo) updateTexture(ctx.gl);\n    ctx.gl.uniform1i(program['input' + inputIndex], realIndex);\n  }\n\n  function updateTexture(gl) {\n    var level = 0;\n    var internalFormat = gl.RGBA;\n    var srcFormat = gl.RGBA;\n    var srcType = gl.UNSIGNED_BYTE;\n    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, srcFormat, srcType, video);\n  }\n\n  function createTexture() {\n    var gl = ctx.gl;\n    var texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    var level = 0;\n    var internalFormat = gl.RGBA;\n    var width = 1;\n    var height = 1;\n    var border = 0;\n    var srcFormat = gl.RGBA;\n    var srcType = gl.UNSIGNED_BYTE;\n    var pixel = new Uint8Array([0, 0, 255, 255]);\n    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, width, height, border, srcFormat, srcType, pixel);\n\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\n    return texture;\n  }\n  function dispose() {\n    video.removeEventListener('playing', onPlaying, true);\n    video.removeEventListener('timeupdate', onTimeUpdate, true);\n  }\n\n  function setupVideo() {\n    var video = document.createElement('video');\n    video.crossOrigin = '';\n    video.autoplay = true;\n    video.muted = true;\n    video.loop = true;\n\n    // Waiting for these 2 events ensures there is data in the video\n    video.addEventListener('playing', onPlaying, true);\n    video.addEventListener('timeupdate', onTimeUpdate, true);\n\n    video.src = url;\n    video.play();\n\n    return video;\n  }\n\n  function checkReady() {\n    if (playing && timeupdate) {\n      copyVideo = true;\n    }\n  }\n  function onPlaying() {\n    playing = true;\n    checkReady();\n  }\n\n  function onTimeUpdate() {\n    timeupdate = true;\n    checkReady();\n  }\n}\n\n/***/ }),\n\n/***/ \"p9aJ\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = createCursorUpdater;\n/**\n * This module allows to pass mouse coordinates down to the shader. Coordinates\n * will be available as `vec4 cursor` variable, where `xy` are the last\n * click position, and `zw` are the last hover position.\n * \n * Note: On Touch devices hover is the same click.\n * \n * Hopefully this will enables easier exploration\n */\nfunction createCursorUpdater(ctx) {\n  var canvasRect = ctx.canvasRect,\n      bbox = ctx.bbox;\n\n\n  window.addEventListener('mousemove', onMouseMove, true);\n  window.addEventListener('mousedown', onMouseClick, true);\n  window.addEventListener('touchstart', onTouchStart, true);\n  window.addEventListener('touchmove', onTouchMove, true);\n\n  return {\n    dispose: dispose\n  };\n\n  function dispose() {\n    window.removeEventListener('mousemove', onMouseMove, true);\n    window.removeEventListener('mousedown', onMouseClick, true);\n    window.removeEventListener('touchstart', onTouchStart, true);\n    window.removeEventListener('touchmove', onTouchMove, true);\n  }\n\n  function onTouchStart(e) {\n    var firstTouch = e.touches[0];\n    if (!firstTouch) return;\n\n    setClick(firstTouch.clientX, firstTouch.clientY);\n    setHover(firstTouch.clientX, firstTouch.clientY);\n  }\n\n  function onTouchMove(e) {\n    var firstTouch = e.touches[0];\n    if (!firstTouch) return;\n    setHover(firstTouch.clientX, firstTouch.clientY);\n  }\n\n  function onMouseMove(e) {\n    setHover(e.clientX, e.clientY);\n  }\n\n  function onMouseClick(e) {\n    setClick(e.clientX, e.clientY);\n  }\n\n  function setHover(clientX, clientY) {\n    ctx.cursor.hoverX = getSceneXFromClientX(clientX);\n    ctx.cursor.hoverY = getSceneYFromClientY(clientY);\n  }\n\n  function setClick(clientX, clientY) {\n    ctx.cursor.clickX = getSceneXFromClientX(clientX);\n    ctx.cursor.clickY = getSceneYFromClientY(clientY);\n  }\n\n  function getSceneXFromClientX(clientX) {\n    var dx = (clientX - canvasRect.left) / canvasRect.width;\n    return (bbox.maxX - bbox.minX) * dx + bbox.minX;\n  }\n\n  function getSceneYFromClientY(clientY) {\n    var dy = 1. - (clientY - canvasRect.top) / canvasRect.height;\n    return (bbox.minY - bbox.maxY) * dy + bbox.maxY;\n  }\n}\n\n/***/ }),\n\n/***/ \"pKWO\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = drawParticlesProgram;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__gl_utils__ = __webpack_require__(\"Ddjs\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__shaderGraph_DrawParticleGraph__ = __webpack_require__(\"aZPT\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__updatePositionProgram__ = __webpack_require__(\"3xg8\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__utils_floatPacking_js__ = __webpack_require__(\"FaU1\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__config__ = __webpack_require__(\"rvz5\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__audioProgram__ = __webpack_require__(\"94y8\");\n\n\n\n\n\n\n\n/**\n * This program manages particles life-cycle. It updates particles positions\n * and initiates drawing them on screen.\n * \n * @param {Object} ctx rendering context. Holds WebGL state\n */\nfunction drawParticlesProgram(ctx) {\n  var gl = ctx.gl;\n\n  var particleStateResolution, particleIndexBuffer;\n  var numParticles;\n\n  var currentVectorField = '';\n  var updatePositionProgram = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__updatePositionProgram__[\"a\" /* default */])(ctx);\n  var audioProgram;\n\n  var drawProgram;\n  initPrograms();\n\n  return {\n    updateParticlesCount: updateParticlesCount,\n    updateParticlesPositions: updateParticlesPositions,\n    drawParticles: drawParticles,\n    updateCode: updateCode,\n    updateColorMode: updateColorMode\n  };\n\n  function initPrograms() {\n    // need to update the draw graph because color mode shader has changed.\n    initDrawProgram();\n\n    if (__WEBPACK_IMPORTED_MODULE_4__config__[\"a\" /* default */].isAudioEnabled) {\n      if (audioProgram) audioProgram.dispose();\n      audioProgram = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5__audioProgram__[\"a\" /* default */])(ctx);\n    }\n  }\n\n  function initDrawProgram() {\n    if (drawProgram) drawProgram.unload();\n\n    var drawGraph = new __WEBPACK_IMPORTED_MODULE_1__shaderGraph_DrawParticleGraph__[\"a\" /* default */](ctx.colorMode);\n    drawProgram = __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].createProgram(gl, drawGraph.getVertexShader(currentVectorField), drawGraph.getFragmentShader());\n  }\n\n  function updateParticlesPositions() {\n    if (!currentVectorField) return;\n\n    ctx.frame += 1;\n    ctx.frameSeed = Math.random();\n\n    // TODO: Remove this.\n    if (audioProgram) audioProgram.updateTextures();\n\n    updatePositionProgram.updateParticlesPositions();\n  }\n\n  function updateColorMode() {\n    initDrawProgram();\n  }\n\n  function updateCode(vfCode) {\n    ctx.frame = 0;\n    currentVectorField = vfCode;\n    updatePositionProgram.updateCode(vfCode);\n\n    initDrawProgram();\n  }\n\n  function updateParticlesCount() {\n    particleStateResolution = ctx.particleStateResolution;\n    numParticles = particleStateResolution * particleStateResolution;\n    var particleIndices = new Float32Array(numParticles);\n    var particleStateX = new Uint8Array(numParticles * 4);\n    var particleStateY = new Uint8Array(numParticles * 4);\n\n    var minX = ctx.bbox.minX;var minY = ctx.bbox.minY;\n    var width = ctx.bbox.maxX - minX;\n    var height = ctx.bbox.maxY - minY;\n    for (var i = 0; i < numParticles; i++) {\n      __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__utils_floatPacking_js__[\"a\" /* encodeFloatRGBA */])(Math.random() * width + minX, particleStateX, i * 4); // randomize the initial particle positions\n      __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__utils_floatPacking_js__[\"a\" /* encodeFloatRGBA */])(Math.random() * height + minY, particleStateY, i * 4); // randomize the initial particle positions\n\n      particleIndices[i] = i;\n    }\n\n    if (particleIndexBuffer) gl.deleteBuffer(particleIndexBuffer);\n    particleIndexBuffer = __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].createBuffer(gl, particleIndices);\n\n    updatePositionProgram.updateParticlesCount(particleStateX, particleStateY);\n  }\n\n  function drawParticles() {\n    if (!currentVectorField) return;\n\n    var program = drawProgram;\n    gl.useProgram(program.program);\n\n    __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].bindAttribute(gl, particleIndexBuffer, program.a_index, 1);\n\n    updatePositionProgram.prepareToDraw(program);\n    ctx.inputs.updateBindings(program);\n\n    gl.uniform1f(program.u_h, ctx.integrationTimeStep);\n    gl.uniform1f(program.frame, ctx.frame);\n    gl.uniform1f(program.u_particles_res, particleStateResolution);\n    var bbox = ctx.bbox;\n    gl.uniform2f(program.u_min, bbox.minX, bbox.minY);\n    gl.uniform2f(program.u_max, bbox.maxX, bbox.maxY);\n\n    var cursor = ctx.cursor;\n    gl.uniform4f(program.cursor, cursor.clickX, cursor.clickY, cursor.hoverX, cursor.hoverY);\n    gl.drawArrays(gl.POINTS, 0, numParticles);\n  }\n}\n\n/***/ }),\n\n/***/ \"pXNl\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = textureCollection;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__gl_utils__ = __webpack_require__(\"Ddjs\");\n/**\n * A wrapper over collection of textures. Can be used to represent\n * individual textures for every dimension.\n */\n\n\nfunction textureCollection(gl, dimensions, particleStateResolution) {\n  var textures = dimensions.map(function (d, index) {\n    var textureInfo = {\n      texture: __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].createTexture(gl, gl.NEAREST, d.particleState, particleStateResolution, particleStateResolution),\n      index: index,\n      name: d.name\n    };\n\n    return textureInfo;\n  });\n\n  return {\n    dispose: dispose,\n    bindTextures: bindTextures,\n    assignProgramUniforms: assignProgramUniforms,\n    length: dimensions.length,\n    textures: textures,\n    get: function get(i) {\n      return textures[i];\n    }\n  };\n\n  function assignProgramUniforms(program) {\n    textures.forEach(function (tInfo) {\n      gl.uniform1i(program['u_particles_' + tInfo.name], tInfo.index);\n    });\n  }\n\n  function dispose() {\n    textures.forEach(function (tInfo) {\n      return gl.deleteTexture(tInfo.texture);\n    });\n  }\n\n  function bindTextures(gl, program) {\n    textures.forEach(function (tInfo) {\n      __WEBPACK_IMPORTED_MODULE_0__gl_utils__[\"a\" /* default */].bindTexture(gl, tInfo.texture, tInfo.index);\n      gl.uniform1i(program['u_particles_' + tInfo.name], tInfo.index);\n    });\n  }\n}\n\n/***/ }),\n\n/***/ \"rvz5\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__appState__ = __webpack_require__(\"NEgR\");\n\n\nvar defaultConfig = {\n  // I need to flash our more details before making any promises.\n  isAudioEnabled: false,\n  // this allows to render an overlay grid with vectors. Enable it\n  // and drag the scene a little bit.\n  vectorLinesEnabled: false,\n\n  // Starting from which texture unit we can bind custom inputs?\n  FREE_TEXTURE_UNIT: 4,\n\n  // whether input bindings should be visible\n  showBindings: __WEBPACK_IMPORTED_MODULE_0__appState__[\"a\" /* default */].getQS().get('showBindings') || false\n};\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (defaultConfig);\n\n/***/ }),\n\n/***/ \"svlg\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = makePragmaParser;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__ = __webpack_require__(\"//Fk\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__fetchGLSL_js__ = __webpack_require__(\"iw7m\");\n\n\n\nvar pragmaInclude = '#include ';\nvar nullCode = { code: ''\n\n  /**\n   * Naively parses glsl code and tries to replace all `#pragma` statements\n   * with empty string. Gives structured collection of pragma statements back\n   * \n   * @param {String} code \n   */\n};function makePragmaParser(code) {\n  if (!code) return new __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default.a(function (resolve) {\n    return resolve(nullCode);\n  });\n\n  var parsedLines = processLineByLine(code);\n  if (parsedLines.pending.length > 0) {\n    return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default.a.all(parsedLines.pending).then(function () {\n      return parsedLines;\n    }).catch(function (error) {\n      return { error: { error: error } };\n    });\n  }\n\n  return new __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default.a(function (resolve) {\n    return resolve(parsedLines);\n  });\n}\n\nfunction processLineByLine(code) {\n  var pending = [];\n  var lines = code.split('\\n');\n  var outputLines = [];\n  var currentIndex = 0;\n  lines.forEach(function (line, index) {\n    currentIndex = index;\n    if (line && line[0] === '#') {\n      outputLines.push('');\n      processPragma(line);\n    } else {\n      outputLines.push(line);\n    }\n  });\n\n  return {\n    getCode: getCode,\n    pending: pending\n  };\n\n  function getCode() {\n    return outputLines.join('\\n');\n  }\n\n  function processPragma(line) {\n    if (line.indexOf(pragmaInclude) === 0) {\n      var include = line.substr(pragmaInclude.length);\n      var insertIndex = currentIndex;\n      pending.push(__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__fetchGLSL_js__[\"a\" /* default */])(include).then(function (code) {\n        outputLines[insertIndex] = code;\n      }));\n    }\n  }\n}\n\n/***/ }),\n\n/***/ \"vhRe\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of__ = __webpack_require__(\"Zx67\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__ = __webpack_require__(\"Zrlr\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass__ = __webpack_require__(\"wxAW\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn__ = __webpack_require__(\"zwoO\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits__ = __webpack_require__(\"Pf15\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__BaseShaderNode__ = __webpack_require__(\"4KA4\");\n\n\n\n\n\n\n\nvar PanzoomTransform = function (_BaseShaderNode) {\n  __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits___default()(PanzoomTransform, _BaseShaderNode);\n\n  function PanzoomTransform(config) {\n    __WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default()(this, PanzoomTransform);\n\n    // decode is used when we move particle read from the texture\n    // otherwise we write particle to texture and need to reverse transform\n    var _this = __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default()(this, (PanzoomTransform.__proto__ || __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default()(PanzoomTransform)).call(this));\n\n    _this.decode = config && config.decode;\n    _this.srcPosName = config && config.posName || 'pos';\n    return _this;\n  }\n\n  __WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass___default()(PanzoomTransform, [{\n    key: 'getDefines',\n    value: function getDefines() {\n      if (this.decode) {\n        // TODO: Need to figure out how to not duplicate this.\n        return '\\n  uniform vec2 u_min;\\n  uniform vec2 u_max;\\n';\n      }\n    }\n  }, {\n    key: 'getMainBody',\n    value: function getMainBody() {\n      if (this.decode) {\n        return '\\n  // move particle position according to current transform\\n  vec2 du = (u_max - u_min);\\n  pos.x = ' + this.srcPosName + '.x * du.x + u_min.x;\\n  pos.y = ' + this.srcPosName + '.y * du.y + u_min.y;\\n';\n      }\n      return '\\n  pos.x = (' + this.srcPosName + '.x - u_min.x)/du.x;\\n  pos.y = (' + this.srcPosName + '.y - u_min.y)/du.y;\\n';\n    }\n  }]);\n\n  return PanzoomTransform;\n}(__WEBPACK_IMPORTED_MODULE_5__BaseShaderNode__[\"a\" /* default */]);\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (PanzoomTransform);\n\n/***/ })\n\n},[\"YJWA\"]);\n\n\n// WEBPACK FOOTER //\n// static/js/app.305f0f9257edef7ccde4.js","import createInputCollection from './programs/inputs/inputCollection';\nimport createVideoInput from './programs/inputs/videoInput';\nimport createImageInputBinding from './programs/inputs/imageInput';\nimport appState from './appState.js';\n\n// Allows to bind media elements to vector field\nexport default function createInputsModel(ctx) {\n  ctx.inputs = createInputCollection();\n  var inputs = [];\n  readInputsFromAppState();\n\n  var api = {\n    getInputs,\n    addInput,\n  };\n\n  return api;\n\n  function getInputs() {\n    return inputs;\n  }\n\n  function addInput(inputNumber) {\n    var vm = createInputElementViewModel(ctx, inputNumber);\n    inputs.push(vm);\n    return vm;\n  }\n\n  function readInputsFromAppState() {\n    var i0 = appState.getQS().get('i0');\n    if (i0) {\n      var vm = addInput(0);\n      vm.link = i0;\n      vm.updateBinding(/* immediate = */ true);\n    }\n  }\n}\n\nfunction createInputElementViewModel(ctx, inputNumber) {\n  var pendingUpdate = null;\n\n  var input = {\n    link: '',\n    error: null,\n    name: `input${inputNumber}`,\n    updateBinding\n  }\n\n  return input;\n\n  function updateBinding(immediate) {\n    if (pendingUpdate) {\n      clearTimeout(pendingUpdate);\n      pendingUpdate = null;\n    }\n\n    if (immediate) {\n      setBinding();\n    } else {\n      pendingUpdate = setTimeout(setBinding, 300);\n    }\n  }\n\n  function setBinding() {\n    input.error = null;\n    pendingUpdate = null;\n    var binding = createImageInputBinding(ctx, input.link, {\n      done() {\n        // TODO: Preview\n        appState.getQS().set(`i${inputNumber}`, input.link);\n      },\n      error(err) {\n        // TODO: Better Error checking\n        input.error = err;\n      }\n    });\n    ctx.inputs.bindInput(0, binding);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/createInputsModel.js","/**\n * Uses `window` to monitor hash and update hash\n */\nmodule.exports = windowHistory;\n\nvar inMemoryHistory = require('./inMemoryHistory.js');\nvar query = require('./query.js');\n\nfunction windowHistory(defaults, options) {\n  // If we don't support window, we are probably running in node. Just return\n  // in memory history\n  if (typeof window === 'undefined') return inMemoryHistory(defaults);\n\n  // Store all `onChanged()` listeners here, so that we can have just one\n  // `hashchange` listener, and notify one listeners within single event.\n  var listeners = [];\n\n  var useSearchPart = options && options.useSearch; // prefer query ? over hash #\n\n  // This prefix is used for all query strings. So our state is stored as\n  // my-app.com/#?key=value\n  var hashPrefix = useSearchPart ? '?' : '#?';\n\n  if (options.rewriteHashToSearch) {\n    rewriteHashToSearch();\n  }\n  init();\n\n  // This is our public API:\n  return {\n    /**\n     * Adds callback that is called when hash change happen. Callback receives\n     * current hash string with `#?` sign\n     * \n     * @param {Function} changeCallback - a function that is called when hash is\n     * changed. Callback gets one argument that represents the new state.\n     */\n    onChanged: onChanged,\n\n    /**\n     * Releases all resources\n     */\n    dispose: dispose,\n\n    /**\n     * Sets a new app state\n     *\n     * @param {object} appState - the new application state, that should be\n     * persisted in the hash string\n     */\n    set: set,\n\n    /**\n     * Gets current app state\n     */\n    get: getStateFromHash,\n\n    /**\n     * Allows to rewrite current hash url into search url\n     */\n    rewriteHashToSearch: rewriteHashToSearch\n  };\n\n  // Public API is over. You can ignore this part.\n\n  function init() {\n    var stateFromHash = getStateFromHash();\n    var stateChanged = false;\n\n    if (typeof defaults === 'object' && defaults) {\n      Object.keys(defaults).forEach(function(key) {\n        if (key in stateFromHash) return;\n\n        stateFromHash[key] = defaults[key]\n        stateChanged = true;\n      });\n    }\n\n    if (stateChanged) set(stateFromHash);\n  }\n\n  function rewriteHashToSearch() {\n    var mergedState = Object.create(null);\n\n    var searchString = window.location.search;\n    if (searchString) mergedState = Object.assign(mergedState, query.parse(searchString.substr(1)));\n\n    var hashString = window.location.hash;\n    if (hashString) mergedState = Object.assign(mergedState, query.parse(hashString.substr(2)));\n\n    set(mergedState);\n  }\n\n  function set(appState) {\n    var hash = hashPrefix + query.stringify(appState);\n\n    if (window.history) {\n      window.history.replaceState(undefined, undefined, hash);\n    } else {\n      window.location.replace(hash);\n    }\n  }\n\n  function onChanged(changeCallback) {\n    if (typeof changeCallback !== 'function') throw new Error('changeCallback needs to be a function');\n\n    // we start listen just once, only if we didn't listen before:\n    if (listeners.length === 0) {\n      window.addEventListener('hashchange', onHashChanged, false);\n    }\n\n    listeners.push(changeCallback);\n  }\n\n  function dispose() {\n    if (listeners.length === 0) return; // no need to do anything.\n\n    // Let garbage collector collect all listeners;\n    listeners = [];\n\n    // And release hash change event:\n    window.removeEventListener('hashchange', onHashChanged, false);\n  }\n\n  function onHashChanged() {\n    var appState = getStateFromHash();\n    notifyListeners(appState);\n  }\n\n  function notifyListeners(appState) {\n    for (var i = 0; i < listeners.length; ++i) {\n      var listener = listeners[i];\n      listener(appState);\n    }\n  }\n\n  function getStateFromHash() {\n    var baseString = useSearchPart ? window.location.search : window.location.hash;\n    // or symbol || is used to get empty string when no base string is present. \n    var queryString = (baseString || hashPrefix).substr(hashPrefix.length);\n    return query.parse(queryString);\n  }\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../query-state/lib/windowHistory.js\n// module id = 2PgA\n// module chunks = 4","import util from '../gl-utils';\nimport UpdatePositionGraph from '../shaderGraph/updatePositionGraph';\nimport ColorMode from './colorModes';\nimport makeReadProgram from './colorProgram';\nimport textureCollection from '../utils/textureCollection';\nimport makeStatCounter from '../utils/makeStatCounter';\nimport {decodeFloatRGBA} from '../utils/floatPacking';\nimport bus from '../bus';\n\nconst particlePositionShaderCodeBuilder = new UpdatePositionGraph();\n\nexport default function updatePositionProgram(ctx) {\n  var gl = ctx.gl;\n  var readTextures, writeTextures;\n  var particleStateResolution;\n  var updateProgram;\n  var uniformParticleColor = { r: 77/255, g: 188/255, b: 201/255, a: 1  };\n  var readVelocity = makeReadProgram(ctx);\n\n  // If someone needs to get vectors out from the GPU, they send a `vector-lines-request`\n  // over the bus. This request is delayed until next compute frame. Once it is handled,\n  // we send them back response with calculated vectors.\n  var pendingVectorLines;\n\n  // TODO: need to make sure we are not leaking.\n  bus.on('vector-lines-request', putVectorLinesRequestIntoQueue);\n\n  return {\n    updateCode,\n    updateParticlesPositions,\n    updateParticlesCount,\n    prepareToDraw,\n  };\n\n  function updateCode(vectorField) {\n    particlePositionShaderCodeBuilder.setCustomVectorField(vectorField);\n    let fragment = particlePositionShaderCodeBuilder.getFragmentShader();\n    let vertex = particlePositionShaderCodeBuilder.getVertexShader();\n\n    let newProgram = util.createProgram(gl, vertex, fragment);\n\n    if (updateProgram) updateProgram.unload();\n    updateProgram = newProgram;\n\n    if (ctx.colorMode === ColorMode.VELOCITY) readVelocity.requestSpeedUpdate();\n  }\n  \n  function updateParticlesCount(x, y) {\n    particleStateResolution = ctx.particleStateResolution;\n\n    var dimensions = [{\n      name: 'x',\n      particleState: x\n    }, {\n      name: 'y',\n      particleState: y\n    }];\n\n    if (readTextures) readTextures.dispose();\n    readTextures = textureCollection(gl, dimensions, particleStateResolution);\n\n    if (writeTextures) writeTextures.dispose();\n    writeTextures = textureCollection(gl, dimensions, particleStateResolution);\n\n    readVelocity.updateParticlesCount();\n  }\n\n  function prepareToDraw(program) {\n    var colorMode = ctx.colorMode;\n    if (colorMode === ColorMode.UNIFORM) gl.uniform4f(program.u_particle_color, uniformParticleColor.r, uniformParticleColor.g, uniformParticleColor.b, uniformParticleColor.a);\n    else if (colorMode === ColorMode.VELOCITY) readVelocity.setColorMinMax(program);\n\n    readTextures.bindTextures(gl, program);\n  }\n\n  function updateParticlesPositions() {\n    var program = updateProgram;\n    gl.useProgram(program.program);\n  \n    util.bindAttribute(gl, ctx.quadBuffer, program.a_pos, 2);\n  \n    ctx.inputs.updateBindings(program);\n\n    // TODO: Remove this.\n    if (ctx.audioTexture) {\n      util.bindTexture(gl, ctx.audioTexture, 5);\n      gl.uniform1i(program['u_audio'], 5);\n    }\n\n    readTextures.bindTextures(gl, program);\n  \n    gl.uniform1f(program.u_rand_seed, ctx.frameSeed);\n    gl.uniform1f(program.u_h, ctx.integrationTimeStep);\n    gl.uniform1f(program.frame, ctx.frame);\n    var cursor = ctx.cursor;\n    gl.uniform4f(program.cursor, cursor.clickX, cursor.clickY, cursor.hoverX, cursor.hoverY);\n\n    var bbox = ctx.bbox;\n    gl.uniform2f(program.u_min, bbox.minX, bbox.minY);\n    gl.uniform2f(program.u_max, bbox.maxX, bbox.maxY);\n\n    gl.uniform1f(program.u_drop_rate, ctx.dropProbability);\n  \n    // Draw each coordinate individually\n    for(var i = 0; i < writeTextures.length; ++i) {\n      var writeInfo = writeTextures.get(i);\n      gl.uniform1i(program.u_out_coordinate, i);\n      util.bindFramebuffer(gl, ctx.framebuffer, writeInfo.texture);\n      gl.viewport(0, 0, particleStateResolution, particleStateResolution);\n      gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n\n    // TODO: I think I need to keep this time-bound, i.e. allocate X ms to\n    // process particle positions, and move on. So that the rendering thread is not paused for too long\n    if (ctx.colorMode === ColorMode.VELOCITY) {\n      readVelocity.updateParticlesPositions(program);\n    }\n\n    if (pendingVectorLines) {\n      processVectorLinesRequest(program);\n      pendingVectorLines = null;\n    }\n\n    // swap the particle state textures so the new one becomes the current one\n    var temp = readTextures;\n    readTextures = writeTextures;\n    writeTextures = temp;\n  }\n\n  function putVectorLinesRequestIntoQueue(request) {\n    pendingVectorLines = request;\n  }\n\n  function processVectorLinesRequest(program) {\n    // TODO: Move this out\n    var dimensions = [{\n      name: 'x',\n      particleState: pendingVectorLines.x\n    }, {\n      name: 'y',\n      particleState: pendingVectorLines.y\n    }];\n\n    // We create temporary textures and load requested positions in there\n    var resolutionOfParticlesInRequest = pendingVectorLines.resolution;\n    var numParticles = resolutionOfParticlesInRequest * resolutionOfParticlesInRequest;\n\n    var texturesForRead = textureCollection(gl, dimensions, resolutionOfParticlesInRequest);\n    var texturesForWrite = textureCollection(gl, dimensions, resolutionOfParticlesInRequest);\n\n    texturesForRead.bindTextures(gl, program);\n\n    // Then we request coordinates out from GPU for each dimension\n    var writeInfo = texturesForWrite.get(0);\n    gl.uniform1i(program.u_out_coordinate, 6); // v_x\n\n    util.bindFramebuffer(gl, ctx.framebuffer, writeInfo.texture);\n    gl.viewport(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n    var velocity_x = new Uint8Array(numParticles * 4);\n    gl.readPixels(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest, gl.RGBA, gl.UNSIGNED_BYTE, velocity_x);\n\n    gl.uniform1i(program.u_out_coordinate, 7); // v_y\n    writeInfo = texturesForWrite.get(1);\n    util.bindFramebuffer(gl, ctx.framebuffer, writeInfo.texture);\n    gl.viewport(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n    var velocity_y = new Uint8Array(numParticles * 4);\n    gl.readPixels(0, 0, resolutionOfParticlesInRequest, resolutionOfParticlesInRequest, gl.RGBA, gl.UNSIGNED_BYTE, velocity_y);\n\n    texturesForWrite.dispose();\n    texturesForRead.dispose();\n\n    var xStats = makeStatCounter();\n    var yStats = makeStatCounter();\n\n    var decoded_velocity_x = new Float32Array(numParticles);\n    var decoded_velocity_y = new Float32Array(numParticles);\n    for(var i = 0; i < velocity_y.length; i+=4) {\n      var idx = i/4;\n      var vx = readFloat(velocity_x, i);\n      var vy = readFloat(velocity_y, i);\n      decoded_velocity_x[idx] = vx;\n      decoded_velocity_y[idx] = vy;\n      xStats.add(vx);\n      yStats.add(vy);\n    }\n\n    var vectorLineInfo = {\n      xStats,\n      yStats,\n      decoded_velocity_x,\n      decoded_velocity_y,\n      resolution: resolutionOfParticlesInRequest\n    };\n\n    bus.fire('vector-line-ready', vectorLineInfo);\n  }\n}\n\nfunction readFloat(buffer, offset) {\n    return decodeFloatRGBA(\n      buffer[offset + 0],\n      buffer[offset + 1],\n      buffer[offset + 2],\n      buffer[offset + 3]\n    );\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/programs/updatePositionProgram.js","export default class BaseShaderNode {\n  constructor() { }\n  getDefines() { return ''; }\n  getFunctions() { return ''; }\n  getMainBody() { return ''; }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/shaderGraph/BaseShaderNode.js","/**\n * Provides a `null` object that matches history API\n */\nmodule.exports = inMemoryHistory;\n\nfunction inMemoryHistory(defaults) {\n  var listeners = [];\n  var lastQueryObject = defaults;\n\n  return {\n    dispose: dispose,\n    onChanged: onChanged,\n    set: set,\n    get: get\n  };\n\n  function get() {\n    return lastQueryObject;\n  }\n\n  function set(newQueryObject) {\n    lastQueryObject = newQueryObject;\n    setTimeout(function() {\n      triggerChange(newQueryObject);\n    }, 0);\n  }\n\n  function dispose() {\n    listeners = [];\n  }\n\n  function onChanged(changeCallback) {\n    if (typeof changeCallback !== 'function') {\n      throw new Error('changeCallback should be a function')\n    }\n\n    listeners.push(changeCallback);\n  }\n\n  function triggerChange(appState) {\n    listeners.forEach(function(listener) {\n      listener(appState);\n    });\n  }\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../query-state/lib/inMemoryHistory.js\n// module id = 5hi0\n// module chunks = 4","/**\n * Various color modes.\n * \n * TODO: This could be generalized by allowing custom color shader\n */\nexport default {\n  /**\n   * Each particle gets its own color\n   */\n  UNIFORM: 1,\n\n  /**\n   * Color of a particle depends on its velocity\n   */\n  VELOCITY: 2,\n\n  /**\n   * Color of a particle depends on its velocity vector angle.\n   */\n  ANGLE: 3\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/programs/colorModes.js","/**\n * Allows application to access and update current app state via query string\n */\nmodule.exports = queryState;\n\nvar eventify = require('ngraph.events');\nvar windowHistory = require('./lib/windowHistory.js');\n\n/**\n * Just a convenience function that returns singleton instance of a query state\n */\nqueryState.instance = instance;\n\n// this variable holds singleton instance of the query state\nvar singletonQS;\n\n/**\n * Creates new instance of the query state.\n */\nfunction queryState(defaults, options) {\n  options = options || {};\n  var history = options.history || windowHistory(defaults, options);\n  validateHistoryAPI(history);\n\n  history.onChanged(updateQuery)\n\n  var query = history.get() || Object.create(null);\n\n  var api = {\n\n    /**\n     * Gets current state.\n     *\n     * @param {string?} keyName if present then value for this key is returned.\n     * Otherwise the entire app state is returned.\n     */\n    get: getValue,\n\n    /**\n     * Merges current app state with new key/value.\n     *\n     * @param {string} key name\n     * @param {string|number|date} value\n     */\n    set: setValue,\n\n    /**\n     * Similar to `set()`, but only sets value if it was not set before.\n     *\n     * @param {string} key name\n     * @param {string|number|date} value\n     */\n    setIfEmpty: setIfEmpty,\n\n    /**\n     * Releases all resources acquired by query state. After calling this method\n     * no hash monitoring will happen and no more events will be fired.\n     */\n    dispose: dispose,\n\n    onChange: onChange,\n    offChange: offChange,\n\n    getHistoryObject: getHistoryObject,\n  }\n\n  var eventBus = eventify({});\n\n  return api;\n\n  function onChange(callback, ctx) {\n    eventBus.on('change', callback, ctx);\n  }\n\n  function offChange(callback, ctx) {\n    eventBus.off('change', callback, ctx)\n  }\n\n  function getHistoryObject() {\n    return history;\n  }\n\n  function dispose() {\n    // dispose all history listeners\n    history.dispose();\n\n    // And remove our own listeners\n    eventBus.off();\n  }\n\n  function getValue(keyName) {\n    if (keyName === undefined) return query;\n\n    return query[keyName];\n  }\n\n  function setValue(keyName, value) {\n    var keyNameType = typeof keyName;\n\n    if (keyNameType === 'object') {\n      Object.keys(keyName).forEach(function(key) {\n        query[key] = keyName[key];\n      });\n    } else if (keyNameType === 'string') {\n      query[keyName] = value;\n    }\n\n    history.set(query);\n\n    return api;\n  }\n\n  function updateQuery(newAppState) {\n    query = newAppState;\n    eventBus.fire('change', query);\n  }\n\n  function setIfEmpty(keyName, value) {\n    if (typeof keyName === 'object') {\n      Object.keys(keyName).forEach(function(key) {\n        // TODO: Can I remove code duplication? The main reason why I don't\n        // want recursion here is to avoid spamming `history.set()`\n        if (key in query) return; // key name is not empty\n\n        query[key] = keyName[key];\n      });\n    }\n\n    if (keyName in query) return; // key name is not empty\n    query[keyName] = value;\n\n    history.set(query);\n\n    return api;\n  }\n}\n\n/**\n * Returns singleton instance of the query state.\n *\n * @param {Object} defaults - if present, then it is passed to the current instance\n * of the query state. Defaults are applied only if they were not present before.\n */\nfunction instance(defaults) {\n  if (!singletonQS) {\n    singletonQS = queryState(defaults);\n  } else if (defaults) {\n    singletonQS.setIfEmpty(defaults);\n  }\n\n  return singletonQS;\n}\n\nfunction validateHistoryAPI(history) {\n  if (!history) throw new Error('history is required');\n  if (typeof history.dispose !== 'function') throw new Error('dispose is required');\n  if (typeof history.onChanged !== 'function') throw new Error('onChanged is required');\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../query-state/index.js\n// module id = 7UaU\n// module chunks = 4","/**\n * This module parses user defined vector field code.\n */\n\nimport bus from '../bus';\nimport pragmaParse from './pragmaParser';\n\n// This is naive parser that is being used until the real `glsl-parser`\n// is loaded asynchronously. This parser assumes there are no errors\n// TODO: maybe I should be more careful here?\nvar glslParser = {\n  check(code) {\n    return {\n      code,\n      log: {\n        errorCount: 0\n      }\n    };\n  }\n};\n\n// glsl-parser is ~179KB uncompressed, we don't want to wait until it is downloaded.\n// So we load it asynchronously...\nrequire.ensure('glsl-parser', () => {\n  // ... and replace the naive parser with the real one, when ready.\n  glslParser = require('glsl-parser');\n\n  // notify interested parties, so that they can recheck code if they wish.\n  bus.fire('glsl-parser-ready'); \n});\n\nvar vectorFieldGlobals = `\nimport {\n  float PI;\n  float snoise(vec2 v);\n  float frame;\n  vec4 cursor;\n  vec2 rotate(vec2 p,float a);\n  float audio(float index);\n  sampler2D input0;\n  sampler2D input1;\n}`;\n\n/**\n * Given a string, verifies that it is a valid glsl code for a vector field,\n * and then returns code + log.\n * \n * @param {String} vectorFieldCode \n */\nexport default function getParsedVectorFieldFunction(vectorFieldCode) {\n  // TODO: what if we want to support 3d?\n  return pragmaParse(vectorFieldCode).then(pragmaParseResult => {\n    if (pragmaParseResult.error) {\n      return pragmaParseResult;\n    }\n\n    vectorFieldCode = pragmaParseResult.getCode();\n\n    var parserResult = glslParser.check(vectorFieldCode, { globals: vectorFieldGlobals });\n    parserResult.code = vectorFieldCode;\n\n    if (parserResult.log.errorCount) parserResult.error = parserError(parserResult.log);\n\n    return parserResult;\n  });\n}\n\nfunction parserError(log) {\n  let diag = log.diagnostics[0];\n  // TODO probably need to check kind (errors are 0, warnings are 1)\n  let firstError = diag.range;\n  let lineColumn = firstError.lineColumn();\n  let source = firstError.source;\n  let offset = source._lineOffsets[lineColumn.line]\n  let line = source.contents.substr(offset,  lineColumn.column);\n  line += source.contents.substring(firstError.start, firstError.end);\n  let prefix = 'Line ' + lineColumn.line + ': ';\n  let diagText = diag.text;\n  return {\n    error: \n      prefix + line + '\\n' +\n      whitespace(prefix.length) + whitespace(lineColumn.column) + '^',\n    errorDetail: diagText,\n    isFloatError: isFloatError(diagText)\n  };\n}\n\nfunction isFloatError(diagText) {\n  return diagText.indexOf('\"int\"') > -1 &&\n    diagText.indexOf('\"float\"')  > -1;\n}\n\nfunction whitespace(length) {\n  return new Array(length + 1).join(' ');\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/editor/getParsedVectorFieldFunction.js","import bus from '../bus';\nimport glUtil from '../gl-utils';\n\nexport default audioProgram;\n\nfunction audioProgram(ctx) {\n  var gl = ctx.gl;\n\n  var audioWidth = 8, audioHeight = 8;\n  var audioBuffer = new Uint8Array(audioWidth * audioHeight * 4);\n  var audioTexture = glUtil.createTexture(gl, gl.NEAREST, audioBuffer, audioWidth, audioHeight);\n  var audioDirty = false;\n  ctx.audioTexture = audioTexture;\n\n  bus.on('audio', updateAudioBuffer);\n\n  return {\n    updateTextures,\n    dispose\n  };\n\n  function dispose() {\n    bus.off('audio', updateAudioBuffer);\n    gl.deleteTexture(audioTexture);\n  }\n\n  function updateTextures() {\n    if (!audioDirty) return;\n    audioDirty = false;\n\n    // TODO: This should come from fftSize?\n    var width = 5, height = 5;\n    gl.bindTexture(gl.TEXTURE_2D, audioTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, audioBuffer);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n  }\n\n  function updateAudioBuffer(newBuffer) {\n    audioBuffer = newBuffer;\n    audioDirty = true;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/programs/audioProgram.js","/**\n * This module is similar to JSON, but it encodes/decodes in query string\n * format `key1=value1...`\n */\nmodule.exports = {\n  parse: parse,\n  stringify: stringify\n};\n\nfunction stringify(object) {\n  if (!object) return '';\n\n  return Object.keys(object).map(toPairs).join('&');\n\n  function toPairs(key) {\n    var value = object[key];\n    var pair = encodePart(key);\n    if (value !== undefined) {\n      pair += '=' + encodeValue(value);\n    }\n\n    return pair;\n  }\n}\n\nfunction parse(queryString) {\n  var query = Object.create(null);\n\n  if (!queryString) return query;\n\n  queryString.split('&').forEach(decodeRecord);\n\n  return query;\n\n  function decodeRecord(queryRecord) {\n    if (!queryRecord) return;\n\n    var pair = queryRecord.split('=');\n    query[decodeURIComponent(pair[0])] = decodeValue(pair[1]);\n  }\n}\n\nfunction encodeValue(value) {\n  // TODO: Do I need this?\n  // if (typeof value === 'string') {\n  //   if (value.match(/^(true|false)$/)) {\n  //     // special handling of strings that look like booleans\n  //     value = JSON.stringify('' + value);\n  //   } else if (value.match(/^-?\\d+\\.?\\d*$/)) {\n  //     // special handling of strings that look like numbers\n  //     value = JSON.stringify('' + value);\n  //   }\n  // }\n  if (value instanceof Date) {\n    value = value.toISOString();\n  }\n  var uriValue = encodePart(value);\n  return uriValue;\n}\n\nfunction encodePart(part) {\n  // We want to make sure that we also encode symbols like ( and ) correctly\n  var encoded = encodeURIComponent(part);\n  return encoded.replace(/[()]/g, saferEscape);\n}\n\nfunction saferEscape(character) {\n  if (character === ')') return '%29';\n  if (character === '(') return '%28';\n  return character; // What?\n}\n\n/**\n * This method returns typed value from string\n */\nfunction decodeValue(value) {\n  value = decodeURIComponent(value);\n\n  if (value === \"\") return value;\n  if (!isNaN(value)) return parseFloat(value);\n  if (isBolean(value)) return value === 'true';\n  if (isISODateString(value)) return new Date(value);\n\n  return value;\n}\n\nfunction isBolean(strValue) {\n  return strValue === 'true' || strValue === 'false';\n}\n\nfunction isISODateString(str) {\n  return str && str.match(/(\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d\\.\\d+([+-][0-2]\\d:[0-5]\\d|Z))|(\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-5]\\d([+-][0-2]\\d:[0-5]\\d|Z))|(\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d([+-][0-2]\\d:[0-5]\\d|Z))/)\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../query-state/lib/query.js\n// module id = 9XuS\n// module chunks = 4","/**\n * XMLHttpRequest wrapped into a promise.\n * \n * @param {String} url \n */\nexport default function request(url, options) {\n  if (!options) options = {};\n\n  return new Promise(download);\n\n  function download(resolve, reject) {\n    var req = new XMLHttpRequest();\n\n    if (typeof options.progress === 'function') {\n      req.addEventListener('progress', updateProgress, false);\n    }\n\n    req.addEventListener('load', transferComplete, false);\n    req.addEventListener('error', transferFailed, false);\n    req.addEventListener('abort', transferCanceled, false);\n\n    req.open('GET', url);\n    if (options.responseType) {\n      req.responseType = options.responseType;\n    }\n    req.send(null);\n\n    function updateProgress(e) {\n      if (e.lengthComputable) {\n        options.progress({\n          loaded: e.loaded,\n          total: e.total,\n          percent: e.loaded / e.total\n        });\n      }\n    }\n\n    function transferComplete() {\n      if (req.status !== 200) {\n        reject(`Unexpected status code ${req.status} when calling ${url}`);\n        return;\n      }\n      var response = req.response;\n\n      if (options.responseType === 'json' && typeof response === 'string') {\n        // IE\n        response = JSON.parse(response);\n      }\n\n      resolve(response);\n    }\n\n    function transferFailed() {\n      reject(`Failed to download ${url}`);\n    }\n\n    function transferCanceled() {\n      reject(`Cancelled download of ${url}`);\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils/request.js","/**\n * This file is based on https://github.com/mapbox/webgl-wind\n * by Vladimir Agafonkin\n * \n * Released under ISC License, Copyright (c) 2016, Mapbox\n * https://github.com/mapbox/webgl-wind/blob/master/LICENSE\n * \n * Adapted to field maps by Andrei Kashcha\n * Copyright (C) 2017\n */\nexport default {\n  createTexture: createTexture,\n  bindFramebuffer: bindFramebuffer,\n  createProgram: createProgram, \n  createBuffer: createBuffer,\n  bindAttribute: bindAttribute,\n  bindTexture: bindTexture\n}\n\nfunction bindTexture(gl, texture, unit) {\n  gl.activeTexture(gl.TEXTURE0 + unit);\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n}\n\nfunction createBuffer(gl, data) {\n  var buffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n  return buffer;\n}\n\nfunction createTexture(gl, filter, data, width, height) {\n  var texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n  if (data instanceof Uint8Array) {\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, data);\n  } else {\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, data);\n  }\n  gl.bindTexture(gl.TEXTURE_2D, null);\n  return texture;\n}\n\nfunction bindFramebuffer(gl, framebuffer, texture) {\n  gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n  if (texture) {\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n  }\n}\n\nfunction bindAttribute(gl, buffer, attribute, numComponents) {\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.enableVertexAttribArray(attribute);\n  gl.vertexAttribPointer(attribute, numComponents, gl.FLOAT, false, 0, 0);\n}\n\nfunction createProgram(gl, vertexSource, fragmentSource) {\n  var program = gl.createProgram();\n\n  var vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexSource);\n  var fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentSource);\n\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n\n  gl.linkProgram(program);\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      throw new Error(gl.getProgramInfoLog(program));\n  }\n\n  var wrapper = {\n    program: program,\n    unload\n  };\n\n  var numAttributes = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n  var i;\n  for (i = 0; i < numAttributes; i++) {\n      var attribute = gl.getActiveAttrib(program, i);\n      wrapper[attribute.name] = gl.getAttribLocation(program, attribute.name);\n  }\n  var numUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n  for (i = 0; i < numUniforms; i++) {\n      var uniform = gl.getActiveUniform(program, i);\n      wrapper[uniform.name] = gl.getUniformLocation(program, uniform.name);\n  }\n\n  return wrapper; \n\n  function unload() {\n    gl.deleteProgram(program);\n  }\n}\n\nfunction createShader(gl, type, source) {\n  var shader = gl.createShader(type);\n  gl.shaderSource(shader, source);\n\n  gl.compileShader(shader);\n  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      throw new Error(gl.getShaderInfoLog(shader));\n  }\n\n  return shader;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/gl-utils.js","import BaseShaderNode from './BaseShaderNode';\nimport snoise from './parts/simplex-noise';\nimport {getInputUniforms} from './customInput';\n\nexport default class UserDefinedVelocityFunction extends BaseShaderNode {\n  constructor(updateCode) {\n    super();\n    this.updateCode = updateCode || '';\n  }\n\n  setNewUpdateCode(newUpdateCode) {\n    this.updateCode = newUpdateCode;\n  }\n\n  getDefines() {\n    return `\nuniform float frame;\nuniform vec4 cursor;\n// TODO: use inputN instead.\nuniform sampler2D u_audio;\n\n#define PI 3.1415926535897932384626433832795\n\n${getInputUniforms()}\n`\n  }\n\n  getFunctions() {\n  // TODO: Do I need to worry about \"glsl injection\" (i.e. is there potential for security attack?)\n  // TODO: Do I need to inject snoise only when it's used?\n    return `\n${snoise}\n\nvec2 rotate(vec2 p,float a) {\n\treturn cos(a)*p+sin(a)*vec2(p.y,-p.x);\n}\n\n// TODO: This will change. Don't use it.\nfloat audio(float index) {\n  float rgbI = floor(index/4.);\n  vec2 txPos = vec2(fract(rgbI / 5.), floor(rgbI / 5.) / 5.);\n  vec4 rgba = texture2D(u_audio, txPos);\n  \n  float offset = mod(index, 4.);\n  if (offset == 0.) return rgba[0];\n  if (offset == 1.) return rgba[1];\n  if (offset == 2.) return rgba[2];\n  return rgba[3];\n}\n\n${this.updateCode ? this.updateCode : 'vec2 get_velocity(vec2 p) { return vec2(0.); }'}\n  `\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/shaderGraph/UserDefinedVelocityFunction.js","/**\n * This file encodes/decodes float values into 32bit rgba array\n * \n * It is based on https://computergraphics.stackexchange.com/questions/4151/webgl-packing-unpacking-functions-that-can-roundtrip-all-typical-32-bit-floats\n * and it is not perfect. If you know how to improve it - please let me know.\n */\n\n/**\n * Encodes float value into output array\n * @param {float} val - value to be encode\n * @param {Uint8Array} out  - array where encoded value needs to be written.\n * @param {Number} writeOffset - offset in the original array where values should be written.\n */\nexport function encodeFloatRGBA(val, out, writeOffset) {\n  if (val == 0.0) {\n    out[writeOffset + 0] = 0; out[writeOffset + 1] = 0; out[writeOffset + 2] = 0; out[writeOffset + 3] = 0;\n    return;\n  }\n\n  var mag = Math.abs(val);\n  var exponent = Math.floor(Math.log2(mag));\n  // Correct log2 approximation errors.\n  exponent += (exp2(exponent) <= mag / 2.0) ? 1 : 0;\n  exponent -= (exp2(exponent) > mag) ? 1 : 0;\n\n  var mantissa;\n  if (exponent > 100.0) {\n      mantissa = mag / 1024.0 / exp2(exponent - 10.0) - 1.0;\n  } else {\n      mantissa = mag / (exp2(exponent)) - 1.0;\n  }\n\n  var a = exponent + 127.0;\n  mantissa *= 256.0;\n  var b = Math.floor(mantissa);\n  mantissa -= b;\n  mantissa *= 256.0;\n  var c = Math.floor(mantissa);\n  mantissa -= c;\n  mantissa *= 128.0;\n  var d = Math.floor(mantissa) * 2.0 + ((val < 0.0) ? 1: 0);\n\n  out[writeOffset + 0] = a; out[writeOffset + 1] = b; out[writeOffset + 2] = c; out[writeOffset + 3] = d;\n}\n\n/**\n * Given byte values in range [0..255] returns decoded float value.\n * \n * @param {Byte} r \n * @param {Byte} g \n * @param {Byte} b \n * @param {Byte} a \n */\nexport function decodeFloatRGBA(r, g, b, a) {\n  var A = Math.floor(r + 0.5);\n  var B = Math.floor(g + 0.5);\n  var C = Math.floor(b + 0.5);\n  var D = Math.floor(a + 0.5);\n\n  var exponent = A - 127.0;\n  var sign = 1.0 - (D % 2.0) * 2.0;\n  var mantissa = ((A > 0.0) ? 1 : 0)\n                  + B / 256.0\n                  + C / 65536.0\n                  + Math.floor(D / 2.0) / 8388608.0;\n  return sign * mantissa * exp2(exponent);\n}\n\nfunction exp2(exponent) { return Math.exp(exponent * Math.LN2); }\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils/floatPacking.js","/**\n * Creates a single image binding element in the input collection.\n */\nimport loadTexture from \"./loadTexture\";\nimport glUtils from '../../gl-utils';\nimport config from '../../config';\nimport bus from '../../bus';\n\nconst FREE_TEXTURE_UNIT = config.FREE_TEXTURE_UNIT;\n\nexport default function createImageInputBinding(ctx, url, callbacks) {\n  var texture = null;\n  loadTexture(ctx.gl, url).then(setTexture).catch(handleError);\n\n  return {\n    updateBinding,\n    dispose() {\n      // TODO: Potential race condition, as loadTexture is async.\n      ctx.gl.deleteTexture(texture);\n    }\n  }\n\n  function handleError(err) {\n    if (callbacks && callbacks.error) {\n      callbacks.error(err);\n    }\n  }\n\n  function setTexture(loadedTexture) {\n    texture = loadedTexture;\n    bus.fire('refresh-speed')\n    if (callbacks && callbacks.done) {\n      callbacks.done(url);\n    }\n  }\n\n  function updateBinding(program, inputIndex) {\n    if (!texture) return;\n\n    var realIndex = inputIndex + FREE_TEXTURE_UNIT;\n    glUtils.bindTexture(ctx.gl, texture, realIndex);\n    ctx.gl.uniform1i(program[`input${inputIndex}`], realIndex);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/programs/inputs/imageInput.js","/**\n * This file is based on https://github.com/mapbox/webgl-wind\n * by Vladimir Agafonkin\n *\n * Released under ISC License, Copyright (c) 2016, Mapbox\n * https://github.com/mapbox/webgl-wind/blob/master/LICENSE\n *\n * Adapted to field maps by Andrei Kashcha\n * Copyright (C) 2017\n */\nimport util from './gl-utils';\nimport makePanzoom from 'panzoom';\nimport bus from './bus';\nimport appState from './appState';\nimport wglPanZoom from './wglPanZoom';\n\nimport createScreenProgram from './programs/screenProgram';\nimport createDrawParticlesProgram from './programs/drawParticlesProgram';\nimport createCursorUpdater from './utils/cursorUpdater';\nimport createVectorFieldEditorState from './editor/vectorFieldState';\nimport createInputsModel from './createInputsModel';\n\n/**\n * Kicks offs the app rendering. Initialized before even vue is loaded.\n *\n * @param {WebGLRenderingContext} gl\n */\nexport default function initScene(gl) {\n  // Canvas size management\n  var canvasRect = { width: 0, height: 0, top: 0, left: 0 };\n  setWidthHeight(gl.canvas.width, gl.canvas.height);\n  window.addEventListener('resize', onResize, true);\n\n  // Video capturing is available in super advanced mode. You'll need to install\n  // and start https://github.com/greggman/ffmpegserver.js\n  // Then type in the console: window.startRecord();\n  // This will trigger frame-by-frame recording (it is slow). To stop it, call window.stopRecord();\n  bus.on('start-record', startRecord);\n  bus.on('stop-record', stopRecord);\n  var currentCapturer = null;\n\n  // TODO: It feels like bounding box management needs to be moved out from here.\n  // TODO: bbox needs to be a class with width/height properties.\n  var bbox = appState.getBBox() || {};\n  var currentPanZoomTransform = {\n    scale: 1,\n    x: 0,\n    y: 0\n  };\n\n  // How many particles do we want?\n  var particleCount = appState.getParticleCount();\n\n  gl.disable(gl.DEPTH_TEST);\n  gl.disable(gl.STENCIL_TEST);\n\n  // Context variable is a way to share rendering state between multiple programs. It has a lot of stuff on it.\n  // I found that it's the easiest way to work in state-full world of WebGL.\n  // Until I discover a better way to write WebGL code.\n  var ctx = {\n    gl,\n    bbox,\n    canvasRect,\n\n    inputs: null,\n\n    framebuffer: gl.createFramebuffer(),\n\n    // This is used only to render full-screen rectangle. Main magic happens inside textures.\n    quadBuffer: util.createBuffer(gl, new Float32Array([0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1])),\n\n    colorMode: appState.getColorMode(),\n\n    // This defines texture unit for screen rendering. First few indices are taken by textures\n    // that compute particles position/color\n    // TODO: I need to find a better way to manage this.\n    screenTextureUnit: 3,\n\n    integrationTimeStep: appState.getIntegrationTimeStep(),\n\n    // On each frame the likelihood for a particle to reset its position is this:\n    dropProbability: appState.getDropProbability(),\n\n    // current frame number. Reset every time when new shader is compiled\n    frame: 0,\n\n    // Information about mouse cursor. Could be useful to simplify\n    // exploration\n    cursor: {\n      // Where mouse was last time clicked (or tapped)\n      clickX: 0, clickY: 0,\n      // where mouse was last time moved. If this is a touch device\n      // this is the same as clickX, clickY\n      hoverX: 0, hoverY: 0\n    },\n\n    // Texture size to store particles' positions\n    particleStateResolution: 0,\n\n    // How quickly we should fade previous frame (from 0..1)\n    fadeOpacity: appState.getFadeout(),\n\n    // Ignore this one for a moment. Yes, the app support web audio API,\n    // but it's rudimentary, so... shhh! it's a secret.\n    // Don't shhh on me!\n    audioTexture: null\n  };\n\n  // Frame management\n  var lastAnimationFrame;\n  var isPaused = false;\n\n  var inputsModel = createInputsModel(ctx);\n\n  // screen rendering;\n  var screenProgram = createScreenProgram(ctx);\n  var drawProgram = createDrawParticlesProgram(ctx);\n  var cursorUpdater = createCursorUpdater(ctx);\n  var vectorFieldEditorState = createVectorFieldEditorState(drawProgram);\n\n  // particles\n  updateParticlesCount(particleCount);\n\n  var api = {\n    start: nextFrame,\n    stop,\n    dispose,\n\n    resetBoundingBox,\n    moveBoundingBox,\n\n    setPaused,\n\n    getParticlesCount,\n    setParticlesCount,\n\n    setFadeOutSpeed,\n    getFadeOutSpeed,\n\n    setDropProbability,\n    getDropProbability,\n\n    getIntegrationTimeStep,\n    setIntegrationTimeStep,\n\n    setColorMode,\n    getColorMode,\n\n    vectorFieldEditorState,\n\n    inputsModel,\n\n    getCanvasRect() {\n      // We trust they don't do anything bad with this ...\n      return canvasRect;\n    },\n\n    getBoundingBox() {\n      // again, we trust. Maybe to much?\n      return ctx.bbox;\n    }\n  }\n\n  var panzoom = initPanzoom();\n  restoreBBox();\n\n  setTimeout(() => {\n    bus.fire('scene-ready', api);\n  })\n\n  return api;\n\n  function moveBoundingBox(changes) {\n    if (!changes) return;\n    var parsedBoundingBox = Object.assign({}, ctx.bbox);\n\n    assignIfPossible(changes, 'minX', parsedBoundingBox);\n    assignIfPossible(changes, 'minY', parsedBoundingBox);\n    assignIfPossible(changes, 'maxX', parsedBoundingBox);\n    assignIfPossible(changes, 'maxY', parsedBoundingBox);\n\n    // for Y axis changes we need to preserve aspect ration, which means\n    // we also need to change X...\n    if (changes.minY !== undefined || changes.maxY !== undefined) {\n      // adjust values for X\n      var heightChange = Math.abs(parsedBoundingBox.minY - parsedBoundingBox.maxY)/Math.abs(ctx.bbox.minY - ctx.bbox.maxY);\n      var cx = (ctx.bbox.maxX + ctx.bbox.minX)/2;\n      var prevWidth = (ctx.bbox.maxX - ctx.bbox.minX)/2;\n      parsedBoundingBox.minX = cx - prevWidth * heightChange;\n      parsedBoundingBox.maxX = cx + prevWidth * heightChange;\n\n    }\n\n    applyBoundingBox(parsedBoundingBox);\n  }\n\n  function assignIfPossible(change, key, newBoundingBox) {\n    var value = Number.parseFloat(change[key]);\n    if (Number.isFinite(value)) {\n      newBoundingBox[key] = value;\n    }\n  }\n\n  function startRecord(capturer) {\n    currentCapturer = capturer;\n  }\n\n  function stopRecord() {\n    currentCapturer = null;\n  }\n\n  function setColorMode(x) {\n    var mode = parseInt(x, 10);\n    appState.setColorMode(mode);\n    ctx.colorMode = appState.getColorMode();\n    drawProgram.updateColorMode(mode);\n  }\n\n  function getColorMode() {\n    return appState.getColorMode();\n  }\n\n  function getIntegrationTimeStep() {\n    return appState.getIntegrationTimeStep();\n  }\n\n  function setIntegrationTimeStep(x) {\n    var f = parseFloat(x);\n    if (Number.isFinite(f)) {\n      ctx.integrationTimeStep = f;\n      appState.setIntegrationTimeStep(f);\n      bus.fire('integration-timestep-changed', f);\n    }\n  }\n\n  function setPaused(shouldPause) {\n    isPaused = shouldPause;\n    nextFrame();\n  }\n\n  // Main screen fade out configuration\n  function setFadeOutSpeed(x) {\n    var f = parseFloat(x);\n    if (Number.isFinite(f)) {\n      ctx.fadeOpacity = f;\n      appState.setFadeout(f);\n    }\n  }\n\n  function getFadeOutSpeed() {\n    return appState.getFadeout();\n  }\n\n  // Number of particles configuration\n  function getParticlesCount() {\n    return appState.getParticleCount();\n  }\n\n  function setParticlesCount(newParticleCount) {\n    if (!Number.isFinite(newParticleCount)) return;\n    if (newParticleCount === particleCount) return;\n    if (newParticleCount < 1) return;\n\n    updateParticlesCount(newParticleCount);\n\n    particleCount = newParticleCount;\n    appState.setParticleCount(newParticleCount);\n  }\n\n  // drop probability\n  function setDropProbability(x) {\n    var f = parseFloat(x);\n    if (Number.isFinite(f)) {\n      // TODO: Do I need to worry about duplication/clamping?\n      appState.setDropProbability(f);\n      ctx.dropProbability = f;\n    }\n  }\n\n  function getDropProbability() {\n    return appState.getDropProbability();\n  }\n\n  function onResize() {\n    setWidthHeight(window.innerWidth, window.innerHeight);\n\n    screenProgram.updateScreenTextures();\n\n    updateBoundingBox(currentPanZoomTransform);\n  }\n\n  function setWidthHeight(w, h) {\n    var dx = Math.max(w * 0.02, 30);\n    var dy = Math.max(h * 0.02, 30);\n    canvasRect.width = w + 2 * dx;\n    canvasRect.height = h + 2 * dy;\n    canvasRect.top = - dy;\n    canvasRect.left = - dx;\n\n\n    let canvas = gl.canvas;\n    canvas.width = canvasRect.width;\n    canvas.height = canvasRect.height;\n    canvas.style.left = (-dx) + 'px';\n    canvas.style.top = (-dy) + 'px';\n  }\n\n  function dispose() {\n      stop();\n      panzoom.dispose();\n      window.removeEventListener('resize', onResize, true);\n      cursorUpdater.dispose();\n      vectorFieldEditorState.dispose();\n  }\n\n  function nextFrame() {\n    if (lastAnimationFrame) return;\n\n    if (isPaused) return;\n\n    lastAnimationFrame = requestAnimationFrame(draw);\n  }\n\n  function stop() {\n    cancelAnimationFrame(lastAnimationFrame);\n    lastAnimationFrame = 0;\n  }\n\n  function draw() {\n    lastAnimationFrame = 0;\n\n    drawScreen();\n\n    if (currentCapturer) currentCapturer.capture(gl.canvas);\n\n    nextFrame();\n  }\n\n  function drawScreen() {\n    screenProgram.fadeOutLastFrame()\n    drawProgram.drawParticles();\n    screenProgram.renderCurrentScreen();\n    drawProgram.updateParticlesPositions();\n  }\n\n  function updateParticlesCount(numParticles) {\n    // we create a square texture where each pixel will hold a particle position encoded as RGBA\n    ctx.particleStateResolution = Math.ceil(Math.sqrt(numParticles));\n    drawProgram.updateParticlesCount();\n  }\n\n  function initPanzoom() {\n    let initializedPanzoom = makePanzoom(gl.canvas, {\n      realPinch: true,\n      zoomSpeed: 0.025,\n      controller: wglPanZoom(gl.canvas, updateBoundingBox)\n    });\n\n    return initializedPanzoom;\n  }\n\n  function restoreBBox() {\n    var savedBBox = appState.getBBox();\n    var {width, height} = canvasRect;\n\n    let sX = Math.PI * Math.E;\n    let sY = Math.PI * Math.E;\n    let tX = 0;\n    let tY = 0;\n    if (savedBBox) {\n      sX = savedBBox.maxX - savedBBox.minX;\n      sY = savedBBox.maxY - savedBBox.minY;\n      // TODO: Not sure if this is really the best way to do it.\n      // var ar = width/height;\n      tX = width * (savedBBox.minX + savedBBox.maxX)/2;\n      tY = width * (savedBBox.minY + savedBBox.maxY)/2;\n    }\n\n    var w2 = sX * width/2;\n    var h2 = sY * height/2;\n    panzoom.showRectangle({\n      left: -w2 + tX,\n      top: -h2 - tY,\n      right: w2 + tX,\n      bottom: h2 - tY ,\n    });\n  }\n\n  function updateBoundingBox(transform) {\n    screenProgram.boundingBoxUpdated = true;\n\n    currentPanZoomTransform.x = transform.x;\n    currentPanZoomTransform.y = transform.y;\n    currentPanZoomTransform.scale = transform.scale;\n\n    var {width, height} = canvasRect;\n\n    var minX = clientX(0);\n    var minY = clientY(0);\n    var maxX = clientX(width);\n    var maxY = clientY(height);\n\n    // we divide by width to keep aspect ratio\n    // var ar = width/height;\n    var p = 10000;\n    bbox.minX = Math.round(p * minX/width)/p;\n    bbox.minY = Math.round(p * -minY/width)/p;\n    bbox.maxX = Math.round(p * maxX/width)/p;\n    bbox.maxY = Math.round(p * -maxY/ width)/p;\n\n\n    appState.saveBBox(bbox);\n\n    bus.fire('bbox-change', bbox);\n\n    function clientX(x) {\n      return (x - transform.x)/transform.scale;\n    }\n\n    function clientY(y) {\n      return (y - transform.y)/transform.scale;\n    }\n  }\n\n  function resetBoundingBox() {\n    var w = Math.PI * Math.E * 0.5;\n    var h = Math.PI * Math.E * 0.5;\n\n    applyBoundingBox({\n      minX: -w,\n      minY: -h,\n      maxX: w,\n      maxY: h\n    })\n  }\n\n  function applyBoundingBox(boundingBox) {\n    appState.saveBBox(boundingBox, /* immediate = */ true);\n    restoreBBox();\n    // a hack to trigger panzoom event\n    panzoom.moveBy(0, 0, false);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/scene.js","//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\nvar code = `\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n`\n\nexport default code;\n\n\n// WEBPACK FOOTER //\n// ./src/lib/shaderGraph/parts/simplex-noise.js","import queryState from 'query-state';\nimport bus from './bus';\nimport ColorModes from './programs/colorModes';\nimport wrapVectorField from './wrapVectorField';\n\n/**\n * The state of the fieldplay is stored in the query string. This is the\n * only place where query string can be manipulated or fetched.\n */\n\nvar qs = queryState({}, {\n  useSearch: true,\n  // Older version of the app used hash to store application arguments.\n  // Turns out hash is not good for websites like reddit. They can block\n  // url, saying \"url was already submitted\" if the only part that is different\n  // is hash. So, we switch to search string, and maintain backward compatibility\n  // for fields created before.\n  rewriteHashToSearch: true\n});\n\nvar currentState = qs.get();\n\nvar defaultVectorField = wrapVectorField(`v.x = 0.1 * p.y;\n  v.y = -0.2 * p.y;`);\n\nvar pendingSave;\nvar defaults = {\n  timeStep: 0.01,\n  dropProbability: 0.009,\n  particleCount: 10000,\n  fadeout: .998,\n  colorMode: ColorModes.UNIFORM\n}\n\nlet settingsPanel = {\n  collapsed: window.innerWidth < 600 ? true : false,\n};\n\nexport default {\n  settingsPanel,\n  saveBBox,\n  getBBox,\n  getQS() { return qs; },\n  saveCode,\n  getCode,\n  getDefaultCode,\n\n  getDropProbability,\n  setDropProbability,\n\n  getIntegrationTimeStep,\n  setIntegrationTimeStep,\n\n  getParticleCount,\n  setParticleCount,\n\n  getFadeout,\n  setFadeout,\n\n  getColorMode,\n  setColorMode\n}\n\nqs.onChange(function() {\n  bus.fire('scene-ready', window.scene);\n});\n\nfunction getColorMode() {\n  let colorMode = qs.get('cm');\n  return defined(colorMode) ? colorMode : defaults.colorMode;\n}\n\nfunction setColorMode(colorMode) {\n  if (!defined(colorMode)) return;\n  qs.set({cm: colorMode});\n  currentState.cm = colorMode;\n}\n\nfunction getFadeout() {\n  let fadeout = qs.get('fo');\n  return defined(fadeout) ? fadeout : defaults.fadeout;\n}\n\nfunction setFadeout(fadeout) {\n  if (!defined(fadeout)) return;\n  qs.set({fo: fadeout});\n  currentState.fo = fadeout;\n}\n\nfunction getParticleCount() {\n  let particleCount = qs.get('pc');\n  return defined(particleCount) ? particleCount : defaults.particleCount;\n}\n\nfunction setParticleCount(particleCount) {\n  if (!defined(particleCount)) return;\n  qs.set({pc: particleCount});\n  currentState.pc = particleCount;\n}\n\nfunction getIntegrationTimeStep() {\n  let timeStep = qs.get('dt');\n  return defined(timeStep) ? timeStep : defaults.timeStep;\n}\n\nfunction setIntegrationTimeStep(dt) {\n  if (!defined(dt)) return;\n  qs.set({dt: dt})\n  currentState.dt = dt;\n}\n\nfunction getDropProbability() {\n  let dropProbability = qs.get('dp');\n  return defined(dropProbability) ? dropProbability : defaults.dropProbability;\n}\n\nfunction setDropProbability(dropProbability) {\n  if (!defined(dropProbability)) return;\n  clamp(dropProbability, 0, 1);\n  qs.set({dp: dropProbability})\n}\n\nfunction getBBox() {\n  let cx = qs.get('cx');\n  let cy = qs.get('cy');\n  let w = qs.get('w');\n  let h = qs.get('h');\n\n  let bboxDefined = defined(cx) && defined(cy) && defined(w) && defined(h);\n  if (!bboxDefined) return;\n\n  let w2 = w/2;\n  let h2 = h/2;\n  var p = 10000;\n  return {\n    minX: Math.round(p * (cx - w2))/p,\n    maxX: Math.round(p * (cx + w2))/p,\n    minY: Math.round(p * (cy - h2))/p,\n    maxY: Math.round(p * (cy + h2))/p\n  };\n}\n\nfunction saveBBox(bbox, immediate = false) {\n  if(pendingSave) {\n    clearTimeout(pendingSave);\n    pendingSave = 0;\n  }\n\n  if (immediate) saveReally(bbox);\n  else {\n    pendingSave = setTimeout(() => saveReally(bbox), 300);\n  }\n}\n\nfunction saveReally(bbox) {\n  pendingSave = 0;\n  var bbox = {\n    cx: (bbox.minX + bbox.maxX) * 0.5,\n    cy: (bbox.minY + bbox.maxY) * 0.5,\n    w: (bbox.maxX - bbox.minX),\n    h: (bbox.maxX - bbox.minX)\n  }\n\n  if (bbox.w <= 0 || bbox.h <= 0) return;\n\n  qs.set(bbox);\n\n  currentState.cx = bbox.cx;\n  currentState.cy = bbox.cy;\n  currentState.w = bbox.w;\n  currentState.h = bbox.h;\n}\n\nfunction getCode() {\n  var vfCode = qs.get('vf');\n  if (vfCode) return vfCode;\n  \n  // If we didn't get code yet, let's try read to read it from previous version\n  // of the API.\n  // TODO: Need to figure out how to develop this in backward/future compatible way.\n  var oldCode = qs.get('code');\n  if (oldCode) {\n    vfCode = wrapVectorField(oldCode);\n    // side effect - let's clean the old URL\n    delete(currentState.code);\n    qs.set('vf', vfCode);\n    return vfCode;\n  }\n\n  return defaultVectorField;\n}\n\nfunction getDefaultCode() {\n  return defaultVectorField;\n}\n\nfunction saveCode(code) {\n  qs.set({\n    vf: code\n  });\n  currentState.code = code;\n}\n\nfunction defined(number) {\n  return Number.isFinite(number);\n}\n\nfunction clamp(x, min, max) {\n  return x < min ? min :\n        (x > max) ? max : x;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/appState.js","import BaseShaderNode from './BaseShaderNode';\nimport TexturePositionNode from './TexturePositionNode';\nimport renderNodes from './renderNodes';\nimport UserDefinedVelocityFunction from './UserDefinedVelocityFunction';\nimport PanzoomTransform from './PanzoomTransform';\nimport RungeKuttaIntegrator from './RungeKuttaIntegrator';\n\nexport default class UpdatePositionGraph {\n  constructor(options) {\n    this.readStoredPosition = new TexturePositionNode(/* isDecode = */ true);\n    this.udfVelocity = new UserDefinedVelocityFunction();\n    this.integratePositions = new RungeKuttaIntegrator();\n    this.dropParticles = new RandomParticleDropper();\n    this.writeComputedPosition = new TexturePositionNode(/* isDecode = */ false);\n    this.panZoomDecode = new PanzoomTransform({decode: true});\n    this.panZoomEncode = new PanzoomTransform({decode: false});\n\n    this.colorMode = options && options.colorMode;\n  }\n\n  setCustomVectorField(velocityCode) {\n    this.udfVelocity.setNewUpdateCode(velocityCode);\n  }\n\n  getVertexShader () {\n    return `precision highp float;\n\nattribute vec2 a_pos;\nvarying vec2 v_tex_pos;\nuniform vec2 u_min;\nuniform vec2 u_max;\n\nvoid main() {\n    v_tex_pos = a_pos;\n    gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n}`\n  }\n\n  getFragmentShader() {\n    var nodes = [\n      this.readStoredPosition,\n      this.dropParticles,\n      this.udfVelocity,\n      this.integratePositions, {\n        getMainBody() {\n          return `\n  vec2 newPos = pos + velocity;\n  `\n        }\n      },\n      this.writeComputedPosition\n    ];\n    return renderNodes(nodes);\n  }\n}\n\nclass RandomParticleDropper extends BaseShaderNode {\n  getDefines() {\n    return `\nuniform float u_drop_rate;\nuniform float u_rand_seed;\nuniform vec2 u_min;\nuniform vec2 u_max;\n`\n  }\n\n  getFunctions() {\n    // TODO: Ideally this node should probably depend on\n    // random number generator node, so that we don't duplicate code\n    return `\n// pseudo-random generator\nconst vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\nfloat rand(const vec2 co) {\n    float t = dot(rand_constants.xy, co);\n    return fract(sin(t) * (rand_constants.z + t));\n}\n`\n  }\n\n  getMainBody() {\n    return `\n  // a random seed to use for the particle drop\n  vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n  // drop rate is a chance a particle will restart at random position, to avoid degeneration\n  float drop = step(1.0 - u_drop_rate, rand(seed));\n\n  // TODO: This can be customized to produce various emitters\n  // random_pos is in range from 0..1, we move it to the bounding box:\n  vec2 random_pos = vec2(rand(seed + 1.9), rand(seed + 8.4)) * (u_max - u_min) + u_min;\n  pos = mix(pos, random_pos, drop);\n`;\n  }\n\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/shaderGraph/updatePositionGraph.js","\nexport default function renderNodes(nodes) {\n  let code = [] \n\n  nodes.forEach(node => { if (node.getDefines) addToCode(node.getDefines()); });\n  nodes.forEach(node => { if (node.getFunctions) addToCode(node.getFunctions()); });\n\n  addToCode('void main() {')\n    nodes.forEach(node => { if (node.getMainBody) addToCode(node.getMainBody()); });\n  addToCode('}')\n  return code.join('\\n');\n\n  function addToCode(line) {\n    if (line) code.push(line)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/shaderGraph/renderNodes.js","/**\n * A simple interface to compute eventual min/max \n */\nexport default function makeStatCounter() {\n  var min, max;\n\n  var api = {\n    getMin() { return min; },\n    getMax() { return max; },\n    add(x) {\n      if (x < min) min = x;\n      if (x > max) max = x;\n    },\n    reset: reset\n  };\n\n  return api;\n\n  function reset() {\n    min = Number.POSITIVE_INFINITY;\n    max = Number.NEGATIVE_INFINITY;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils/makeStatCounter.js","/**\n * A shader function to decode rgba encoded color into float position.\n */\nconst code = `\nhighp float decodeFloatRGBA( vec4 v ) {\n  float a = floor(v.r * 255.0 + 0.5);\n  float b = floor(v.g * 255.0 + 0.5);\n  float c = floor(v.b * 255.0 + 0.5);\n  float d = floor(v.a * 255.0 + 0.5);\n\n  float exponent = a - 127.0;\n  float sign = 1.0 - mod(d, 2.0)*2.0;\n  float mantissa = float(a > 0.0)\n                  + b / 256.0\n                  + c / 65536.0\n                  + floor(d / 2.0) / 8388608.0;\n  return sign * mantissa * exp2(exponent);\n}\n`\n\nexport default code;\n\n\n// WEBPACK FOOTER //\n// ./src/lib/shaderGraph/parts/decodeFloatRGBA.js","import BaseShaderNode from './BaseShaderNode';\nimport encodeFloatRGBA from './parts/encodeFloatRGBA';\nimport decodeFloatRGBA from './parts/decodeFloatRGBA';\n\n/**\n * Reads/writes particle coordinates from/to a texture;\n */\nexport default class TexturePosition extends BaseShaderNode {\n  constructor(isDecode) {\n    super();\n\n    // When it's decoding, it must read from the texture.\n    // Otherwise it must write to the texture;\n    this.isDecode = isDecode;\n  }\n\n  getFunctions() {\n    if (this.isDecode) {\n      return `\n    ${encodeFloatRGBA}\n    ${decodeFloatRGBA}\n`\n    }\n  }\n\n  getDefines() {\n    if (this.isDecode) {\n      // TODO: How to avoid duplication and silly checks?\n    return `\nprecision highp float;\n\nuniform sampler2D u_particles_x;\nuniform sampler2D u_particles_y;\n\n// Which coordinate needs to be printed onto the texture\nuniform int u_out_coordinate;\n\nvarying vec2 v_tex_pos;\n`;\n    }\n  }\n\n  getMainBody() {\n  if (this.isDecode) {\n    return `\n   vec2 pos = vec2(\n     decodeFloatRGBA(texture2D(u_particles_x, v_tex_pos)),\n     decodeFloatRGBA(texture2D(u_particles_y, v_tex_pos))\n   );\n`\n    }\n    return `\n    if (u_out_coordinate == 0) gl_FragColor = encodeFloatRGBA(newPos.x);\n    else if (u_out_coordinate == 1) gl_FragColor = encodeFloatRGBA(newPos.y);\n    else if (u_out_coordinate == 6) gl_FragColor = encodeFloatRGBA(get_velocity(pos).x);\n    else if (u_out_coordinate == 7) gl_FragColor = encodeFloatRGBA(get_velocity(pos).y);\n`\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/shaderGraph/TexturePositionNode.js","/**\n * The main entry point to the application.\n * \n * It is initialized immediately with webgl, and puts\n * vue.js app loading into the future.\n */\nimport initScene from './scene';\nimport bus from './bus';\n\nvar canvas = document.getElementById('scene');\n// Canvas may not be available in test run\nif (canvas) initVectorFieldApp(canvas);\n\n// Tell webpack to split bundle, and download settings UI later.\nrequire.ensure('@/vueApp.js', () => {\n  // Settings UI is ready, initialize vue.js application\n  require('@/vueApp.js');\n});\n\nfunction initVectorFieldApp(canvas) {\n  canvas.width = window.innerWidth;\n  canvas.height =  window.innerHeight;\n  var ctxOptions = {antialiasing: false };\n\n  var gl = canvas.getContext('webgl', ctxOptions) ||\n          canvas.getContext('experimental-webgl', ctxOptions);\n\n  if (gl) {\n    window.webGLEnabled = true;\n    var scene = initScene(gl);\n    scene.start();\n    window.scene = scene;\n  } else {\n    window.webGLEnabled = false;\n  }\n}\n\nvar CCapture;\nvar currentCapturer;\n\nwindow.startRecord = startRecord;\nwindow.isRecording = false;\n\nfunction startRecord(url) {\n  if (!CCapture) {\n    require.ensure('ccapture.js', () => {\n      CCapture = require('ccapture.js');\n      window.stopRecord = stopRecord;\n      startRecord(url);\n    });\n\n    return;\n  }\n\n  if (currentCapturer) {\n    currentCapturer.stop();\n  }\n\n  if (!ffmpegScriptLoaded()) {\n    var ffmpegServer = document.createElement('script');\n    ffmpegServer.setAttribute('src', url || 'http://localhost:8080/ffmpegserver/ffmpegserver.js');\n    ffmpegServer.onload = () => startRecord(url);\n    document.head.appendChild(ffmpegServer);\n    return;\n  }\n\n  currentCapturer = new CCapture( {\n      format: 'ffmpegserver',\n      framerate: 60,\n      verbose: true,\n      name: \"fieldplay\",\n      extension: \".mp4\",\n      codec: \"mpeg4\",\n      ffmpegArguments: [\n        \"-b:v\", \"12M\",\n      ],\n  });\n\n  window.isRecording = true;\n  currentCapturer.start();\n  bus.fire('start-record', currentCapturer)\n}\n\nfunction ffmpegScriptLoaded() {\n  return typeof FFMpegServer !== 'undefined'\n}\n\nfunction stopRecord() {\n  window.isRecording = false;\n  bus.fire('stop-record', currentCapturer)\n  currentCapturer.stop();\n  currentCapturer.save();\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/nativeMain.js","const code = `\nvec4 encodeFloatRGBA(highp float val) {\n    if (val == 0.0) {\n        return vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    float mag = abs(val);\n    float exponent = floor(log2(mag));\n    // Correct log2 approximation errors.\n    exponent += float(exp2(exponent) <= mag / 2.0);\n    exponent -= float(exp2(exponent) > mag);\n\n    float mantissa;\n    if (exponent > 100.0) {\n        // Not sure why this needs to be done in two steps for the largest float to work.\n        // Best guess is the optimizer rewriting '/ exp2(e)' into '* exp2(-e)',\n        // but exp2(-128.0) is too small to represent.\n        mantissa = mag / 1024.0 / exp2(exponent - 10.0) - 1.0;\n    } else {\n        mantissa = mag / float(exp2(exponent)) - 1.0;\n    }\n\n    float a = exponent + 127.0;\n    mantissa *= 256.0;\n    float b = floor(mantissa);\n    mantissa -= b;\n    mantissa *= 256.0;\n    float c = floor(mantissa);\n    mantissa -= c;\n    mantissa *= 128.0;\n    float d = floor(mantissa) * 2.0 + float(val < 0.0);\n    return vec4(a, b, c, d) / 255.0;\n}\n`\n\nexport default code;\n\n\n// WEBPACK FOOTER //\n// ./src/lib/shaderGraph/parts/encodeFloatRGBA.js","import decodeFloatRGBA from './parts/decodeFloatRGBA';\nimport shaderBasedColor from './shaderBasedColor';\nimport ColorModes from '../programs/colorModes';\n\n// TODO: this duplicates code from texture position.\nexport default class DrawParticleGraph {\n  constructor(colorMode) {\n    this.colorMode = colorMode;\n    this.isUniformColor = (colorMode === ColorModes.UNIFORM);\n  }\n\n  getFragmentShader() {\n    let variables = [];\n    var mainBody = [];\n\n    if (this.isUniformColor) {\n      // uniform color comes via uniform setting\n      variables.push('uniform vec4 u_particle_color;');\n      mainBody.push('gl_FragColor = u_particle_color;');\n    } else {\n      // Otherwise it comes from a vertex shader\n      variables.push('varying vec4 v_particle_color;');\n      mainBody.push('gl_FragColor = v_particle_color;');\n    }\n    return `precision highp float;\n${variables.join('\\n')}\n\nvoid main() {\n${mainBody.join('\\n')}\n}`\n  }\n\n  getVertexShader(vfCode) {\n    let decodePositions = textureBasedPosition();\n    let colorParts = this.isUniformColor ? uniformColor() : shaderBasedColor(this.colorMode, vfCode);\n    let methods = []\n    addMethods(decodePositions, methods);\n    addMethods(colorParts, methods);\n    let main = [];\n    addMain(decodePositions, main);\n    addMain(colorParts, main);\n\n    return `precision highp float;\nattribute float a_index;\nuniform float u_particles_res;\nuniform vec2 u_min;\nuniform vec2 u_max;\n\n${decodePositions.getVariables() || ''}\n${colorParts.getVariables() || ''}\n\n${decodeFloatRGBA}\n\n${methods.join('\\n')}\n\nvoid main() {\n  vec2 txPos = vec2(\n        fract(a_index / u_particles_res),\n        floor(a_index / u_particles_res) / u_particles_res);\n  gl_PointSize = 1.0;\n\n${main.join('\\n')}\n\n  vec2 du = (u_max - u_min);\n  v_particle_pos = (v_particle_pos - u_min)/du;\n  gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, (1. - 2. * (v_particle_pos.y)),  0., 1.);\n}`\n  }\n}\n\nfunction addMethods(producer, array) {\n  if (producer.getMethods) {\n    array.push(producer.getMethods());\n  }\n}\nfunction addMain(producer, array) {\n  if (producer.getMain) {\n    array.push(producer.getMain());\n  }\n}\n\nfunction uniformColor() {\n  return {\n    getVariables() {},\n    getMain() {}\n  }\n}\n\nfunction textureBasedPosition() {\n  return {\n    getVariables,\n    getMain\n  }\n\n  function getVariables() {\n    return `\nuniform sampler2D u_particles_x;\nuniform sampler2D u_particles_y;\n    `\n  }\n\n  function getMain() {\n    return `\n  vec2 v_particle_pos = vec2(\n    decodeFloatRGBA(texture2D(u_particles_x, txPos)),\n    decodeFloatRGBA(texture2D(u_particles_y, txPos))\n  );\n`\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/shaderGraph/DrawParticleGraph.js","export function getInputUniforms() {\n  return `uniform sampler2D input0;\nuniform sampler2D input1;`;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/shaderGraph/customInput.js","import UserDefinedVelocityFunction from './UserDefinedVelocityFunction';\nimport RungeKuttaIntegrator from './RungeKuttaIntegrator';\nimport ColorModes from '../programs/colorModes';\n\nexport default function shaderBasedColor(colorMode, vfCode) {\n  var udf = new UserDefinedVelocityFunction(vfCode);\n  var integrate = new RungeKuttaIntegrator();\n\n  return {\n    getVariables,\n    getMain,\n    getMethods\n  }\n\n  function getVariables() {\n    return `\nuniform vec2 u_velocity_range;\nvarying vec4 v_particle_color;\n${udf.getDefines()}\n${integrate.getDefines()}\n`\n  }\n\n  function getMethods() {\n    return `\n// https://github.com/hughsk/glsl-hsv2rgb\nvec3 hsv2rgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\n${udf.getFunctions()}\n${integrate.getFunctions()}\n`\n  }\n\n  function getMain() {\n    // TODO: This needs to be refactored. I don't like code duplication.\n    let setParticleColor;\n    if (colorMode === ColorModes.VELOCITY) {\n      setParticleColor = `\n  float speed = (length(velocity) - u_velocity_range[0])/(u_velocity_range[1] - u_velocity_range[0]);\n  v_particle_color = vec4(hsv2rgb(vec3(0.05 + (1. - speed) * 0.5, 0.9, 1.)), 1.0);\n`\n    } else {\n      setParticleColor = `\n  float speed = (atan(velocity.y, velocity.x) + PI)/(2.0 * PI);\n  v_particle_color = vec4(hsv2rgb(vec3(speed, 0.9, 1.)), 1.0);\n`;\n}\n\n    return `\nvec2 velocity = get_velocity(v_particle_pos);\n${setParticleColor}\n`\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/shaderGraph/shaderBasedColor.js","import bus from '../bus';\nimport appState from '../appState';\nimport getParsedVectorFieldFunction from './getParsedVectorFieldFunction';\n\n/**\n * A text editor state for the vector field equation. Manages vector field\n * program compilation and error reporting state.\n *\n * @param {Object} drawProgram \n */\nexport default function createVectorFieldEditorState(drawProgram) {\n  bus.on('glsl-parser-ready', parseCode);\n  var currentVectorFieldVersion = 0;\n\n  // What is the current code?\n  var currentVectorFieldCode = appState.getCode();\n\n  // For delayed parsing result verification (e.g. when vue is loaded it\n  // can request us to see if there were any errors)\n  var parserResult;\n\n  loadCodeFromAppState();\n\n  var api = {\n    getCode,\n    setCode,\n    dispose,\n\n    // These properties are for UI only\n    code: currentVectorFieldCode,\n    error: '',\n    errorDetail: '',\n    isFloatError: false \n  };\n\n  return api;\n\n  function dispose() {\n    bus.off('glsl-parser-ready', parseCode);\n  }\n\n  function getCode() {\n    return appState.getCode();\n  }\n\n  function setCode(vectorFieldCode) {\n    if (vectorFieldCode === currentVectorFieldCode) {\n      // If field hasn't changed, let's make sure that there was no previous\n      // error\n      if (parserResult && parserResult.error) {\n        // And if there was error, let's revalidate code:\n        parseCode();\n      }\n      return;\n    } \n\n    trySetNewCode(vectorFieldCode).then((result) => {\n      if (result.cancelled) return;\n\n      if (result && result.error) {\n        updateErrorInfo(result.error);\n        return result;\n      }\n\n      currentVectorFieldCode = vectorFieldCode;\n      api.code = vectorFieldCode;\n      appState.saveCode(vectorFieldCode);\n    });\n  }\n\n  function updateErrorInfo(parserResult) {\n    if (parserResult && parserResult.error) {\n      api.error = parserResult.error;\n      api.errorDetail = parserResult.errorDetail;\n      api.isFloatError = parserResult.isFloatError;\n    } else {\n      api.error = '';\n      api.errorDetail = '';\n      api.isFloatError = false;\n    }\n  }\n\n  function loadCodeFromAppState() {\n    let persistedCode = appState.getCode();\n    if (persistedCode) {\n      trySetNewCode(persistedCode).then(result => {\n        if (!result.error) return; // This means we set correctly;\n        // If we get here - something went wrong. see the console\n        console.error('Failed to restore previous vector field: ', result.error);\n        // Let's use default vector field\n        trySetNewCode(appState.getDefaultCode());\n      });\n    } else {\n      // we want a default vector field\n      trySetNewCode(appState.getDefaultCode());\n    }\n  }\n\n  function parseCode(customCode) {\n    return getParsedVectorFieldFunction(customCode || currentVectorFieldCode)\n      .then(currentResult => {\n        parserResult = currentResult\n        updateErrorInfo(parserResult.error);\n        return parserResult;\n      });\n  }\n\n  function trySetNewCode(vectorFieldCode) {\n    currentVectorFieldVersion += 1;\n    var capturedVersion = currentVectorFieldVersion;\n    // step 1 - run through parser\n    return parseCode(vectorFieldCode).then(parserResult => {\n      if (capturedVersion !== currentVectorFieldVersion) {\n        parserResult.cancelled = true;\n        // a newer request was issued. Ignore these results.\n        return parserResult;\n      }\n\n      if (parserResult.error) {\n        return parserResult;\n      }\n      // step 2 - run through real webgl\n      try {\n        drawProgram.updateCode(parserResult.code);\n        return parserResult;\n      } catch (e) {\n        return {\n          error: {\n            error: e.message\n          }\n        }\n      }\n    });\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/editor/vectorFieldState.js","/**\n * Wraps a simple vector field string into our default shader code.\n * @param {String} field \n */\nexport default function wrapVectorField(field) {\n  return `// p.x and p.y are current coordinates\n// v.x and v.y is a velocity at point p\nvec2 get_velocity(vec2 p) {\n  vec2 v = vec2(0., 0.);\n\n  // change this to get a new vector field\n  ${field}\n\n  return v;\n}`\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/wrapVectorField.js","/**\n * A simple message bus. Facilitates uncoupled communication between\n * components of fieldplay.\n */\nvar eventify = require('ngraph.events');\n\nmodule.exports = eventify({});\n\n\n// WEBPACK FOOTER //\n// ./src/lib/bus.js","// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Tutorial/Using_textures_in_WebGL\nexport default function loadTexture(gl, url) {\n  var resolveTexture, rejectTexture;\n\n  var image = new Image();\n  image.crossOrigin = '';\n\n  image.onload = bindTexture;\n  image.onerror = reportError;\n  image.src = url;\n\n  return new Promise((resolve, reject) => {\n    resolveTexture = resolve;\n    rejectTexture = reject;\n  });\n\n  function reportError(err) {\n    rejectTexture(err);\n  }\n\n  function bindTexture() {\n    var texture = gl.createTexture();\n    var level = 0;\n    var internalFormat = gl.RGBA;\n    var srcFormat = gl.RGBA;\n    var srcType = gl.UNSIGNED_BYTE;\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat,\n                  srcFormat, srcType, image);\n\n    if (isPowerOf2(image.width) && isPowerOf2(image.height)) {\n       gl.generateMipmap(gl.TEXTURE_2D);\n    } else {\n       gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n       gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n       gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    }\n\n    resolveTexture(texture);\n  }\n}\n\nfunction isPowerOf2(value) {\n  return (value & (value - 1)) == 0;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/programs/inputs/loadTexture.js","module.exports = function(subject) {\n  validateSubject(subject);\n\n  var eventsStorage = createEventsStorage(subject);\n  subject.on = eventsStorage.on;\n  subject.off = eventsStorage.off;\n  subject.fire = eventsStorage.fire;\n  return subject;\n};\n\nfunction createEventsStorage(subject) {\n  // Store all event listeners to this hash. Key is event name, value is array\n  // of callback records.\n  //\n  // A callback record consists of callback function and its optional context:\n  // { 'eventName' => [{callback: function, ctx: object}] }\n  var registeredEvents = Object.create(null);\n\n  return {\n    on: function (eventName, callback, ctx) {\n      if (typeof callback !== 'function') {\n        throw new Error('callback is expected to be a function');\n      }\n      var handlers = registeredEvents[eventName];\n      if (!handlers) {\n        handlers = registeredEvents[eventName] = [];\n      }\n      handlers.push({callback: callback, ctx: ctx});\n\n      return subject;\n    },\n\n    off: function (eventName, callback) {\n      var wantToRemoveAll = (typeof eventName === 'undefined');\n      if (wantToRemoveAll) {\n        // Killing old events storage should be enough in this case:\n        registeredEvents = Object.create(null);\n        return subject;\n      }\n\n      if (registeredEvents[eventName]) {\n        var deleteAllCallbacksForEvent = (typeof callback !== 'function');\n        if (deleteAllCallbacksForEvent) {\n          delete registeredEvents[eventName];\n        } else {\n          var callbacks = registeredEvents[eventName];\n          for (var i = 0; i < callbacks.length; ++i) {\n            if (callbacks[i].callback === callback) {\n              callbacks.splice(i, 1);\n            }\n          }\n        }\n      }\n\n      return subject;\n    },\n\n    fire: function (eventName) {\n      var callbacks = registeredEvents[eventName];\n      if (!callbacks) {\n        return subject;\n      }\n\n      var fireArguments;\n      if (arguments.length > 1) {\n        fireArguments = Array.prototype.splice.call(arguments, 1);\n      }\n      for(var i = 0; i < callbacks.length; ++i) {\n        var callbackInfo = callbacks[i];\n        callbackInfo.callback.apply(callbackInfo.ctx, fireArguments);\n      }\n\n      return subject;\n    }\n  };\n}\n\nfunction validateSubject(subject) {\n  if (!subject) {\n    throw new Error('Eventify cannot use falsy object as events subject');\n  }\n  var reservedWords = ['on', 'fire', 'off'];\n  for (var i = 0; i < reservedWords.length; ++i) {\n    if (subject.hasOwnProperty(reservedWords[i])) {\n      throw new Error(\"Subject cannot be eventified, since it already has property '\" + reservedWords[i] + \"'\");\n    }\n  }\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../query-state/~/ngraph.events/index.js\n// module id = fkI9\n// module chunks = 4","import util from '../gl-utils';\nimport bus from '../bus';\nimport {decodeFloatRGBA} from '../utils/floatPacking';\nimport makeStatCounter from '../utils/makeStatCounter';\n\nconst OUT_V_X = 6;\nconst OUT_V_Y = 7;\n/**\n * This program allows to change color of each particle. It works by\n * reading current velocities into a texture from the framebuffer. Once\n * velocities are read, it checks velocity scale and passes it to a draw program.\n */\nexport default function colorProgram(ctx) {\n  var speedNeedsUpdate = true;\n  var {gl} = ctx;\n  var velocity_y_texture, velocity_x_texture;\n  var particleStateResolution;\n  var pendingSpeedUpdate;\n  var numParticles;\n  var velocityCounter = makeStatCounter();\n  var velocity_x;\n  var velocity_y;\n\n  listenToEvents();\n\n  return {\n    updateCode,\n    updateParticlesPositions,\n    updateParticlesCount,\n    setColorMinMax,\n    requestSpeedUpdate,\n    dispose\n  };\n\n  function listenToEvents() {\n    bus.on('integration-timestep-changed', requestSpeedUpdate);\n    bus.on('bbox-change', requestSpeedUpdate);\n    bus.on('refresh-speed', requestSpeedUpdate);\n  }\n\n  function dispose() {\n    bus.off('integration-timestep-changed', requestSpeedUpdate);\n    bus.off('bbox-change', requestSpeedUpdate);\n    bus.off('refresh-speed', requestSpeedUpdate);\n    disposeTextures();\n  }\n\n  function disposeTextures() {\n    if (velocity_x_texture) gl.deleteTexture(velocity_x_texture);\n    if (velocity_y_texture) gl.deleteTexture(velocity_y_texture);\n  }\n\n  function requestSpeedUpdate() {\n    if (pendingSpeedUpdate) clearTimeout(pendingSpeedUpdate);\n    pendingSpeedUpdate = setTimeout(() => {\n      speedNeedsUpdate = true;\n      pendingSpeedUpdate = 0;\n    }, 50);\n  }\n\n  function setColorMinMax(program) {\n    gl.uniform2f(program.u_velocity_range, velocityCounter.getMin(), velocityCounter.getMax());\n  }\n\n  function updateParticlesCount() {\n    disposeTextures();\n\n    particleStateResolution = ctx.particleStateResolution;\n    numParticles = particleStateResolution * particleStateResolution;\n\n    velocity_x = new Uint8Array(numParticles * 4);\n    velocity_y = new Uint8Array(numParticles * 4);\n    velocity_x_texture = util.createTexture(gl, gl.NEAREST, velocity_x, particleStateResolution, particleStateResolution);\n    velocity_y_texture = util.createTexture(gl, gl.NEAREST, velocity_y, particleStateResolution, particleStateResolution);\n\n    requestSpeedUpdate();\n  }\n\n  function updateCode() {\n    requestSpeedUpdate();\n  }\n\n  function updateParticlesPositions(program) {\n    if (!speedNeedsUpdate || !velocity_x || !velocity_y) return;\n    speedNeedsUpdate = false;\n\n    // We assume this is called from update position program\n    util.bindFramebuffer(gl, ctx.framebuffer, velocity_x_texture);\n    gl.uniform1i(program.u_out_coordinate, OUT_V_X);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    gl.readPixels(0, 0, particleStateResolution, particleStateResolution, gl.RGBA, gl.UNSIGNED_BYTE, velocity_x);\n\n    util.bindFramebuffer(gl, ctx.framebuffer, velocity_y_texture);\n    gl.uniform1i(program.u_out_coordinate, OUT_V_Y);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    gl.readPixels(0, 0, particleStateResolution, particleStateResolution, gl.RGBA, gl.UNSIGNED_BYTE, velocity_y);\n\n    updateMinMax();\n  }\n\n  function updateMinMax() {\n    velocityCounter.reset();\n    // TODO: Do I want this to be async?\n    for(var i = 0; i < velocity_y.length; i+=4) {\n      var vx = readFloat(velocity_x, i);\n      var vy = readFloat(velocity_y, i);\n      var v = Math.sqrt(vx * vx + vy * vy);\n      velocityCounter.add(v);\n    }\n  }\n}\n\nfunction readFloat(buffer, offset) {\n    return decodeFloatRGBA(\n      buffer[offset + 0],\n      buffer[offset + 1],\n      buffer[offset + 2],\n      buffer[offset + 3]\n    );\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/programs/colorProgram.js","/**\n * Renders computed state onto the screen.\n */\nimport glUtils from '../gl-utils';\n\nconst NO_TRANSFORM = {dx: 0, dy: 0, scale: 1};\n\nexport default function makeScreenProgram(ctx) {\n  var {gl, canvasRect} = ctx;\n\n  var screenTexture, backgroundTexture;\n  var boundBoxTextureTransform = {dx: 0, dy: 0, scale: 1};\n  var lastRenderedBoundingBox = null;\n\n  // TODO: Allow customization? Last time I tried, I didn't like it too much.\n  // It was very easy to screw up the design, and the tool looked ugly :-/\n  let backgroundColor = { r: 19/255, g: 41/255, b: 79/255, a: 1 };\n\n  updateScreenTextures();\n  var screenProgram = glUtils.createProgram(gl, getScreenVertexShader(), getScreenFragmentShader());\n  \n  var api = {\n    fadeOutLastFrame,\n    renderCurrentScreen,\n    updateScreenTextures,\n\n    boundingBoxUpdated: false\n  };\n\n  return api;\n  \n  function fadeOutLastFrame() {\n    // render to the frame buffer\n    glUtils.bindFramebuffer(gl, ctx.framebuffer, screenTexture);\n    gl.viewport(0, 0, canvasRect.width, canvasRect.height);\n\n    if (api.boundingBoxUpdated && lastRenderedBoundingBox) {\n      // We move the back texture, relative to the bounding box change. This eliminates\n      // particle train artifacts, though, not all of them: https://computergraphics.stackexchange.com/questions/5754/fading-particles-and-transition\n      // If you know how to improve this - please let me know.\n      boundBoxTextureTransform.dx = -(ctx.bbox.minX - lastRenderedBoundingBox.minX)/(ctx.bbox.maxX - ctx.bbox.minX);\n      boundBoxTextureTransform.dy = -(ctx.bbox.minY - lastRenderedBoundingBox.minY)/(ctx.bbox.maxY - ctx.bbox.minY);\n      boundBoxTextureTransform.scale = (ctx.bbox.maxX - ctx.bbox.minX) / (lastRenderedBoundingBox.maxX - lastRenderedBoundingBox.minX);\n      drawTexture(backgroundTexture, ctx.fadeOpacity, boundBoxTextureTransform);\n    } else {\n      drawTexture(backgroundTexture, ctx.fadeOpacity, NO_TRANSFORM)\n    }\n  }\n\n  function renderCurrentScreen() {\n    glUtils.bindFramebuffer(gl, null);\n\n    saveLastBbox();\n\n    gl.enable(gl.BLEND); \n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    gl.clearColor(backgroundColor.r, backgroundColor.g, backgroundColor.b, backgroundColor.a);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    drawTexture(screenTexture, 1.0, NO_TRANSFORM);\n    gl.disable(gl.BLEND);\n\n    var temp = backgroundTexture;\n    backgroundTexture = screenTexture;\n    screenTexture = temp;\n\n    api.boundingBoxUpdated = false;\n    if (window.audioTexture) {\n      drawTexture(window.audioTexture, 1.0, NO_TRANSFORM);\n    }\n  }\n\n  function updateScreenTextures() {\n    var {width, height} = canvasRect;\n    var emptyPixels = new Uint8Array(width * height * 4);\n    if (screenTexture) {\n      gl.deleteTexture(screenTexture);\n    }\n    if (backgroundTexture) {\n      gl.deleteTexture(backgroundTexture);\n    }\n\n    screenTexture = glUtils.createTexture(gl, gl.NEAREST, emptyPixels, width, height);\n    backgroundTexture = glUtils.createTexture(gl, gl.NEAREST, emptyPixels, width, height);\n  }\n\n  function saveLastBbox() {\n    if (!lastRenderedBoundingBox) {\n      lastRenderedBoundingBox = {\n        minX: ctx.bbox.minX,\n        minY: ctx.bbox.minY,\n        maxX: ctx.bbox.maxX,\n        maxY: ctx.bbox.maxY\n      }\n\n      return;\n    } \n\n    lastRenderedBoundingBox.minX = ctx.bbox.minX;\n    lastRenderedBoundingBox.minY = ctx.bbox.minY;\n    lastRenderedBoundingBox.maxX = ctx.bbox.maxX;\n    lastRenderedBoundingBox.maxY = ctx.bbox.maxY;\n  }\n\n  function drawTexture(texture, opacity, textureTransform) {\n    var program = screenProgram;\n    gl.useProgram(program.program);\n    glUtils.bindAttribute(gl, ctx.quadBuffer, program.a_pos, 2);\n\n    // TODO: This index is very fragile. I need to find a way\n    glUtils.bindTexture(gl, texture, ctx.screenTextureUnit);\n    gl.uniform1i(program.u_screen, ctx.screenTextureUnit);\n\n    gl.uniform1f(program.u_opacity_border, 0.02);\n    gl.uniform1f(program.u_opacity, opacity);\n    gl.uniform3f(program.u_transform, textureTransform.dx, textureTransform.dy, textureTransform.scale);\n\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n}\n\nfunction getScreenVertexShader() {\n  return `// screen program\nprecision highp float;\n\nattribute vec2 a_pos;\nvarying vec2 v_tex_pos;\nuniform vec3 u_transform;\n\nvoid main() {\n    v_tex_pos = a_pos;\n    vec2 pos = a_pos;\n\n    // This transformation tries to move texture (raster) to the approximate position\n    // of particles on the current frame. This is needed to avoid rendering artifacts\n    // during pan/zoom: https://computergraphics.stackexchange.com/questions/5754/fading-particles-and-transition\n\n    // PS: I must admit, I wrote this formula through sweat and tears, and\n    // I still have no idea why I don't need to apply (pos.y - 0.5) to Y coordinate.\n    // Is it because I use aspect ratio for bounding box?\n    pos.x = (pos.x - 0.5) / u_transform.z - u_transform.x + 0.5 * u_transform.z;\n    pos.y = pos.y / u_transform.z + u_transform.y;\n\n    pos = 1.0 - 2.0 * pos;\n    gl_Position = vec4(pos, 0, 1);\n}`\n}\n\nfunction getScreenFragmentShader() {\n  return `precision highp float;\nuniform sampler2D u_screen;\nuniform float u_opacity;\nuniform float u_opacity_border;\n\nvarying vec2 v_tex_pos;\n\nvoid main() {\n  vec2 p = 1.0 - v_tex_pos;\n  vec4 color = texture2D(u_screen, p);\n\n  // For some reason particles near border leave trace when we translate the texture\n  // This is my dirty hack to fix it: https://computergraphics.stackexchange.com/questions/5754/fading-particles-and-transition\n  if (p.x < u_opacity_border || p.x > 1. - u_opacity_border || p.y < u_opacity_border || p.y > 1. - u_opacity_border) {\n    gl_FragColor = vec4(0.);\n  } else {\n    // opacity fade out even with a value close to 0.0\n    gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n  }\n}`\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/programs/screenProgram.js","import BaseShaderNode from './BaseShaderNode';\n\nexport default class RungeKuttaIntegrator extends BaseShaderNode {\n  constructor () {\n    super();\n  }\n\n  getDefines() {\n    return `\nuniform float u_h;\n`\n  }\n\n  getFunctions() {\n    return `\nvec2 rk4(const vec2 point) {\n  vec2 k1 = get_velocity( point );\n  vec2 k2 = get_velocity( point + k1 * u_h * 0.5);\n  vec2 k3 = get_velocity( point + k2 * u_h * 0.5);\n  vec2 k4 = get_velocity( point + k3 * u_h);\n\n  return k1 * u_h / 6. + k2 * u_h/3. + k3 * u_h/3. + k4 * u_h/6.;\n}`\n  }\n\n  getMainBody() {\n    return `\n  vec2 velocity = rk4(pos);\n`\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/shaderGraph/RungeKuttaIntegrator.js","var loadedLinks = new Map(); // from link to response\nimport request from '../utils/request';\n\nexport default function fetchGLSL(link) {\n  if (!link) return Promise.reject('Missing link')\n  var trimmed = link.trim();\n  if (!trimmed) return Promise.reject('Missing link');\n\n  let cachedResponse = loadedLinks.get(trimmed)\n  if (cachedResponse) return Promise.resolve(cachedResponse);\n\n  return request(link).then(code => {\n    loadedLinks.set(link, code);\n    return code;\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/editor/fetchGLSL.js","/**\n * Collection of input bindings. Individual program works with this collection\n * to command it update texture bindings.\n */\nexport default function createInputCollection() {\n  var boundInputs = new Map() \n  var currentProgram;\n  return {\n    updateBindings,\n    bindInput,\n  }\n\n  function bindInput(inputIndex, inputBinding) {\n    var prevBinding = boundInputs.get(inputIndex);\n    if (prevBinding) {\n      prevBinding.dispose();\n    }\n    boundInputs.set(inputIndex, inputBinding);\n  }\n\n  function updateBindings(program) {\n    currentProgram = program;\n    boundInputs.forEach(updateInputBinding);\n  }\n\n  function updateInputBinding(input, inputIndex) {\n    input.updateBinding(currentProgram, inputIndex);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/programs/inputs/inputCollection.js","/**\n * Enables panning and zooming of canvas with vector field\n * \n * @param {HTMLCanvasElement} canvas that needs to be panned and zoomed\n * @param {*} updateBoundingBoxCallback callback that is called when vector field bounding box\n * needs to be updated\n */\nexport default function wglPanZoom(canvas, updateBoundingBoxCallback) {\n  var lastDx = 0;\n  var lastDy = 0;\n  var lastScale = 1;\n\n  // We need to be moved at least this many pixels in order to let\n  // transform update bounding box.\n  var transformThreshold = 2.1;\n\n  return {\n    applyTransform(newTransform) {\n      var dx = newTransform.x;\n      var dy = newTransform.y; \n\n      let dScale = (lastScale - newTransform.scale);\n      if (dScale === 0 && \n          Math.abs(dx - lastDx) < transformThreshold &&\n          Math.abs(dy - lastDy) < transformThreshold) {\n          // Wait for larger transform\n          return; \n      }\n\n      lastDx = dx;\n      lastDy = dy;\n      lastScale = newTransform.scale;\n\n      updateBoundingBoxCallback(newTransform)\n    },\n\n    getOwner() {\n      return canvas\n    }\n  };\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/wglPanZoom.js","/**\n * This module allows to pass mouse coordinates down to the shader. Coordinates\n * will be available as `vec4 cursor` variable, where `xy` are the last\n * click position, and `zw` are the last hover position.\n * \n * Note: On Touch devices hover is the same click.\n * \n * Hopefully this will enables easier exploration\n */\nexport default function createCursorUpdater(ctx) {\n  var {canvasRect, bbox} = ctx;\n\n  window.addEventListener('mousemove', onMouseMove, true);\n  window.addEventListener('mousedown', onMouseClick, true);\n  window.addEventListener('touchstart', onTouchStart, true);\n  window.addEventListener('touchmove', onTouchMove, true);\n\n  return {\n    dispose\n  }\n\n  function dispose() {\n    window.removeEventListener('mousemove', onMouseMove, true);\n    window.removeEventListener('mousedown', onMouseClick, true);\n    window.removeEventListener('touchstart', onTouchStart, true);\n    window.removeEventListener('touchmove', onTouchMove, true);\n  }\n\n  function onTouchStart(e) {\n    var firstTouch = e.touches[0];\n    if (!firstTouch) return;\n\n    setClick(firstTouch.clientX, firstTouch.clientY);\n    setHover(firstTouch.clientX, firstTouch.clientY);\n  }\n\n  function onTouchMove(e) {\n    var firstTouch = e.touches[0];\n    if (!firstTouch) return;\n    setHover(firstTouch.clientX, firstTouch.clientY);\n  }\n\n  function onMouseMove(e) { setHover(e.clientX, e.clientY); }\n\n  function onMouseClick(e) { setClick(e.clientX, e.clientY); }\n\n  function setHover(clientX, clientY) {\n    ctx.cursor.hoverX = getSceneXFromClientX(clientX);\n    ctx.cursor.hoverY = getSceneYFromClientY(clientY);\n  }\n\n  function setClick(clientX, clientY) {\n    ctx.cursor.clickX = getSceneXFromClientX(clientX);\n    ctx.cursor.clickY = getSceneYFromClientY(clientY);\n  }\n\n  function getSceneXFromClientX(clientX) {\n    var dx = (clientX - canvasRect.left)/canvasRect.width;\n    return (bbox.maxX - bbox.minX) * dx + bbox.minX;\n  }\n\n  function getSceneYFromClientY(clientY) {\n    var dy = 1. - ((clientY - canvasRect.top)/canvasRect.height);\n    return (bbox.minY - bbox.maxY) * dy + bbox.maxY;\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils/cursorUpdater.js","import util from '../gl-utils';\nimport DrawParticleGraph from '../shaderGraph/DrawParticleGraph';\nimport makeUpdatePositionProgram from './updatePositionProgram';\nimport { encodeFloatRGBA } from '../utils/floatPacking.js';\nimport config from '../config';\nimport createAudioProgram from './audioProgram';\n\n/**\n * This program manages particles life-cycle. It updates particles positions\n * and initiates drawing them on screen.\n * \n * @param {Object} ctx rendering context. Holds WebGL state\n */\nexport default function drawParticlesProgram(ctx) {\n  var gl = ctx.gl;\n\n  var particleStateResolution, particleIndexBuffer;\n  var numParticles;\n\n  var currentVectorField = '';\n  var updatePositionProgram = makeUpdatePositionProgram(ctx);\n  var audioProgram;\n\n  var drawProgram;\n  initPrograms();\n\n  return {\n    updateParticlesCount,\n    updateParticlesPositions,\n    drawParticles,\n    updateCode,\n    updateColorMode\n  }\n\n  function initPrograms() {\n    // need to update the draw graph because color mode shader has changed.\n    initDrawProgram();\n\n    if (config.isAudioEnabled) {\n      if (audioProgram) audioProgram.dispose();\n      audioProgram = createAudioProgram(ctx);\n    }\n  }\n\n  function initDrawProgram() {\n    if (drawProgram) drawProgram.unload();\n\n    const drawGraph = new DrawParticleGraph(ctx.colorMode);\n    drawProgram = util.createProgram(gl, drawGraph.getVertexShader(currentVectorField), drawGraph.getFragmentShader());\n  }\n\n  function updateParticlesPositions() {\n    if (!currentVectorField) return;\n\n    ctx.frame += 1\n    ctx.frameSeed = Math.random();\n\n    // TODO: Remove this.\n    if (audioProgram) audioProgram.updateTextures();\n\n    updatePositionProgram.updateParticlesPositions();\n  }\n\n  function updateColorMode() {\n    initDrawProgram();\n  }\n\n  function updateCode(vfCode) {\n    ctx.frame = 0;\n    currentVectorField = vfCode;\n    updatePositionProgram.updateCode(vfCode);\n\n    initDrawProgram();\n  }\n\n  function updateParticlesCount() {\n    particleStateResolution = ctx.particleStateResolution;\n    numParticles = particleStateResolution * particleStateResolution;\n    var particleIndices = new Float32Array(numParticles);\n    var particleStateX = new Uint8Array(numParticles * 4);\n    var particleStateY = new Uint8Array(numParticles * 4);\n\n    var minX = ctx.bbox.minX; var minY = ctx.bbox.minY;\n    var width = ctx.bbox.maxX - minX;\n    var height = ctx.bbox.maxY - minY;\n    for (var i = 0; i < numParticles; i++) {\n      encodeFloatRGBA((Math.random()) * width + minX, particleStateX, i * 4); // randomize the initial particle positions\n      encodeFloatRGBA((Math.random()) * height + minY, particleStateY, i * 4); // randomize the initial particle positions\n\n      particleIndices[i] = i;\n    }\n\n    if (particleIndexBuffer) gl.deleteBuffer(particleIndexBuffer);\n    particleIndexBuffer = util.createBuffer(gl, particleIndices);\n\n    updatePositionProgram.updateParticlesCount(particleStateX, particleStateY);\n  }\n\n  function drawParticles() {\n    if (!currentVectorField) return;\n\n    var program = drawProgram;\n    gl.useProgram(program.program);\n  \n    util.bindAttribute(gl, particleIndexBuffer, program.a_index, 1);\n    \n    updatePositionProgram.prepareToDraw(program);\n    ctx.inputs.updateBindings(program);\n  \n    gl.uniform1f(program.u_h, ctx.integrationTimeStep);\n    gl.uniform1f(program.frame, ctx.frame);\n    gl.uniform1f(program.u_particles_res, particleStateResolution);\n    var bbox = ctx.bbox;\n    gl.uniform2f(program.u_min, bbox.minX, bbox.minY);\n    gl.uniform2f(program.u_max, bbox.maxX, bbox.maxY);\n  \n    var cursor = ctx.cursor;\n    gl.uniform4f(program.cursor, cursor.clickX, cursor.clickY, cursor.hoverX, cursor.hoverY);\n    gl.drawArrays(gl.POINTS, 0, numParticles); \n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/programs/drawParticlesProgram.js","/**\n * A wrapper over collection of textures. Can be used to represent\n * individual textures for every dimension.\n */\nimport glUtil from '../gl-utils';\n\nexport default function textureCollection(gl, dimensions, particleStateResolution) {\n  var textures = dimensions.map((d, index) => {\n    var textureInfo = {\n      texture: glUtil.createTexture(gl, gl.NEAREST, d.particleState, particleStateResolution, particleStateResolution),\n      index: index,\n      name: d.name\n    }\n\n    return textureInfo;\n  })\n\n  return {\n    dispose,\n    bindTextures,\n    assignProgramUniforms,\n    length: dimensions.length,\n    textures,\n    get(i) { return textures[i]; }\n  }\n\n  function assignProgramUniforms(program) {\n    textures.forEach(tInfo => {\n      gl.uniform1i(program['u_particles_' + tInfo.name], tInfo.index);\n    });\n  }\n\n  function dispose() {\n    textures.forEach(tInfo => gl.deleteTexture(tInfo.texture));\n  }\n\n  function bindTextures(gl, program) {\n    textures.forEach((tInfo) => {\n      glUtil.bindTexture(gl, tInfo.texture, tInfo.index);\n      gl.uniform1i(program['u_particles_' + tInfo.name], tInfo.index);\n    })\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/utils/textureCollection.js","import appState from './appState';\n\nconst defaultConfig = {\n  // I need to flash our more details before making any promises.\n  isAudioEnabled: false,\n  // this allows to render an overlay grid with vectors. Enable it\n  // and drag the scene a little bit.\n  vectorLinesEnabled: false,\n\n  // Starting from which texture unit we can bind custom inputs?\n  FREE_TEXTURE_UNIT: 4,\n\n  // whether input bindings should be visible\n  showBindings: appState.getQS().get('showBindings') || false\n}\n\nexport default defaultConfig;\n\n\n// WEBPACK FOOTER //\n// ./src/lib/config.js","import fetchGLSL from './fetchGLSL.js';\n\nvar pragmaInclude = '#include ';\nvar nullCode = { code: '' }\n\n/**\n * Naively parses glsl code and tries to replace all `#pragma` statements\n * with empty string. Gives structured collection of pragma statements back\n * \n * @param {String} code \n */\nexport default function makePragmaParser(code) {\n  if (!code) return new Promise(resolve => resolve(nullCode));\n\n  var parsedLines = processLineByLine(code);\n  if (parsedLines.pending.length > 0) {\n    return Promise.all(parsedLines.pending).then(() => parsedLines)\n      .catch(error => { return {error: {error}}; });\n  }\n\n  return new Promise(resolve => resolve(parsedLines));\n}\n\nfunction processLineByLine(code) {\n  var pending = []\n  var lines = code.split('\\n');\n  var outputLines = [];\n  var currentIndex = 0;\n  lines.forEach((line, index) => {\n    currentIndex = index;\n    if (line && line[0] === '#') {\n      outputLines.push('');\n      processPragma(line);\n    } else {\n      outputLines.push(line);\n    }\n  });\n\n  return {\n    getCode,\n    pending\n  };\n\n  function getCode() {\n    return outputLines.join('\\n');\n  }\n\n  function processPragma(line) {\n    if (line.indexOf(pragmaInclude) === 0) {\n      var include = line.substr(pragmaInclude.length);\n      var insertIndex = currentIndex;\n      pending.push(fetchGLSL(include).then(code => {\n        outputLines[insertIndex] = code\n      }))\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/editor/pragmaParser.js","import BaseShaderNode from './BaseShaderNode';\n\nexport default class PanzoomTransform extends BaseShaderNode {\n  constructor(config) {\n    super();\n    // decode is used when we move particle read from the texture\n    // otherwise we write particle to texture and need to reverse transform\n    this.decode = config && config.decode;\n    this.srcPosName = (config && config.posName) || 'pos';\n  }\n\n  getDefines() {\n    if (this.decode) {\n      // TODO: Need to figure out how to not duplicate this.\n    return `\n  uniform vec2 u_min;\n  uniform vec2 u_max;\n`;\n    }\n  }\n\n  getMainBody() {\n    if (this.decode) {\n      return `\n  // move particle position according to current transform\n  vec2 du = (u_max - u_min);\n  pos.x = ${this.srcPosName}.x * du.x + u_min.x;\n  pos.y = ${this.srcPosName}.y * du.y + u_min.y;\n`\n    }\n    return `\n  pos.x = (${this.srcPosName}.x - u_min.x)/du.x;\n  pos.y = (${this.srcPosName}.y - u_min.y)/du.y;\n`\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/shaderGraph/PanzoomTransform.js"],"sourceRoot":""}